import{createClient as gs}from"https://esm.sh/@supabase/supabase-js@2";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const er=["localhost","127.0.0.1","local.stackblitz.io"],vn=window.__DEV_MODE__===!0,tr=1e4;function nr(){if(typeof window>"u")return!1;const t=window.location.hostname;return er.includes(t)||t.includes("stackblitz")||t.includes("webcontainer")}function sr(){if(vn&&!nr())throw new Error(`üö® DEV MODE BLOCKED ON NON-LOCALHOST üö®
Dev mode can only run on localhost, 127.0.0.1, or StackBlitz environments.
Current hostname: ${window.location.hostname}
This is a security measure to prevent dev mode from running in production.`)}function rr(){vn&&(sr(),console.warn("%c‚ö†Ô∏è DEV MODE ENABLED ‚ö†Ô∏è","background: #ff6b6b; color: white; font-size: 20px; padding: 10px; font-weight: bold;"),console.warn("DEV MODE is active. This should NEVER happen in production."),console.warn("Features enabled:"),console.warn("  - Bypass authentication"),console.warn("  - Auto-approve KYC"),console.warn("  - Fake wallet balance: $"+(tr/100).toFixed(2)),console.warn("  - Test data flag on all transactions"))}function or(){}if(typeof window<"u")try{rr(),vn&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",or):void 0)}catch(t){throw console.error("DEV MODE initialization error:",t),alert(t.message),t}window.__QBANKS__=window.__QBANKS__||{};function ir(t,e){window.__QBANKS__.__builders=window.__QBANKS__.__builders||{},window.__QBANKS__.__builders[t]=e}function Ht(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function H(t,e,n){return Math.floor(t()*(n-e+1))+e}function ot(t,e){return e[Math.floor(t()*e.length)]}function ms(t,e){for(let n=e.length-1;n>0;n--){const s=Math.floor(t()*(n+1));[e[n],e[s]]=[e[s],e[n]]}}function ar(t,e,n,s){return new Set([String(t),String(e),String(n),String(s)]).size===4}function Un(t,e=120){return t.length<=e?t:t.slice(0,e-1)}function ps(t,e){for(;e;)[t,e]=[e,t%e];return Math.abs(t)}function lr(t,e){return Math.abs(t*e)/ps(t,e)}function cr(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return e^=e<<13,e^=e>>>17,e^=e<<5,e>>>0}const At={Easy:7e3,Medium:1e4,Hard:15e3};function ur(t,e,n=[-2,-1,1,2],s=!0,r=!1){const o=new Set([String(e)]),i=()=>{const u=ot(t,n);let f=e+u;return s&&f<0&&(f=e+Math.abs(u)),r&&f===0&&(f+=1),f};let a=0;for(;o.size<4&&a<100;){a++;const u=i();o.has(String(u))||o.add(String(u))}for(;o.size<4;){const u=e+H(t,-50,50);u!==e&&!o.has(String(u))&&o.add(String(u))}const l=Array.from(o).map(u=>Number.isNaN(Number(u))?u:Number(u));ms(t,l);const c=l.findIndex(u=>String(u)===String(e));return{arr:l,correctLetter:["A","B","C","D"][c]}}function dr(t,e,n){const s=new Set([e]),r=()=>`1/${Math.max(2,n+ot(t,[-2,-1,1,2]))}`;let o=0;for(;s.size<4&&o<50;){o++;const l=r();s.has(l)||s.add(l)}for(;s.size<4;)s.add(`1/${Math.max(2,n+H(t,-5,5))}`);const i=Array.from(s);ms(t,i);const a=i.findIndex(l=>l===e);return{arr:i,correctLetter:["A","B","C","D"][a]}}function hr(t,e){const n=window.__STATIC_EASY_MATH__||[];return n.length===0?(console.warn("No static easy math questions loaded, returning empty array"),[]):n.map((r,o)=>{const i=r.options.findIndex(l=>l===r.answer),a=["A","B","C","D"][i];return{category:e,difficulty:"Easy",question:r.question,option_a:r.options[0],option_b:r.options[1],option_c:r.options[2],option_d:r.options[3],correct_option:a,time_limit_ms:At.Easy}})}function fr(t,e){const n=window.__STATIC_MEDIUM_MATH__||[];return n.length===0?(console.warn("No static medium math questions loaded, returning empty array"),[]):n.map((r,o)=>{const i=r.options.findIndex(l=>l===r.answer),a=["A","B","C","D"][i];return{category:e,difficulty:"Medium",question:r.question,option_a:r.options[0],option_b:r.options[1],option_c:r.options[2],option_d:r.options[3],correct_option:a,time_limit_ms:At.Medium}})}function gr(t,e){const n=[],s=new Set,r=[()=>{const i=H(t,2,12),a=H(t,2,12),l=H(t,2,12),c=i*a-l;return{q:`${i} √ó ${a} ‚àí ${l} = ?`,ans:c}},()=>{const i=H(t,3,20),a=H(t,3,20),l=H(t,2,9),c=H(t,1,20),u=(i+a)*l-c;return{q:`(${i} + ${a}) √ó ${l} ‚àí ${c} = ?`,ans:u}},()=>{const i=H(t,6,20),a=H(t,2,5),l=i+a,c=i-a,u=l*l-c*c;return{q:`${l}¬≤ ‚àí ${c}¬≤ = ?`,ans:u}},()=>{const i=H(t,4,12),a=`1/${i}`,{arr:l,correctLetter:c}=dr(t,a,i);return{q:`Bag: ${i-1} red, 1 blue. P(blue) = ?`,ans:a,optionsOverride:{arr:l,correctLetter:c}}},()=>{const i=ot(t,[30,35,40,45,50,55,60,65]),a=ot(t,["comp","supp"]),l=a==="comp"?90-i:180-i;return{q:a==="comp"?`Complement of ${i}¬∞ = ?`:`Supplement of ${i}¬∞ = ?`,ans:l}},()=>{const i=H(t,3,12),a=H(t,3,12),l=lr(i,a);return{q:`LCM(${i}, ${a}) = ?`,ans:l}},()=>{const i=H(t,8,50),a=H(t,8,50),l=ps(i,a);return{q:`GCD(${i}, ${a}) = ?`,ans:l}},()=>{const i=H(t,5,30),a=H(t,35,80),l=a-i;return{q:`If x + ${i} = ${a}, x = ?`,ans:l}},()=>{const i=H(t,2,12),a=H(t,3,15),l=i*a;return{q:`If ${i}x = ${l}, x = ?`,ans:a}}];let o=0;for(;n.length<300&&o<5e3;){o++;const i=ot(t,r)(),a=`${i.q}|${i.ans}`;if(s.has(a))continue;if(s.add(a),i.optionsOverride){const[p,h,y,w]=i.optionsOverride.arr.map(String);n.push({category:e,difficulty:"Hard",question:Un(i.q),option_a:p,option_b:h,option_c:y,option_d:w,correct_option:i.optionsOverride.correctLetter,time_limit_ms:At.Hard});continue}const{arr:l,correctLetter:c}=ur(t,i.ans,[-30,-15,-5,-1,1,5,15,30],!0,!1);if(!ar(l[0],l[1],l[2],l[3]))continue;const[u,f,d,g]=l.map(String);n.push({category:e,difficulty:"Hard",question:Un(i.q),option_a:u,option_b:f,option_c:d,option_d:g,correct_option:c,time_limit_ms:At.Hard})}return n}function mr(t="math-royale-v1"){const e="Math",n=cr(t),s=hr(Ht(n^42405),e),r=fr(Ht(n^23130),e),o=gr(Ht(n^50115),e);return{easy:s,medium:r,hard:o}}(async()=>{try{const e=await(await fetch("/src/easy_math_500.json")).json();window.__STATIC_EASY_MATH__=e,console.log(`Loaded ${e.length} static easy math questions`)}catch(t){console.error("Failed to load easy math questions:",t),window.__STATIC_EASY_MATH__=[]}})();(async()=>{try{const e=await(await fetch("/src/medium_math_500.json")).json();window.__STATIC_MEDIUM_MATH__=e,console.log(`Loaded ${e.length} static medium math questions`)}catch(t){console.error("Failed to load medium math questions:",t),window.__STATIC_MEDIUM_MATH__=[]}})();ir("math",t=>mr(t));console.log("Question selection module loaded");const ue={math:{easy:[],medium:[],hard:[]},sports:{easy:[],medium:[],hard:[]}};let Ft=new Set;async function pr(){try{console.log("[Question Selection] Loading question files...");const[t,e]=await Promise.all([fetch("/src/easy_math_500.json"),fetch("/src/medium_math_500.json")]);ue.math.easy=await t.json(),ue.math.medium=await e.json(),ue.math.hard=[],console.log("[Question Selection] Loaded math questions:",{easy:ue.math.easy.length,medium:ue.math.medium.length,hard:ue.math.hard.length});try{const s=await(await fetch("/src/sports_easy_60.json")).json();ue.sports.easy=s,ue.sports.medium=s,ue.sports.hard=s,console.log("[Question Selection] Loaded sports questions:",s.length)}catch(n){console.warn("[Question Selection] Sports questions not available:",n)}}catch(t){console.error("[Question Selection] Failed to load questions:",t)}}pr();window.nextQuestion=async function({categories:t=[],difficulty:e=null}={}){console.log("[Question Selection] === nextQuestion called ==="),console.log("[Question Selection] categories:",t),console.log("[Question Selection] difficulty:",e);let n=null;Array.isArray(t)&&t.length>0&&(n=t[0],console.log("[Question Selection] Using category from array:",n)),!n||!ue[n]?(console.log("[Question Selection] No valid category provided or category not found in pools"),console.log("[Question Selection] Requested category:",n),console.log("[Question Selection] Available pools:",Object.keys(ue)),console.log("[Question Selection] Defaulting to math"),n="math"):console.log("[Question Selection] ‚úì Valid category found:",n);const s=ue[n];let r=s.medium;if(e==="easy"?r=s.easy:e==="hard"?r=s.hard.length>0?s.hard:s.medium:(e==="normal"||e==="medium")&&(r=s.medium),console.log("[Question Selection] Selected pool:",n,e,"size:",r.length),r.length===0)return console.warn("[Question Selection] No questions available for category:",n,"difficulty:",e),{question:null,done:!0};let o=0,i=-1;const a=r.length*2;for(;o<a;){i=Math.floor(Math.random()*r.length);const d=`${n}-${e}-${i}`;if(!Ft.has(d))break;o++}o>=a&&(console.log("[Question Selection] All questions used, clearing cache"),Ft.clear(),i=Math.floor(Math.random()*r.length));const l=`${n}-${e}-${i}`;Ft.add(l);const c=r[i],u=c.options.indexOf(c.answer)+1,f={id:`${n}-${e}-${i}`,prompt:c.question,choices:c.options,correct_index:u,time_limit_ms:e==="easy"?7e3:1e4,category:n,difficulty:c.difficulty||e||"medium"};return console.log("[Question Selection] === Returning question ==="),console.log("[Question Selection] Question category:",f.category),console.log("[Question Selection] Question prompt:",f.prompt.substring(0,50)+"..."),{question:f,done:!1}};console.log("[Question Selection] window.nextQuestion registered");const yr="https://dguhvsjrqnpeonfhotty.supabase.co",wr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRndWh2c2pycW5wZW9uZmhvdHR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NDkxOTAsImV4cCI6MjA3OTIyNTE5MH0.VQ1LAy545BkKan70yHdnOup1y33BH4wm3w-bKq_qxAs",re=gs(yr,wr);let Xe=null;re.auth.onAuthStateChange((t,e)=>{(async()=>(Xe=(e==null?void 0:e.user)||null,Xe&&await ct()))()});async function ct(){if(Xe)try{const{data:t}=await re.auth.getSession();if(!t.session)return;const e=await fetch("https://dguhvsjrqnpeonfhotty.supabase.co/functions/v1/wallet_balance",{headers:{Authorization:`Bearer ${t.session.access_token}`,"Content-Type":"application/json"}});if(e.ok){const s=(((await e.json()).balance_cents||0)/100).toFixed(2),r=document.getElementById("walletBalance");if(r){r.textContent=`Balance: $${s}`;const a=localStorage.getItem("hideBalance")==="true";r.style.display=a?"none":"inline-flex"}const o=document.getElementById("headerWalletBalance");o&&(o.textContent=`$${s}`);const i=document.getElementById("headerMobileWalletBalance");i&&(i.textContent=`$${s}`)}}catch(t){console.error("Failed to refresh balance:",t)}}function vr(){const t=document.getElementById("openDeposit"),e=document.getElementById("openWithdraw"),n=document.getElementById("depositModal"),s=document.getElementById("withdrawModal"),r=document.getElementById("closeDeposit"),o=document.getElementById("closeWithdraw"),i=document.getElementById("payStripeLink"),a=document.getElementById("doWithdraw"),l=document.getElementById("toggleBalance"),c=document.getElementById("walletBalance");function u(g){g==null||g.classList.remove("hidden")}function f(g){g==null||g.classList.add("hidden")}const d=localStorage.getItem("hideBalance")==="true";c&&(c.style.display=d?"none":"inline-flex"),l&&(l.textContent=d?"üëÅÔ∏è":"üôà"),l==null||l.addEventListener("click",()=>{const p=!(localStorage.getItem("hideBalance")==="true");localStorage.setItem("hideBalance",String(p)),c&&(c.style.display=p?"none":"inline-flex"),l.textContent=p?"üëÅÔ∏è":"üôà"}),t==null||t.addEventListener("click",()=>{if(!Xe){alert("Please sign in to deposit funds");return}u(n)}),e==null||e.addEventListener("click",()=>{if(!Xe){alert("Please sign in to withdraw funds");return}u(s)}),r==null||r.addEventListener("click",()=>f(n)),o==null||o.addEventListener("click",()=>f(s)),i==null||i.addEventListener("click",async()=>{const g=document.getElementById("depAmount"),p=Math.max(1,Math.floor(Number(g.value)||10));try{const{data:h}=await re.auth.getSession();if(!h.session){alert("Please sign in first");return}const y=await fetch("https://dguhvsjrqnpeonfhotty.supabase.co/functions/v1/stripe_create_checkout",{method:"POST",headers:{Authorization:`Bearer ${h.session.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({amount_cents:p*100})}),w=await y.json();if(!y.ok){alert(w.error||"Deposit failed");return}window.location.href=w.url}catch(h){console.error("Deposit error:",h),alert("Failed to initiate deposit")}}),a==null||a.addEventListener("click",async()=>{const g=document.getElementById("wdAmount"),p=Math.max(1,Math.floor(Number(g.value)||10));try{const{data:h}=await re.auth.getSession();if(!h.session){alert("Please sign in first");return}const y=await fetch("https://dguhvsjrqnpeonfhotty.supabase.co/functions/v1/wallet_withdraw",{method:"POST",headers:{Authorization:`Bearer ${h.session.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({amount_cents:p*100})}),w=await y.json();if(!y.ok){alert(w.error||"Withdrawal failed");return}alert("Withdrawal requested. You'll be notified when paid."),f(s),await ct()}catch(h){console.error("Withdrawal error:",h),alert("Failed to request withdrawal")}}),setInterval(()=>{Xe&&ct()},1e4)}const Qe={unverified:{name:"Unverified",badge:"Unverified ‚Äî KYC Required",color:"#F59E0B",icon:"‚è≥",description:"Complete KYC to unlock cash play",features:["Free play mode only","KYC verification required for cash matches"],limits:{deposit:"$0",withdrawal:"$0",cashMatches:!1},requirements:["Full legal name","Date of birth (18+ required)","Full address","SSN last 4 digits","Government ID scan","Selfie verification"]},T2:{name:"Verified Competitor",badge:"Tier 2 ‚Äî Verified Competitor",color:"#22C55E",icon:"‚úì",description:"Full KYC verified",features:["All cash matches","Deposits up to $2,500/month","Withdrawals up to $5,000/month","Standard tournaments","Compete for real money"],limits:{deposit:"$2,500/month",withdrawal:"$5,000/month",cashMatches:!0,vipAccess:!1},requirements:["Full legal name","Date of birth (18+ required)","Full address","SSN last 4 digits","Government ID scan","Selfie verification"]},T3:{name:"Elite Competitor",badge:"Tier 3 ‚Äî Elite Competitor",color:"#A855F7",icon:"üëë",description:"VIP & High Stakes",features:["All T2 features","High-stakes matches ($100+ buy-ins)","VIP tournaments","Sponsored events","Influencer/streamer access","Deposits up to $10,000/month","Withdrawals up to $20,000/month","Priority support"],limits:{deposit:"$10,000/month",withdrawal:"$20,000/month",cashMatches:!0,vipAccess:!0},requirements:["All T2 requirements met","Proof of address (utility bill, bank statement)","Proof of income/source of funds","2FA enabled (mandatory)","Manual compliance approval","Enhanced background check"]}},Gt={unverified:{label:"Unverified",color:"#9CA3AF",description:"Verification not started"},pending:{label:"Verification in Review",color:"#F59E0B",description:"Your verification is being processed"},verified:{label:"Verified",color:"#22C55E",description:"Verification complete"},rejected:{label:"Verification Failed",color:"#EF4444",description:"Contact support for assistance"},review_required:{label:"Extra Review Required",color:"#F59E0B",description:"Additional information needed"}};let Mn=null;async function br(){try{const{data:{user:t}}=await re.auth.getUser();if(!t)return{tier:null,status:"unverified",tierInfo:Qe.unverified,statusInfo:Gt.unverified};const{data:e,error:n}=await re.from("user_verification_profiles").select("*").eq("user_id",t.id).maybeSingle();n&&n.code!=="PGRST116"&&console.error("Error fetching tier:",n);const s=(e==null?void 0:e.verification_tier)||null,r=(e==null?void 0:e.verification_status)||"unverified";return Mn={tier:s,status:r,tierInfo:s?Qe[s]:Qe.unverified,statusInfo:Gt[r],profile:e},Mn}catch(t){return console.error("Error in getUserTier:",t),{tier:null,status:"unverified",tierInfo:Qe.unverified,statusInfo:Gt.unverified}}}function _r(t,e=!0){const n=t?Qe[t]:Qe.unverified;return n?`
    <span class="badge badge-tier-${t.toLowerCase()}">
      ${e?n.icon+" ":""}${n.badge}
    </span>
  `:""}let $e=null;function Er(){console.log("[Header] Initializing"),re.auth.onAuthStateChange((t,e)=>{(async()=>($e=(e==null?void 0:e.user)||null,jn(),$e&&await ct()))()}),(async()=>{const{data:{session:t}}=await re.auth.getSession();$e=(t==null?void 0:t.user)||null,jn(),$e&&await ct()})(),Sr()}function jn(){const t=document.getElementById("headerGuestControls"),e=document.getElementById("headerAuthControls"),n=document.getElementById("oldWalletStrip"),s=document.getElementById("headerMobileGuestSection"),r=document.getElementById("headerMobileAuthSection");if($e){t&&(t.style.display="none"),e&&(e.style.display="flex"),n&&(n.style.display="none"),s&&(s.style.display="none"),r&&(r.style.display="block");const o=document.getElementById("headerUserName");if(o){const l=($e.email||"User").split("@")[0];o.textContent=l}const i=document.getElementById("headerUserAvatar");if(i){const a=$e.email||"U";i.textContent=a.charAt(0).toUpperCase()}(async()=>{const a=await br(),l=document.getElementById("headerTierBadge");l&&a&&(l.innerHTML=_r(a.tier,!1),l.style.display="inline-flex")})()}else t&&(t.style.display="flex"),e&&(e.style.display="none"),n&&(n.style.display="none"),s&&(s.style.display="block"),r&&(r.style.display="none")}function Sr(){const t=document.getElementById("headerSignIn"),e=document.getElementById("headerSignUp"),n=document.getElementById("headerWalletPill"),s=document.getElementById("headerUserMenuBtn");document.getElementById("headerUserMenu");const r=document.getElementById("headerSignOut"),o=document.getElementById("headerMobileMenuBtn");document.getElementById("headerMobileMenu");const i=document.getElementById("headerMobileSignIn"),a=document.getElementById("headerMobileSignUp"),l=document.getElementById("headerMobileSignOut"),c=document.querySelectorAll('[data-action="deposit"]'),u=document.querySelectorAll('[data-action="withdraw"]'),f=document.getElementById("headerRulesBtn"),d=document.getElementById("headerHelpBtn"),g=document.getElementById("headerTermsBtn"),p=document.getElementById("headerMobileRulesBtn"),h=document.getElementById("headerMobileHelpBtn"),y=document.getElementById("headerMobileTermsBtn");t==null||t.addEventListener("click",()=>{bt("signin")}),e==null||e.addEventListener("click",()=>{bt("signup")}),i==null||i.addEventListener("click",()=>{_e(),bt("signin")}),a==null||a.addEventListener("click",()=>{_e(),bt("signup")}),n==null||n.addEventListener("click",w=>{w.stopPropagation(),kr()}),s==null||s.addEventListener("click",w=>{w.stopPropagation(),Ar()}),r==null||r.addEventListener("click",async()=>{await re.auth.signOut(),rn(),window.location.href="/"}),l==null||l.addEventListener("click",async()=>{_e(),await re.auth.signOut(),window.location.href="/"}),o==null||o.addEventListener("click",w=>{w.stopPropagation(),Cr()}),document.addEventListener("click",()=>{rn(),Tt()}),f==null||f.addEventListener("click",()=>{Me("rules")}),d==null||d.addEventListener("click",()=>{Me("help")}),g==null||g.addEventListener("click",()=>{Me("terms")}),p==null||p.addEventListener("click",()=>{_e(),Me("rules")}),h==null||h.addEventListener("click",()=>{_e(),Me("help")}),y==null||y.addEventListener("click",()=>{_e(),Me("terms")}),c.forEach(w=>{w.addEventListener("click",()=>{Tt(),_e();const v=document.getElementById("openDeposit");v&&v.click()})}),u.forEach(w=>{w.addEventListener("click",()=>{Tt(),_e();const v=document.getElementById("openWithdraw");v&&v.click()})})}function bt(t="signin"){const e=document.getElementById("signInSheet"),n=document.getElementById("signUpSheet");t==="signup"&&n?(n.style.display="grid",n.setAttribute("aria-hidden","false")):e&&(e.style.display="grid",e.setAttribute("aria-hidden","false"))}function Ir(){const t=document.getElementById("signInSheet"),e=document.getElementById("signUpSheet");t&&(t.style.display="none",t.setAttribute("aria-hidden","true")),e&&(e.style.display="grid",e.setAttribute("aria-hidden","false"))}function Tr(){const t=document.getElementById("signInSheet"),e=document.getElementById("signUpSheet");e&&(e.style.display="none",e.setAttribute("aria-hidden","true")),t&&(t.style.display="grid",t.setAttribute("aria-hidden","false"))}function kr(){const t=document.getElementById("headerWalletMenu");if(!t)return;const e=t.style.display==="none"||!t.style.display;t.style.display=e?"block":"none",rn()}function Tt(){const t=document.getElementById("headerWalletMenu");t&&(t.style.display="none")}function Ar(){const t=document.getElementById("headerUserMenu");if(!t)return;const e=t.style.display==="none"||!t.style.display;t.style.display=e?"block":"none",Tt()}function rn(){const t=document.getElementById("headerUserMenu");t&&(t.style.display="none")}function Cr(){const t=document.getElementById("headerMobileMenu");if(!t)return;const e=t.style.display==="none"||!t.style.display;t.style.display=e?"flex":"none"}function _e(){const t=document.getElementById("headerMobileMenu");t&&(t.style.display="none")}function Me(t){const n={rules:{title:"Game Rules",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">How to Play</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px">
          <li>Answer trivia questions as fast as possible</li>
          <li>Each correct answer earns you points</li>
          <li>Speed matters - faster answers = more points</li>
          <li>In elimination rounds, the slowest player is eliminated</li>
          <li>Last player standing wins!</li>
        </ul>

        <h3 style="color:var(--accent2);margin:20px 0 12px">Game Modes</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px">
          <li><strong>Free Play:</strong> Practice mode with no stakes</li>
          <li><strong>Cash Play:</strong> Compete for real prizes (ID verification required)</li>
        </ul>
      `},help:{title:"Help & Support",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">Getting Started</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          New to BrainDash? Start with Free Play to get familiar with the game mechanics.
          When you're ready, sign up to save your progress and unlock Cash Play.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Cash Play Requirements</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px;margin-bottom:16px">
          <li>Create an account and verify your identity</li>
          <li>Deposit funds to your wallet</li>
          <li>Must be 18+ years old</li>
          <li>Available in select regions only</li>
        </ul>

        <h3 style="color:var(--accent2);margin-bottom:12px">Need More Help?</h3>
        <p style="line-height:1.8;color:var(--txt)">
          Contact us at <a href="mailto:support@braindash.com" style="color:var(--accent2)">support@braindash.com</a>
        </p>
      `},terms:{title:"Terms & Conditions",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">Acceptance of Terms</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          By accessing and using BrainDash, you accept and agree to be bound by the terms and provisions of this agreement.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Cash Play</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Cash Play features involve real money. You must be 18 years or older and comply with all applicable laws in your jurisdiction.
          Identity verification is required for all Cash Play participants.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Fair Play</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Cheating, collusion, or use of automated tools is strictly prohibited and will result in account termination
          and forfeiture of any funds or prizes.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Privacy</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Your privacy is important to us. We collect and process personal data in accordance with our
          <a href="/legal/privacy.md" target="_blank" style="color:var(--accent2)">Privacy Policy</a>.
        </p>

        <p style="line-height:1.8;color:var(--muted);font-size:0.875rem;margin-top:24px">
          Last updated: November 2025<br>
          For full terms, visit <a href="/legal/terms.md" target="_blank" style="color:var(--accent2)">/legal/terms.md</a>
        </p>
      `}}[t];if(!n)return;const s=document.getElementById("infoModal");s&&s.remove();const r=document.createElement("div");r.id="infoModal",r.className="sheet",r.style.display="grid",r.setAttribute("aria-hidden","false"),r.innerHTML=`
    <div class="modal" style="max-height:85vh;overflow-y:auto">
      <button class="close" onclick="document.getElementById('infoModal').remove()" aria-label="Close">&times;</button>
      <h2 class="modal-title">${n.title}</h2>
      <div style="margin-top:20px">
        ${n.body}
      </div>
      <button class="btn" onclick="document.getElementById('infoModal').remove()" style="margin-top:24px;width:100%">Close</button>
    </div>
  `,r.addEventListener("click",o=>{o.target===r&&r.remove()}),document.body.appendChild(r)}let ys=null;function Rr(){console.log("[Auth] Initializing auth UI"),Or(),xr(),Br(),Dr()}function ws(){return ys||sessionStorage.getItem("auth_redirect")}function vs(){ys=null,sessionStorage.removeItem("auth_redirect")}function Or(){const t=document.getElementById("emailSignUpForm"),e=document.getElementById("phoneSignUpForm"),n=document.querySelectorAll('[data-switch="signin"]'),s=document.getElementById("signUpTabEmail"),r=document.getElementById("signUpTabPhone");s==null||s.addEventListener("click",()=>{var o,i;(o=document.getElementById("emailSignUpSection"))==null||o.classList.remove("hidden"),(i=document.getElementById("phoneSignUpSection"))==null||i.classList.add("hidden"),s.classList.add("active-tab"),r==null||r.classList.remove("active-tab")}),r==null||r.addEventListener("click",()=>{var o,i;(o=document.getElementById("phoneSignUpSection"))==null||o.classList.remove("hidden"),(i=document.getElementById("emailSignUpSection"))==null||i.classList.add("hidden"),r.classList.add("active-tab"),s==null||s.classList.remove("active-tab")}),t==null||t.addEventListener("submit",async o=>{o.preventDefault(),await Pr()}),e==null||e.addEventListener("submit",async o=>{o.preventDefault(),await $r()}),n.forEach(o=>{o.addEventListener("click",i=>{i.preventDefault(),Tr()})})}function xr(){const t=document.getElementById("emailSignInForm"),e=document.getElementById("phoneSignInForm"),n=document.querySelectorAll('[data-switch="signup"]'),s=document.getElementById("signInTabEmail"),r=document.getElementById("signInTabPhone");s==null||s.addEventListener("click",()=>{var o,i;(o=document.getElementById("emailSignInSection"))==null||o.classList.remove("hidden"),(i=document.getElementById("phoneSignInSection"))==null||i.classList.add("hidden"),s.classList.add("active-tab"),r==null||r.classList.remove("active-tab")}),r==null||r.addEventListener("click",()=>{var o,i;(o=document.getElementById("phoneSignInSection"))==null||o.classList.remove("hidden"),(i=document.getElementById("emailSignInSection"))==null||i.classList.add("hidden"),r.classList.add("active-tab"),s==null||s.classList.remove("active-tab")}),t==null||t.addEventListener("submit",async o=>{o.preventDefault(),await Lr()}),e==null||e.addEventListener("submit",async o=>{o.preventDefault(),await Nr()}),n.forEach(o=>{o.addEventListener("click",i=>{i.preventDefault(),Ir()})})}function Br(){const t=document.querySelectorAll('[data-oauth="google"]'),e=document.querySelectorAll('[data-oauth="apple"]');t.forEach(n=>{n.addEventListener("click",async s=>{s.preventDefault(),await qn("google")})}),e.forEach(n=>{n.addEventListener("click",async s=>{s.preventDefault(),await qn("apple")})})}async function Pr(){const t=document.getElementById("signUpName"),e=document.getElementById("signUpEmail"),n=document.getElementById("signUpPassword"),s=document.getElementById("emailSignUpMessage"),r=t==null?void 0:t.value.trim(),o=e==null?void 0:e.value.trim(),i=n==null?void 0:n.value;if(!o){W(s,"Please enter your email address","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){W(s,"Please enter a valid email address","error");return}if(!i){W(s,"Please enter a password","error");return}if(i.length<8){W(s,"Password must be at least 8 characters long","error");return}W(s,"Creating your account...","info");try{const{data:l,error:c}=await re.auth.signUp({email:o,password:i,options:{data:{name:r||o.split("@")[0]},emailRedirectTo:window.location.origin}});if(c)throw c.message.includes("already registered")?new Error("This email is already registered. Please sign in instead."):c;l!=null&&l.user&&(W(s,"Account created! You're now signed in.","success"),setTimeout(()=>{Pt(),yt("Welcome to BrainDash!");const u=ws();u&&(vs(),window.location.href=u)},1e3))}catch(l){console.error("[Auth] Sign up error:",l);const c=l.message||"Unable to create account. Please try again.";W(s,c,"error")}}async function $r(){const t=document.getElementById("signUpPhoneName"),e=document.getElementById("signUpPhone"),n=document.getElementById("signUpPhonePassword"),s=document.getElementById("phoneSignUpMessage"),r=t==null?void 0:t.value.trim(),o=e==null?void 0:e.value.trim(),i=n==null?void 0:n.value;if(!o||!i){W(s,"Please fill in all required fields","error");return}if(i.length<8){W(s,"Password must be at least 8 characters","error");return}W(s,"Creating account...","info");try{const{data:a,error:l}=await re.auth.signUp({phone:o,password:i,options:{data:{name:r||o}}});if(l)throw l;W(s,"Account created successfully!","success"),Pt(),yt("Welcome to BrainDash!")}catch(a){console.error("[Auth] Phone sign up error:",a),W(s,a.message||"Sign up failed","error")}}async function Lr(){const t=document.getElementById("signInEmail"),e=document.getElementById("signInPassword"),n=document.getElementById("emailSignInMessage"),s=t==null?void 0:t.value.trim(),r=e==null?void 0:e.value;if(!s){W(n,"Please enter your email address","error");return}if(!r){W(n,"Please enter your password","error");return}W(n,"Signing in...","info");try{const{data:o,error:i}=await re.auth.signInWithPassword({email:s,password:r});if(i)throw i.message.includes("Invalid")||i.message.includes("incorrect")?new Error("Incorrect email or password, or account not found."):i;W(n,"Welcome back!","success"),setTimeout(()=>{Pt(),yt("Signed in successfully!");const a=ws();a&&(vs(),window.location.href=a)},800)}catch(o){console.error("[Auth] Sign in error:",o);const i=o.message||"Unable to sign in. Please check your credentials.";W(n,i,"error")}}async function Nr(){const t=document.getElementById("signInPhone"),e=document.getElementById("signInPhonePassword"),n=document.getElementById("phoneSignInMessage"),s=t==null?void 0:t.value.trim(),r=e==null?void 0:e.value;if(!s||!r){W(n,"Please enter your phone and password","error");return}W(n,"Signing in...","info");try{const{data:o,error:i}=await re.auth.signInWithPassword({phone:s,password:r});if(i)throw i;W(n,"Welcome back!","success"),Pt(),yt("Signed in successfully!")}catch(o){console.error("[Auth] Phone sign in error:",o),W(n,o.message||"Sign in failed","error")}}async function qn(t){try{const{data:e,error:n}=await re.auth.signInWithOAuth({provider:t,options:{redirectTo:window.location.origin}});if(n)throw n}catch(e){console.error(`[Auth] ${t} OAuth error:`,e),yt(`${t} sign in failed. Please try again.`)}}function W(t,e,n){t&&(t.textContent=e,t.style.display="block",n==="error"?t.style.color="#ff6b6b":n==="success"?t.style.color="var(--accent)":t.style.color="var(--muted)")}function Pt(){const t=document.getElementById("signInSheet"),e=document.getElementById("signUpSheet");t&&(t.style.display="none",t.setAttribute("aria-hidden","true")),e&&(e.style.display="none",e.setAttribute("aria-hidden","true"))}function yt(t){const e=document.getElementById("toast");e&&(e.textContent=t,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3))}function Dr(){const t=document.getElementById("biometricSignIn"),e=document.getElementById("biometricSignUpBtn");t&&t.addEventListener("click",n=>{n.preventDefault(),Wn()}),e&&e.addEventListener("click",n=>{n.preventDefault(),Wn()})}function Wn(){const t=document.createElement("div");t.className="sheet",t.style.display="grid",t.setAttribute("aria-hidden","false"),t.innerHTML=`
    <div class="modal" style="max-width:400px">
      <button class="close" onclick="this.closest('.sheet').remove()" aria-label="Close">&times;</button>
      <div style="text-align:center;padding:20px">
        <div style="font-size:48px;margin-bottom:16px">üîê</div>
        <h2 class="modal-title">Biometric Login Coming Soon</h2>
        <p style="color:var(--muted);margin-top:16px;line-height:1.6">
          Face ID, Touch ID, and passkey login will be available soon on supported devices.
          This feature will provide quick and secure access to your account.
        </p>
        <p style="color:var(--muted);margin-top:12px;font-size:0.875rem">
          For now, please continue using email and password to sign in.
        </p>
        <button class="btn" onclick="this.closest('.sheet').remove()" style="margin-top:24px;width:100%">
          Got it
        </button>
      </div>
    </div>
  `,t.addEventListener("click",e=>{e.target===t&&t.remove()}),document.body.appendChild(t)}console.log("[Questions] Loading new category-based question bank...");const ye={sports:[{question:"Which country won the FIFA World Cup in 2018?",choices:["Brazil","Germany","France","Argentina"],correctIndex:2},{question:"In basketball, how many points is a free throw worth?",choices:["1","2","3","4"],correctIndex:0},{question:"Which NBA legend is known as 'His Airness'?",choices:["Kobe Bryant","LeBron James","Michael Jordan","Magic Johnson"],correctIndex:2},{question:"How many players are on a soccer team on the field?",choices:["9","10","11","12"],correctIndex:2},{question:"Which sport uses a puck instead of a ball?",choices:["Soccer","Hockey","Basketball","Tennis"],correctIndex:1},{question:"In which sport would you perform a slam dunk?",choices:["Volleyball","Basketball","Tennis","Baseball"],correctIndex:1},{question:"How many Grand Slam tournaments are there in tennis?",choices:["2","3","4","5"],correctIndex:2},{question:"Which country hosted the 2016 Summer Olympics?",choices:["China","Brazil","UK","Russia"],correctIndex:1},{question:"What color card does a referee show for a serious foul in soccer?",choices:["Yellow","Red","Green","Blue"],correctIndex:1},{question:"How many points is a touchdown worth in American football?",choices:["3","6","7","10"],correctIndex:1}],politics:[{question:"What is the primary purpose of a constitution?",choices:["To list all citizens","To establish the framework of government","To set tax rates","To choose political parties"],correctIndex:1},{question:"Which branch of government interprets laws?",choices:["Executive","Legislative","Judicial","Military"],correctIndex:2},{question:"How many senators does each U.S. state have?",choices:["1","2","4","Varies by population"],correctIndex:1},{question:"What is the term length for a U.S. President?",choices:["2 years","4 years","6 years","8 years"],correctIndex:1},{question:"Which document begins with 'We the People'?",choices:["Declaration of Independence","Bill of Rights","U.S. Constitution","Magna Carta"],correctIndex:2},{question:"What is the minimum age to be U.S. President?",choices:["30","35","40","45"],correctIndex:1},{question:"How many branches are in the U.S. government?",choices:["2","3","4","5"],correctIndex:1},{question:"What is the capital of the United States?",choices:["New York","Washington D.C.","Philadelphia","Boston"],correctIndex:1},{question:"Who is the commander-in-chief of the U.S. military?",choices:["Secretary of Defense","Chairman of Joint Chiefs","The President","Speaker of the House"],correctIndex:2},{question:"How many justices sit on the U.S. Supreme Court?",choices:["7","9","11","13"],correctIndex:1}],business:[{question:"What does ROI stand for in business?",choices:["Rate of Interest","Return on Investment","Revenue on Income","Risk of Increase"],correctIndex:1},{question:"What is the primary goal of a for-profit business?",choices:["Hiring employees","Generating profit","Filing taxes","Building offices"],correctIndex:1},{question:"What does CEO stand for?",choices:["Central Executive Officer","Chief Executive Officer","Corporate Enterprise Officer","Company Equity Officer"],correctIndex:1},{question:"What is a stock dividend?",choices:["A tax on stocks","A payment to shareholders","A stock price increase","A company merger"],correctIndex:1},{question:"What does IPO stand for?",choices:["Initial Public Offering","Internal Profit Operation","Investment Portfolio Option","International Price Order"],correctIndex:0},{question:"What is GDP?",choices:["Government Development Plan","Gross Domestic Product","Global Distribution Program","General Data Protection"],correctIndex:1},{question:"What is inflation?",choices:["Increase in prices over time","Decrease in prices over time","Stable prices","Government spending"],correctIndex:0},{question:"What is a monopoly?",choices:["Many small competitors","One dominant seller","Government ownership","No sellers"],correctIndex:1},{question:"What does LLC stand for?",choices:["Limited Liability Company","Large Local Corporation","Legal License Contract","Long-term Loan Credit"],correctIndex:0},{question:"What is supply and demand?",choices:["A pricing theory","A tax system","A trade agreement","A stock market"],correctIndex:0}],music:[{question:"Which artist is known as the 'King of Pop'?",choices:["Prince","Elvis Presley","Michael Jackson","Freddie Mercury"],correctIndex:2},{question:"Which band sang 'Bohemian Rhapsody'?",choices:["The Beatles","Led Zeppelin","Queen","Pink Floyd"],correctIndex:2},{question:"Who is known as the 'Queen of Soul'?",choices:["Whitney Houston","Aretha Franklin","Diana Ross","Tina Turner"],correctIndex:1},{question:"Which instrument has 88 keys?",choices:["Guitar","Violin","Piano","Organ"],correctIndex:2},{question:"What genre is Bob Marley associated with?",choices:["Jazz","Reggae","Blues","Rock"],correctIndex:1},{question:"Which rapper's real name is Marshall Mathers?",choices:["Dr. Dre","Snoop Dogg","Eminem","50 Cent"],correctIndex:2},{question:"What is the highest female singing voice?",choices:["Alto","Soprano","Mezzo","Contralto"],correctIndex:1},{question:"Which band had a hit with 'Stairway to Heaven'?",choices:["The Rolling Stones","Led Zeppelin","The Who","Aerosmith"],correctIndex:1},{question:"What nationality is classical composer Mozart?",choices:["German","Italian","Austrian","French"],correctIndex:2},{question:"Which instrument is Jimi Hendrix famous for playing?",choices:["Drums","Piano","Guitar","Saxophone"],correctIndex:2}],movies:[{question:"Which movie features the quote, 'I'll be back'?",choices:["Die Hard","The Terminator","RoboCop","Predator"],correctIndex:1},{question:"Who directed 'Jurassic Park'?",choices:["George Lucas","James Cameron","Steven Spielberg","Ridley Scott"],correctIndex:2},{question:"What is the highest-grossing film of all time (adjusted for inflation)?",choices:["Titanic","Avatar","Gone with the Wind","Star Wars"],correctIndex:2},{question:"Which movie won Best Picture at the 2020 Oscars?",choices:["1917","Joker","Parasite","Once Upon a Time in Hollywood"],correctIndex:2},{question:"Who played Iron Man in the Marvel Cinematic Universe?",choices:["Chris Evans","Chris Hemsworth","Robert Downey Jr.","Mark Ruffalo"],correctIndex:2},{question:"What year was the first 'Star Wars' movie released?",choices:["1975","1977","1980","1983"],correctIndex:1},{question:"Which actor played Jack in 'Titanic'?",choices:["Brad Pitt","Leonardo DiCaprio","Tom Cruise","Johnny Depp"],correctIndex:1},{question:"What is the name of the hobbit played by Elijah Wood?",choices:["Bilbo","Frodo","Sam","Pippin"],correctIndex:1},{question:"Which movie features a character named Forrest Gump?",choices:["Forrest Gump","Rain Man","Philadelphia","Cast Away"],correctIndex:0},{question:"Who directed 'The Dark Knight'?",choices:["Zack Snyder","Christopher Nolan","Tim Burton","Sam Raimi"],correctIndex:1}],history:[{question:"In which year did World War II end?",choices:["1942","1945","1948","1950"],correctIndex:1},{question:"Who was the first President of the United States?",choices:["Thomas Jefferson","George Washington","John Adams","Benjamin Franklin"],correctIndex:1},{question:"What year did the Berlin Wall fall?",choices:["1987","1989","1991","1993"],correctIndex:1},{question:"Which civilization built the pyramids?",choices:["Romans","Greeks","Egyptians","Mayans"],correctIndex:2},{question:"What year did Christopher Columbus reach the Americas?",choices:["1492","1500","1520","1450"],correctIndex:0},{question:"Who was the first person to walk on the moon?",choices:["Buzz Aldrin","Neil Armstrong","John Glenn","Yuri Gagarin"],correctIndex:1},{question:"In what year did the United States declare independence?",choices:["1774","1776","1778","1780"],correctIndex:1},{question:"Who wrote the Declaration of Independence?",choices:["George Washington","Benjamin Franklin","Thomas Jefferson","John Adams"],correctIndex:2},{question:"What was the name of the ship that brought the Pilgrims to America?",choices:["Santa Maria","Mayflower","Nina","Pinta"],correctIndex:1},{question:"Which war was fought between the North and South in the United States?",choices:["Revolutionary War","Civil War","War of 1812","Spanish-American War"],correctIndex:1}],geography:[{question:"What is the largest ocean on Earth?",choices:["Atlantic Ocean","Pacific Ocean","Indian Ocean","Arctic Ocean"],correctIndex:1},{question:"What is the capital of France?",choices:["London","Paris","Berlin","Rome"],correctIndex:1},{question:"Which continent is the largest by area?",choices:["Africa","North America","Asia","Europe"],correctIndex:2},{question:"What is the longest river in the world?",choices:["Amazon","Nile","Mississippi","Yangtze"],correctIndex:1},{question:"Which country has the most time zones?",choices:["Russia","USA","China","France"],correctIndex:3},{question:"What is the smallest country in the world?",choices:["Monaco","Vatican City","San Marino","Liechtenstein"],correctIndex:1},{question:"Mount Everest is located in which mountain range?",choices:["Andes","Alps","Himalayas","Rockies"],correctIndex:2},{question:"Which desert is the largest hot desert in the world?",choices:["Gobi","Kalahari","Sahara","Arabian"],correctIndex:2},{question:"What is the capital of Japan?",choices:["Seoul","Beijing","Tokyo","Bangkok"],correctIndex:2},{question:"Which U.S. state is the largest by area?",choices:["Texas","California","Alaska","Montana"],correctIndex:2}],science:[{question:"What is the chemical symbol for water?",choices:["O2","H2O","CO2","HO"],correctIndex:1},{question:"What planet is known as the Red Planet?",choices:["Venus","Mars","Jupiter","Saturn"],correctIndex:1},{question:"What is the speed of light?",choices:["186,000 mph","186,000 km/s","300,000 km/s","300,000 mph"],correctIndex:2},{question:"What is the powerhouse of the cell?",choices:["Nucleus","Mitochondria","Ribosome","Chloroplast"],correctIndex:1},{question:"How many bones are in the adult human body?",choices:["186","206","226","246"],correctIndex:1},{question:"What is the largest planet in our solar system?",choices:["Saturn","Jupiter","Neptune","Uranus"],correctIndex:1},{question:"What gas do plants absorb from the atmosphere?",choices:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctIndex:2},{question:"What is the hardest natural substance on Earth?",choices:["Gold","Iron","Diamond","Titanium"],correctIndex:2},{question:"What type of animal is a dolphin?",choices:["Fish","Mammal","Reptile","Amphibian"],correctIndex:1},{question:"What is the freezing point of water in Celsius?",choices:["-10¬∞C","0¬∞C","10¬∞C","32¬∞C"],correctIndex:1}],pop_culture:[{question:"Which social media platform is known for short 15-60 second videos?",choices:["Instagram","Facebook","TikTok","Twitter"],correctIndex:2},{question:"Who is known as 'The Rock' in entertainment?",choices:["Vin Diesel","John Cena","Dwayne Johnson","Jason Statham"],correctIndex:2},{question:"Which TV show features the character Walter White?",choices:["The Wire","Breaking Bad","Mad Men","The Sopranos"],correctIndex:1},{question:"What year did the first iPhone release?",choices:["2005","2007","2009","2011"],correctIndex:1},{question:"Which streaming service created 'Stranger Things'?",choices:["Hulu","Amazon Prime","Netflix","Disney+"],correctIndex:2},{question:"Who won the first season of American Idol?",choices:["Carrie Underwood","Kelly Clarkson","Ruben Studdard","Fantasia"],correctIndex:1},{question:"What is the name of the coffee shop in 'Friends'?",choices:["Central Perk","Starbucks","Coffee House","Cafe Latte"],correctIndex:0},{question:"Which Marvel movie was the first in the MCU?",choices:["Captain America","Thor","Iron Man","Hulk"],correctIndex:2},{question:"What is the highest-grossing video game franchise?",choices:["Call of Duty","Grand Theft Auto","Mario","Pokemon"],correctIndex:3},{question:"Which singer's real name is Stefani Germanotta?",choices:["Madonna","Lady Gaga","Katy Perry","Rihanna"],correctIndex:1}],mixed:[]},bn=[{label:"Sports",key:"sports",icon:"üèà"},{label:"Politics",key:"politics",icon:"üèõÔ∏è"},{label:"Business & Economics",key:"business",icon:"üíº"},{label:"Music",key:"music",icon:"üéµ"},{label:"Movies",key:"movies",icon:"üé¨"},{label:"History",key:"history",icon:"üìú"},{label:"Geography",key:"geography",icon:"üó∫Ô∏è"},{label:"Science",key:"science",icon:"üî¨"},{label:"Pop Culture",key:"pop_culture",icon:"üé≠"},{label:"Mixed",key:"mixed",icon:"üé≤"}],Ur=bn.reduce((t,e)=>(t[e.label]=e.key,t),{});function Mr(t,e){var o;console.log("[QUESTIONS] === getQuestionsForSession ==="),console.log("[QUESTIONS] categoryKey:",t),console.log("[QUESTIONS] count:",e);let n=ye[t];(!n||n.length===0)&&(console.warn("[QUESTIONS] Missing or empty pool for categoryKey:",t,"-> falling back to 'mixed'"),n=ye.mixed,(!n||n.length===0)&&(console.log("[QUESTIONS] Building mixed pool from all categories"),n=Object.values(ye).filter(i=>Array.isArray(i)&&i.length>0).flat())),console.log("[QUESTIONS] Pool size for",t,":",n.length);const r=[...n].sort(()=>Math.random()-.5).slice(0,e);return console.log("[QUESTIONS] Selected",r.length,"questions"),console.log("[QUESTIONS] First question:",((o=r[0])==null?void 0:o.question.substring(0,50))+"..."),r}let zt=new Set;window.nextQuestion=async function({categories:t=[],difficulty:e=null}={}){console.log("[Questions] nextQuestion called (compatibility mode)"),console.log("[Questions] categories:",t),console.log("[Questions] difficulty:",e);let n=null;Array.isArray(t)&&t.length>0&&(n=t[0],console.log("[Questions] Using category:",n));let s=ye[n];if((!s||s.length===0)&&(console.log("[Questions] Category not found, using mixed pool"),n="mixed",s=ye[n],(!s||s.length===0)&&(s=Object.values(ye).filter(c=>Array.isArray(c)&&c.length>0).flat())),s.length===0)return console.error("[Questions] No questions available!"),{question:null,done:!0};let r=0,o=-1;const i=s.length*2;for(;r<i;){o=Math.floor(Math.random()*s.length);const c=`${n}-${o}`;if(!zt.has(c)){zt.add(c);break}r++}r>=i&&(console.log("[Questions] All questions used, clearing cache"),zt.clear(),o=Math.floor(Math.random()*s.length));const a=s[o],l={id:`${n}-${o}`,prompt:a.question,choices:a.choices,correct_index:a.correctIndex+1,time_limit_ms:1e4,category:n,difficulty:e||"normal"};return console.log("[Questions] Returning question:",l.prompt.substring(0,50)+"..."),console.log("[Questions] Category:",l.category),console.log("[Questions] Correct index:",l.correct_index),{question:l,done:!1}};window.QUESTION_BANK=ye;window.TRIVIA_CATEGORIES=bn;window.TRIVIA_CATEGORY_MAP=Ur;window.getQuestionsForSession=Mr;console.log("[Questions] ‚úì New question bank loaded successfully");console.log("[Questions] Available categories:",bn.map(t=>t.label).join(", "));console.log("[Questions] Total questions by category:",Object.keys(ye).reduce((t,e)=>(t[e]=ye[e].length,t),{}));console.log("[Questions] ‚úì Compatibility layer for nextQuestion() enabled");console.log("[Trivia Engine] Loading unified trivia engine...");let G=null,pe=null;const st={},Ce={};async function jr(t,e){var o;console.log("[QUESTIONS] === getQuestionsForSession ==="),console.log("[QUESTIONS] Category:",t,"Count:",e),st[t]||(st[t]=[]),Ce[t]||(Ce[t]=new Set);let n=st[t].filter(i=>{if(!i)return!1;const a=i.id||i.question;return!Ce[t].has(a)});if(console.log("[QUESTIONS] Available unseen questions:",n.length),console.log("[QUESTIONS] Seen question IDs in this category:",Ce[t].size),n.length<e){const i=e-n.length;console.log("[QUESTIONS] ‚ö†Ô∏è  Need",i,"more questions, fetching from AI/bank...");const a=await qr(t,i);st[t].push(...a),n=st[t].filter(l=>{const c=l.id||l.question;return!Ce[t].has(c)})}const r=[...n].sort(()=>Math.random()-.5).slice(0,e);return r.forEach(i=>{const a=i.id||i.question;Ce[t].add(a)}),console.log("[QUESTIONS] ‚úì Selected",r.length,"questions"),console.log("[QUESTIONS] Total seen in",t+":",Ce[t].size),console.log("[QUESTIONS] First question:",((o=r[0])==null?void 0:o.question.substring(0,50))+"..."),r}async function qr(t,e){var n,s,r,o;console.log("[QUESTIONS] fetchQuestionsForCategory",{categoryKey:t,count:e});try{console.log("[QUESTIONS] üóÑÔ∏è Attempting to fetch from database...");const i=window.VITE_SUPABASE_URL,a=window.VITE_SUPABASE_ANON_KEY;if(console.log("[QUESTIONS] Supabase URL:",i?"FOUND":"MISSING"),console.log("[QUESTIONS] Supabase Key:",a?"FOUND":"MISSING"),i&&a){const l=`${i}/functions/v1/get-questions`;console.log("[QUESTIONS] Calling database endpoint:",l);const c=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({category:t,difficulty:"medium",count:e,mode:"free_play"})});if(console.log("[QUESTIONS] Database response status:",c.status),c.ok){const u=await c.json();console.log("[QUESTIONS] ‚úì Received",(n=u.questions)==null?void 0:n.length,"questions from database"),console.log("[QUESTIONS] Sample question:",(o=(r=(s=u.questions)==null?void 0:s[0])==null?void 0:r.question)==null?void 0:o.substring(0,50));const f=(u.questions||[]).map(d=>({id:d.id||Math.random().toString(36),question:d.question,choices:d.choices||d.answers||[],correctIndex:d.correctIndex??d.correct_index??0,category:t}));return As(),f}else{const u=await c.text();console.warn("[QUESTIONS] ‚ö†Ô∏è  Database endpoint failed:",c.status,u)}}else console.log("[QUESTIONS] ‚ÑπÔ∏è  Supabase env vars not configured, using offline mode")}catch(i){console.error("[QUESTIONS] ‚ö†Ô∏è  Failed to fetch from database:",i),console.error("[QUESTIONS] Error details:",i.message,i.stack)}return console.log("[QUESTIONS] üìö Falling back to static question bank"),ks(),window.QUESTION_BANK&&window.QUESTION_BANK[t]?[...window.QUESTION_BANK[t]].sort(()=>Math.random()-.5).slice(0,e).map((c,u)=>({id:c.id||`${t}-${c.question.substring(0,50).replace(/\s+/g,"-")}`,question:c.question,choices:c.choices,correctIndex:c.correctIndex})):(console.warn("[QUESTIONS] No database connection and no static bank available"),[])}function Wr(t){if(!t)return console.warn("[NORMALIZE] Null/undefined question object"),null;if(t.question&&Array.isArray(t.choices)&&typeof t.correctIndex=="number")return{id:t.id,question:t.question,choices:t.choices,correctIndex:t.correctIndex};console.log("[NORMALIZE] Processing non-standard question:",{hasQuestion:!!t.question,hasText:!!t.text,hasPrompt:!!t.prompt,hasChoices:!!t.choices,hasAnswers:!!t.answers,hasOptions:!!t.options,hasCorrectIndex:typeof t.correctIndex=="number"});const e=t.question||t.text||t.prompt||t.questionText||null,n=t.choices||t.answers||t.options||null;let s=typeof t.correctIndex=="number"?t.correctIndex:typeof t.correctAnswerIndex=="number"?t.correctAnswerIndex:typeof t.answerIndex=="number"?t.answerIndex:typeof t.correct=="number"?t.correct:null;if(s===null&&n&&t.correctAnswer&&typeof t.correctAnswer=="string"){const r=n.indexOf(t.correctAnswer);r>=0&&(s=r,console.log("[NORMALIZE] Found correctIndex from correctAnswer string:",r))}return!e||!Array.isArray(n)||s===null?(console.error("[NORMALIZE] ‚ùå Could not normalize question:",{hasQuestionText:!!e,hasChoices:Array.isArray(n),hasCorrectIndex:s!==null,raw:t}),null):(console.log("[NORMALIZE] ‚úì Normalized successfully"),{id:t.id,question:e,choices:n,correctIndex:s})}function _n({correct:t,responseTimeMs:e,questionTimerSec:n,basePoints:s=1e3,currentStreak:r}){if(!t)return{points:0,basePoints:0,streakBonus:0,newStreak:0};const o=n,i=Math.max(0,Math.min(e/1e3,o));let a;if(i<.5)a=s;else{const f=1-i/o/2;a=Math.round(f*s),a=Math.max(0,Math.min(a,s))}const l=r+1;let c=0;l===2?c=100:l===3?c=200:l===4?c=300:l===5?c=400:l>=6&&(c=500);const u=a+c;return console.log("[SCORING] BrainDash",{correct:t,responseTimeMs:e,responseTimeSec:(e/1e3).toFixed(2),questionTimerSec:n,currentStreak:r,newStreak:l,basePointsEarned:a,streakBonus:c,points:u}),{points:u,basePoints:a,streakBonus:c,newStreak:l}}async function bs(t){let{mode:e,categoryKey:n,questions:s,onComplete:r}=t;if(console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[DEBUG:ENGINE-ENTRY] === TRIVIA ENGINE CALLED ==="),console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[DEBUG:ENGINE-ENTRY] Mode:",e),console.log("[DEBUG:ENGINE-ENTRY] Category:",n),console.log("[DEBUG:ENGINE-ENTRY] Questions count (raw):",(s==null?void 0:s.length)||0),console.log("[DEBUG:ENGINE-ENTRY] First question (raw):",s==null?void 0:s[0]),console.log("[DEBUG:ENGINE-ENTRY] Has onComplete callback:",typeof r=="function"),console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[TRIVIA] === START TRIVIA SESSION ==="),console.log("[TRIVIA] Mode:",e),console.log("[TRIVIA] Category:",n),console.log("[TRIVIA] Questions (raw):",(s==null?void 0:s.length)||0),$t(),!s||s.length===0){console.error("[TRIVIA] No questions provided!"),typeof r=="function"&&r(0,{error:"No questions available"});return}console.log("[TRIVIA] Normalizing questions...");const o=s.map(Wr).filter(i=>i!==null);if(console.log("[TRIVIA] Normalized",o.length,"valid questions"),console.log("[TRIVIA] First normalized question:",o[0]),o.length===0){console.error("[TRIVIA] No valid questions after normalization!"),typeof r=="function"&&r(0,{error:"No valid questions after normalization"});return}s=o,typeof activeMatchMode<"u"&&(activeMatchMode=e,console.log("[TRIVIA] Set activeMatchMode:",e)),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),G={mode:e,categoryKey:n,questions:s,currentIndex:0,score:0,streak:0,correctCount:0,onComplete:r,questionStartTime:null,maxTimePerQuestion:8,currentQuestionLocked:!1,awaitingScoreboard:!1},_s(),Es()}function $t(){console.log("[TRIVIA] Cleaning up trivia session"),pe&&(clearInterval(pe),pe=null),G=null}function Hr(){if(console.log("[TRIVIA] User exiting trivia session"),!G){console.log("[TRIVIA] No active session to exit");return}const t=G.mode;$t(),typeof activeMatchMode<"u"&&(console.log("[TRIVIA] Clearing activeMatchMode for exit (was:",activeMatchMode,")"),activeMatchMode=null),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),t==="free"?showScreen("home"):t==="cash-test"?showScreen("cash-test-screen"):t==="cash"&&showScreen("cash-challenge-screen"),console.log("[TRIVIA] Exited to",t,"screen")}function _s(){console.log("[TRIVIA] === showTriviaScreen CALLED ===");const t=document.getElementById("match-countdown-overlay");t&&(console.warn("[TRIVIA] ‚ö†Ô∏è Found countdown overlay still present! Removing..."),t.remove());const e=document.getElementById("offlineGame");if(console.log("[TRIVIA] Found #offlineGame element:",!!e),!e){console.error("[TRIVIA] ‚ùå Trivia screen element #offlineGame not found!"),console.error("[TRIVIA] Available elements with id:",Array.from(document.querySelectorAll("[id]")).map(a=>a.id));return}console.log("[TRIVIA] Before show - offlineGame display:",e.style.display),console.log("[TRIVIA] Before show - offlineGame classList:",e.classList.toString()),e.classList.remove("hidden"),e.style.cssText=`
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 10005 !important;
    display: flex !important;
    flex-direction: column;
    overflow: hidden;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  `,console.log("[TRIVIA] After show - offlineGame display:",e.style.display),console.log("[TRIVIA] After show - offlineGame classList:",e.classList.toString()),console.log("[TRIVIA] After show - offlineGame visibility:",e.style.visibility);const n=document.getElementById("ogQuestionView"),s=document.getElementById("ogLeaderboardView");n?(n.style.display="flex",console.log("[TRIVIA] Showing #ogQuestionView")):console.error("[TRIVIA] ‚ùå #ogQuestionView not found!"),s&&(s.style.display="none",console.log("[TRIVIA] Hiding #ogLeaderboardView"));const r=document.querySelector(".wrap");r&&(r.style.display="none",console.log("[TRIVIA] Hidden main wrap"));const o=document.querySelectorAll(".screen");console.log("[TRIVIA] Hiding",o.length,"other screens"),o.forEach(a=>{a.id!=="offlineGame"&&(a.classList.add("hidden"),a.style.display="none")});const i=window.getComputedStyle(e);console.log("[TRIVIA] Computed display:",i.display),console.log("[TRIVIA] Computed visibility:",i.visibility),console.log("[TRIVIA] Computed z-index:",i.zIndex),console.log("[TRIVIA] ‚úì Trivia screen shown successfully")}function Es(){var y,w;if(!G){console.error("[TRIVIA] No active game");return}const{mode:t,questions:e,currentIndex:n,score:s,streak:r}=G,o=e[n];if(!o){console.log("[TRIVIA] No more questions, finishing session"),Ts();return}console.log("[RENDER] ========================================"),console.log("[RENDER] State snapshot:"),console.log("[RENDER] - Mode:",t),console.log("[RENDER] - Current index:",n),console.log("[RENDER] - Total questions:",e.length),console.log("[RENDER] - Question object:",o),console.log("[RENDER] - Has .question?",!!o.question),console.log("[RENDER] - Has .choices?",Array.isArray(o.choices)),console.log("[RENDER] - Choices length:",(y=o.choices)==null?void 0:y.length),console.log("[RENDER] - Has .correctIndex?",typeof o.correctIndex=="number"),console.log("[RENDER] ========================================"),console.log("[DEBUG:ENGINE-RENDER] ========================================"),console.log("[DEBUG:ENGINE-RENDER] Rendering question",n+1,"/",e.length),console.log("[DEBUG:ENGINE-RENDER] Question text:",((w=o.question)==null?void 0:w.substring(0,60))+"..."),console.log("[DEBUG:ENGINE-RENDER] ========================================"),console.log("[TRIVIA] === Rendering Question",n+1,"/",e.length,"==="),console.log("[TRIVIA] Question:",o.question);const i=document.getElementById("ogPrompt"),a=document.getElementById("ogChoices"),l=document.getElementById("ogRoundLabel"),c=document.getElementById("ogCategoryLabel"),u=document.getElementById("ogScoreDisplay"),f=document.getElementById("ogStreakDisplay");if(console.log("[RENDER] UI Elements check:"),console.log("[RENDER] - #ogPrompt:",!!i),console.log("[RENDER] - #ogChoices:",!!a),console.log("[RENDER] - #ogRoundLabel:",!!l),console.log("[RENDER] - #ogCategoryLabel:",!!c),!i||!a){console.error("[RENDER] ‚ùå Missing required UI elements!"),console.error("[RENDER] questionEl:",i),console.error("[RENDER] answersEl:",a),console.error("[RENDER] Available elements:",Array.from(document.querySelectorAll("[id]")).map(v=>v.id).filter(v=>v.startsWith("og")));return}const d=document.getElementById("ogScoringBreakdown");d&&(d.innerHTML="",console.log("[RENDER] Cleared previous answer feedback")),console.log("[RENDER] Setting question text:",o.question),i.textContent=o.question,console.log("[RENDER] Question text set. questionEl.textContent:",i.textContent);const g=n+1,p=e.length;l&&(l.textContent=`Question ${g}/${p}`,console.log("[RENDER] Round label set:",l.textContent),console.log("[RENDER] Question index:",n,"Displaying as:",g,"of",p)),c&&(c.textContent=G.categoryKey.toUpperCase(),console.log("[RENDER] Category label set:",c.textContent)),u&&(u.textContent=`Score: ${s}`),f&&(f.textContent=`Streak: ${r} üî•`),console.log("[RENDER] Rendering",o.choices.length,"answer buttons"),a.innerHTML="",o.choices.forEach((v,b)=>{console.log("[RENDER] Creating button",b+1,":",v);const T=document.createElement("button");T.className="btn trivia-answer-btn",T.textContent=v,T.style.cssText=`
      width: 100%;
      text-align: center;
      padding: 20px 24px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 12px;
      background: var(--card);
      border: 2px solid var(--line);
      color: var(--txt);
      cursor: pointer;
      transition: all .2s ease;
      margin-bottom: 12px;
    `,T.addEventListener("click",()=>{Ss(b)}),a.appendChild(T),console.log("[RENDER] Button",b+1,"appended to answersEl")}),console.log("[RENDER] ‚úì All",o.choices.length,"buttons rendered"),console.log("[RENDER] answersEl.children.length:",a.children.length);const h=document.getElementById("offlineGame");if(h){const v=window.getComputedStyle(h);console.log("[RENDER] Parent #offlineGame display:",v.display),console.log("[RENDER] Parent #offlineGame visibility:",v.visibility),console.log("[RENDER] Parent #offlineGame z-index:",v.zIndex),console.log("[RENDER] Parent #offlineGame innerHTML length:",h.innerHTML.length),console.log("[RENDER] Parent #offlineGame children count:",h.children.length),console.log("[RENDER] questionEl in DOM?",document.body.contains(i)),console.log("[RENDER] answersEl in DOM?",document.body.contains(a));const b=h.getBoundingClientRect();if(console.log("[RENDER] #offlineGame dimensions:",{width:b.width,height:b.height,top:b.top,left:b.left}),i){const T=i.getBoundingClientRect(),$=window.getComputedStyle(i);console.log("[RENDER] questionEl dimensions:",{width:T.width,height:T.height,top:T.top,left:T.left}),console.log("[RENDER] questionEl computed styles:",{display:$.display,visibility:$.visibility,fontSize:$.fontSize,color:$.color,textContent:i.textContent.substring(0,50)});const R=i.parentElement;if(R){const O=R.getBoundingClientRect(),ee=window.getComputedStyle(R);console.log("[RENDER] questionEl parent (#ogQuestionView?) dimensions:",{id:R.id,width:O.width,height:O.height,display:ee.display,visibility:ee.visibility})}}(v.display==="none"||v.visibility==="hidden")&&(console.warn("[RENDER] ‚ö†Ô∏è Parent was hidden! Re-showing..."),_s())}console.log("[RENDER] Starting question timer"),Fr(),console.log("[RENDER] ‚úì renderTriviaQuestion COMPLETE")}function Fr(){if(!G)return;const t=G,e=t.maxTimePerQuestion;t.questionStartTime=Date.now(),t.currentQuestionLocked=!1,t.awaitingScoreboard=!1;const n=document.getElementById("ogTimerProgress");let s=e;pe&&(clearInterval(pe),pe=null),n&&(n.style.width="100%",n.style.transition="none",n.offsetHeight,n.style.transition=`width ${e}s linear`,n.style.width="0%"),pe=setInterval(()=>{const r=(Date.now()-t.questionStartTime)/1e3;s=Math.max(0,e-r),s<=0&&(clearInterval(pe),pe=null,console.log("[TRIVIA] Time's up!"),Gr())},100),console.log("[TRIVIA] Timer started for",e,"seconds")}function Gr(){if(!G)return;if(G.currentQuestionLocked){console.log("[TRIVIA] Timer expired, answer already processed, showing scoreboard..."),Is();return}console.log("[TRIVIA] Timer expired with no answer, processing as incorrect..."),Ss(null,{fromTimer:!0})}function Ss(t,e={}){if(!G){console.error("[TRIVIA] No active game");return}const n=G,{questions:s,currentIndex:r,maxTimePerQuestion:o}=n;if(n.currentQuestionLocked){console.log("[TRIVIA] Question already locked, ignoring duplicate answer");return}const i=s[r];if(!i){console.error("[TRIVIA] No question at index",r);return}const a=Date.now(),l=n.questionStartTime?a-n.questionStartTime:o*1e3,c=t!==null&&t===i.correctIndex;console.log("[TRIVIA] === Answer Selected ==="),console.log("[TRIVIA] Selected:",t,"Correct:",i.correctIndex),console.log("[TRIVIA] Is correct:",c),console.log("[TRIVIA] Response time:",(l/1e3).toFixed(2),"s");const{points:u,basePoints:f,streakBonus:d,newStreak:g}=_n({correct:c,responseTimeMs:l,questionTimerSec:o,basePoints:1e3,currentStreak:n.streak});n.streak=g,c&&(n.correctCount+=1),n.score+=u,n.currentQuestionLocked=!0,console.log("[TRIVIA] Points earned:",u),console.log("[TRIVIA] New total score:",n.score),console.log("[TRIVIA] New streak:",n.streak),zr(c,u,f,d,i.correctIndex);const p=document.getElementById("ogScoreDisplay"),h=document.getElementById("ogStreakDisplay");p&&(p.textContent=`Score: ${n.score}`),h&&(h.textContent=`Streak: ${n.streak} üî•`),e.fromTimer&&Is()}function zr(t,e,n,s,r){console.log("[TRIVIA] Showing feedback:",t?"‚úì CORRECT":"‚úó WRONG","Points:",e);const o=document.getElementById("ogChoices");o&&o.querySelectorAll("button").forEach((u,f)=>{u.disabled=!0,u.style.cursor="not-allowed",f===r&&(u.style.background="rgba(57, 255, 136, 0.3)",u.style.borderColor="var(--accent)",u.style.borderWidth="3px")});const i=document.getElementById("ogScoringBreakdown");i&&(t?i.innerHTML=`
        <div style="background: rgba(57, 255, 136, 0.08); border: 1px solid var(--accent); border-radius: 8px; padding: 10px; margin: 12px 0;">
          <div style="font-size: 1rem; font-weight: 700; color: var(--accent); margin-bottom: 4px;">
            ‚úì CORRECT! +${e} pts
          </div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            Base: ${n} | Streak: ${s}
          </div>
        </div>
      `:i.innerHTML=`
        <div style="background: rgba(255, 87, 87, 0.08); border: 1px solid #ff5757; border-radius: 8px; padding: 10px; margin: 12px 0;">
          <div style="font-size: 1rem; font-weight: 700; color: #ff5757; margin-bottom: 4px;">
            ‚úó INCORRECT - 0 pts
          </div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            Streak reset
          </div>
        </div>
      `);const a=document.getElementById("ogScoreDisplay"),l=document.getElementById("ogStreakDisplay");a&&(a.textContent=`Score: ${G.score}`),l&&(l.textContent=`Streak: ${G.streak} üî•`)}function Is(){var u;if(!G||G.awaitingScoreboard){console.log("[SCOREBOARD] Already awaiting scoreboard or no active game");return}const t=G;t.awaitingScoreboard=!0;const{currentIndex:e,questions:n,score:s,lobby:r}=t,o=e+1,i=n.length,a=o===i;console.log(`[SCOREBOARD] Showing scoreboard for question ${o}/${i}`),console.log("[SCOREBOARD] Lobby data:",r),console.log("[SCOREBOARD] Lobby participants:",r==null?void 0:r.participants),console.log("[SCOREBOARD] Participants count:",(u=r==null?void 0:r.participants)==null?void 0:u.length),console.log("[SCOREBOARD] Is last question:",a);const l=document.getElementById("ogQuestionView"),c=document.getElementById("ogLeaderboardView");if(l&&(l.style.display="none"),c){c.style.display="flex";const f=document.getElementById("ogLeaderboard");if(f){let d="";if(r&&r.participants&&r.participants.length>0){console.log("[SCOREBOARD] Building multiplayer leaderboard with",r.participants.length,"players"),console.log("[SCOREBOARD] Participants:",r.participants);const g=r.participants.map(p=>{if(p.isBot){const h=Math.floor(Math.random()*1e3)-500,y=Math.max(0,s+h);return console.log("[SCOREBOARD] Bot player:",p.username,"Score:",y),{username:p.username,score:y,isBot:!0,isUser:!1}}else return console.log("[SCOREBOARD] Real player:",p.username,"Score:",s),{username:p.username,score:s,isBot:!1,isUser:!0}});g.sort((p,h)=>h.score-p.score),console.log("[SCOREBOARD] Sorted players:",g),d=`
          <div style="padding: 24px 20px; max-width: 500px; margin: 0 auto;">
            <div style="font-size: 1.5rem; font-weight: 900; color: var(--accent2); margin-bottom: 12px; text-align: center;">
              Question ${o}/${i} Complete
            </div>
            ${a?'<div style="font-size: 1rem; color: var(--muted); margin-bottom: 20px; text-align: center;">Final Results</div>':'<div id="scoreboard-countdown" style="font-size: 1.2rem; font-weight: 700; color: var(--accent); margin-bottom: 20px; text-align: center;">Next question in <span id="countdown-seconds">4</span>s</div>'}
            <div style="background: var(--card); border-radius: 12px; padding: 16px; border: 1px solid var(--line);">
              ${g.map((p,h)=>{const y=p.isUser;return`
                  <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; margin-bottom: 8px; background: ${y?"rgba(57, 255, 136, 0.1)":"transparent"}; border: 1px solid ${y?"var(--accent)":"transparent"}; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <span style="font-size: 1.2rem; font-weight: 900; color: var(--muted); min-width: 24px;">${(h===0?"ü•á":h===1?"ü•à":h===2?"ü•â":"")||h+1}</span>
                      <span style="font-size: 1rem; font-weight: ${y?"700":"600"}; color: var(--txt);">${p.username}</span>
                    </div>
                    <span style="font-size: 1.1rem; font-weight: 700; color: ${y?"var(--accent)":"var(--txt)"}">${Math.round(p.score)}</span>
                  </div>
                `}).join("")}
            </div>
          </div>
        `}else console.log("[SCOREBOARD] No lobby data or single player mode"),d=`
          <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 2rem; font-weight: 900; color: var(--accent2); margin-bottom: 16px;">
              Question ${o}/${i}
            </div>
            <div style="font-size: 1.5rem; font-weight: 700; color: var(--txt); margin-bottom: 8px;">
              Your Score: ${s}
            </div>
            ${a?'<div style="font-size: 1rem; color: var(--muted);">Game Complete!</div>':'<div id="scoreboard-countdown" style="font-size: 1rem; color: var(--muted);">Next question in <span id="countdown-seconds">4</span>s</div>'}
          </div>
        `;if(f.innerHTML=d,console.log("[SCOREBOARD] Leaderboard HTML set, length:",d.length),!a){let g=4;const p=document.getElementById("countdown-seconds"),h=setInterval(()=>{g--,p&&g>0?p.textContent=g:clearInterval(h)},1e3)}}}setTimeout(a?()=>{console.log("[SCOREBOARD] Last question completed, finishing session..."),Ts()}:()=>{console.log("[SCOREBOARD] Advancing to next question..."),c&&(c.style.display="none"),l&&(l.style.display="flex"),t.currentIndex+=1,t.currentQuestionLocked=!1,t.awaitingScoreboard=!1,Es()},4e3)}function Ts(){if(!G){console.error("[TRIVIA] No active session to finish");return}const t=G,{mode:e,categoryKey:n,score:s,correctCount:r,questions:o,onComplete:i}=t;console.log("[TRIVIA] === SESSION FINISHED ==="),console.log("[TRIVIA] Mode:",e),console.log("[TRIVIA] Category:",n),console.log("[TRIVIA] Final score:",s),console.log("[TRIVIA] Correct:",r,"/",o.length);const a={mode:e,categoryKey:n,score:s,correctCount:r,correctAnswers:r,totalQuestions:o.length};$t(),typeof activeMatchMode<"u"&&(console.log("[TRIVIA] Clearing activeMatchMode (was:",activeMatchMode,")"),activeMatchMode=null),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),typeof i=="function"&&i(s,a)}function ks(){let t=document.getElementById("offline-mode-banner");if(t){t.style.display="block";return}t=document.createElement("div"),t.id="offline-mode-banner",t.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    color: white;
    padding: 12px 20px;
    text-align: center;
    font-weight: 700;
    font-size: 0.9rem;
    z-index: 100000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  `,t.innerHTML=`
    <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
    <span>OFFLINE MODE: Using fallback questions (limited variety)</span>
  `,document.body.appendChild(t),console.log("[OFFLINE-BANNER] Offline mode banner displayed")}function As(){const t=document.getElementById("offline-mode-banner");t&&(t.style.display="none",console.log("[OFFLINE-BANNER] Offline mode banner hidden"))}window.getQuestionsForSession=jr;window.startTriviaSession=bs;window.cleanupTriviaSession=$t;window.exitTriviaSession=Hr;window.calculateBrainDashScore=_n;window.showOfflineBanner=ks;window.hideOfflineBanner=As;window.startTriviaEngine=bs;window.calculateKahootStyleScore=_n;console.log("[Trivia Engine] ‚úì Unified trivia engine loaded successfully");console.log("[Trivia Engine] Available functions:",["getQuestionsForSession","startTriviaSession","cleanupTriviaSession","exitTriviaSession","calculateBrainDashScore"]);console.log("Freeplay flow loaded");document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("guestBtn"),e=document.getElementById("freeSheet");document.getElementById("freeplaySetup");const n=document.getElementById("offlineStepBots");t&&t.addEventListener("click",()=>{console.log("[Freeplay] Guest button clicked"),e&&(e.style.display="none",e.setAttribute("aria-hidden","true")),n&&(n.style.display="grid",n.setAttribute("aria-hidden","false"))})});(function(){console.log("[Offline Wizard] Initializing...");function t(m){const _=Math.trunc(m*1e3+(m>=0?.5:-.5))/1e3;return Number(_.toFixed(3))}function e(m,_=7e3){if(m<=1)return 100;const I=100/_;return Math.max(0,100-I*(m-1))}function n(m,_=!1){const I=t(e(m)),U=t(I*1);return t(U+(_?5:0))}const s=m=>document.querySelector(m),r=m=>Array.from(document.querySelectorAll(m)),o="bd-wizard-errors";function i(m){const _=(m==null?void 0:m.message)||(m==null?void 0:m.toString())||String(m);console.error("[Offline Wizard Error]",_);try{let I=document.getElementById(o);I||(I=document.createElement("pre"),I.id=o,I.style.cssText="position:fixed;bottom:8px;left:8px;z-index:9999;background:#240;color:#fff;padding:8px 10px;border-radius:8px;max-width:60vw;max-height:40vh;overflow:auto;font:12px/1.3 ui-monospace,monospace;",document.body.appendChild(I)),I.textContent="[Offline Wizard Error] "+_}catch(I){console.error("[Offline Wizard] Could not display error:",I)}}const a={bots:s("#offlineStepBots"),rounds:s("#offlineStepRounds"),difficulty:s("#offlineStepDifficulty"),categories:s("#offlineStepCategories")},l={backBots:s("#offBackBots"),homeBots:s("#offHomeBots"),backRounds:s("#offBackRounds"),homeRounds:s("#offHomeRounds"),backDiff:s("#offBackDiff"),homeDiff:s("#offHomeDiff"),backCats:s("#offBackCats"),homeCats:s("#offHomeCats"),nextFromBots:s("#nextFromBots"),nextFromRounds:s("#nextFromRounds"),nextFromDiff:s("#nextFromDiff"),startGame:s("#startOfflineWizard")},c={botsInput:s("#botsInput"),roundsInput:s("#roundsInput"),elimStart:s("#elimStartInput"),catsGrid:s("#catsGrid")},u={HOME:"home",BOTS:"bots",ROUNDS:"rounds",DIFF:"difficulty",CATS:"categories"};let f=[];const d={mode:"offline",players:{human:1,bots:3},rounds:5,difficulty:"normal",eliminationEnabled:!0,elimination:{startRound:3,perRound:1,schedule:[]},categories:[]},g=m=>{m&&(m.style.display="grid",m.setAttribute("aria-hidden","false"))},p=m=>{m&&(m.style.display="none",m.setAttribute("aria-hidden","true"))},h=()=>{Object.values(a).forEach(p)},y=(m,_,I)=>Math.min(I,Math.max(_,m)),w=(m,_)=>{const I=m-2,E=_-I+1;return Math.max(2,Math.min(E,_))},v=(m,_,I)=>{const E=[];let U=m;for(let B=1;B<=_;B++){let z=0;B>=I&&U>2&&(z=1,U-=1),E.push({round:B,eliminate:z,playersRemaining:U})}return console.log("[Elimination Schedule]",{totalPlayers:m,totalRounds:_,startRound:I,finalPlayers:U,schedule:E}),E},b=(m,_)=>{if(!Array.isArray(m)||m.length===0)return Array(_).fill(null);const I=[...new Set(m)],E=I.length,U=Math.floor(_/E);let B=_%E;const z=I.map(()=>U);for(let L=0;L<B;L++)z[L]++;const K=[];I.forEach((L,te)=>{for(let P=0;P<z[te];P++)K.push(L)});for(let L=K.length-1;L>0;L--){const te=Math.floor(Math.random()*(L+1));[K[L],K[te]]=[K[te],K[L]]}return K},T=()=>{const m=f[f.length-1]||u.HOME;console.log("[Offline Wizard] Current state:",m),h(),m===u.BOTS?g(a.bots):m===u.ROUNDS?g(a.rounds):m===u.DIFF?g(a.difficulty):m===u.CATS&&g(a.categories)},$=m=>{f[f.length-1]!==m&&f.push(m),T()},R=()=>{f.length>1?(f.pop(),T()):O()},O=()=>{var _;f=[],h();const m=s("#offlineGame");if(m){m.classList.add("hidden"),m.style.display="none";const I=m.querySelector("#ogQuestionView"),E=m.querySelector("#ogLeaderboardView");I&&(I.style.display="none"),E&&(E.style.display="none")}document.body.style.overflow="",window.QuestionTimer&&window.QuestionTimer.hide(),(_=window.__questionLoader__)!=null&&_.clearAllQuestionBanks&&window.__questionLoader__.clearAllQuestionBanks(),window.hideEliminationBanner&&window.hideEliminationBanner(),typeof Ue<"u"&&(Ue=!1),typeof Te<"u"&&(Te=!1),console.log("[Offline Wizard] Returned to home, all state reset")};function ee(){return{screen:s("#offlineGame"),back:s("#ogBackToMenu"),round:s("#ogRoundLabel"),cat:s("#ogCategoryLabel"),prompt:s("#ogPrompt"),choices:"#ogChoices",questionView:s("#ogQuestionView"),leaderboardView:s("#ogLeaderboardView"),leaderboard:s("#ogLeaderboard")}}function de(){const m=["Swift","Clever","Mighty","Quick","Smart","Brave","Bold","Wise","Fast","Sharp"],_=["Fox","Eagle","Tiger","Wolf","Hawk","Bear","Lion","Panther","Falcon","Dragon"],I=m[Math.floor(Math.random()*m.length)],E=_[Math.floor(Math.random()*_.length)];return`${I}${E}${Math.floor(Math.random()*99)+1}`}function Qs(m){const _=[{id:"human",name:"You",isHuman:!0,score:0,correctAnswers:0,streak:0}];for(let I=0;I<m.players.bots;I++)_.push({id:`bot${I+1}`,name:de(),isHuman:!1,score:0,correctAnswers:0,streak:0});return _}function Js(m){const I={Easy:.5,easy:.5,Medium:.625,medium:.625,normal:.625,Hard:.65,hard:.65}[m]||.625;return Math.random()<I}function Ys(m){const _=(m||"normal").toLowerCase();return _==="easy"?3e3+Math.random()*5e3:_==="medium"||_==="normal"?2e3+Math.random()*4e3:1500+Math.random()*3500}function Xs(m){const _=ee();if(!_.leaderboard)return;const I=[...m].sort((E,U)=>U.score!==E.score?U.score-E.score:U.correctAnswers-E.correctAnswers);_.leaderboard.innerHTML=I.map((E,U)=>{const B=U+1,z=B===1?"ü•á":B===2?"ü•à":B===3?"ü•â":`${B}.`,K=E.isHuman?"rgba(57, 255, 136, 0.15)":"rgba(255, 255, 255, 0.03)",L=E.isHuman?"var(--accent2)":"var(--line)";return`
        <div style="background:${K};border:2px solid ${L};border-radius:12px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between">
          <div style="display:flex;align-items:center;gap:16px">
            <span style="font-size:24px;font-weight:700;min-width:40px">${z}</span>
            <div>
              <div style="font-weight:700;font-size:18px;color:var(--txt)">${E.name}</div>
              <div style="font-size:14px;color:var(--muted)">${E.correctAnswers} correct</div>
            </div>
          </div>
          <div style="font-size:28px;font-weight:700;color:var(--accent2)">${E.score.toFixed(3)}</div>
        </div>
      `}).join("")}const Pn=(m,_,I)=>{r(m+" .wizard-tile").forEach(E=>{E.getAttribute(_)===I?E.classList.add("wizard-tile-selected"):E.classList.remove("wizard-tile-selected")})};r("#offlineStepBots .wizard-tile[data-val]").forEach(m=>{m.addEventListener("click",()=>{const _=parseInt(m.dataset.val,10);c.botsInput.value=y(_,1,15),Pn("#offlineStepBots","data-val",String(_))})}),l.nextFromBots&&l.nextFromBots.addEventListener("click",()=>{const m=y(parseInt(c.botsInput.value,10)||3,1,15);d.players.bots=m,console.log("[Offline Wizard] Bots selected:",m),jt(),$(u.ROUNDS)}),r("#offlineStepRounds .wizard-tile[data-val]").forEach(m=>{m.addEventListener("click",()=>{const _=parseInt(m.dataset.val,10);c.roundsInput.value=y(_,3,20),Pn("#offlineStepRounds","data-val",String(_))})}),l.nextFromRounds&&l.nextFromRounds.addEventListener("click",()=>{const m=y(parseInt(c.roundsInput.value,10)||5,3,20);d.rounds=m,console.log("[Offline Wizard] Rounds selected:",m),jt(),$(u.DIFF)});const nt=s("#elimToggle"),$n=s("#elimPreview"),Ln=s("#elimStartPreview"),jt=()=>{const m=1+d.players.bots,_=w(m,d.rounds),I=m-2;Ln&&(Ln.textContent=String(_)),$n&&($n.style.display=d.eliminationEnabled?"flex":"none"),console.log("[Offline Wizard] Elim preview:",{totalPlayers:m,rounds:d.rounds,startRound:_,eliminationsNeeded:I,finalPlayers:2,enabled:d.eliminationEnabled})};nt&&nt.addEventListener("click",()=>{d.eliminationEnabled=!d.eliminationEnabled,nt.textContent=d.eliminationEnabled?"ON":"OFF",nt.classList.toggle("toggle-on",d.eliminationEnabled),nt.classList.toggle("toggle-off",!d.eliminationEnabled),jt()}),r("#offlineStepDifficulty .wizard-tile[data-diff]").forEach(m=>{m.addEventListener("click",()=>{r("#offlineStepDifficulty .wizard-tile").forEach(_=>{_.classList.remove("wizard-tile-selected")}),m.classList.add("wizard-tile-selected")})}),l.nextFromDiff&&l.nextFromDiff.addEventListener("click",()=>{const m=s("#offlineStepDifficulty .wizard-tile.wizard-tile-selected");d.difficulty=(m==null?void 0:m.dataset.diff)||"normal",console.log("[Offline Wizard] Difficulty:",d.difficulty,"Elimination enabled:",d.eliminationEnabled),$(u.CATS)}),c.catsGrid&&c.catsGrid.addEventListener("click",m=>{const _=m.target.closest(".wizard-tile[data-cat]");if(!_)return;if((_.dataset.cat??"")==="")r("#catsGrid .wizard-tile").forEach(E=>E.classList.remove("wizard-tile-selected")),_.classList.add("wizard-tile-selected");else{const E=s('#catsGrid .wizard-tile[data-cat=""]');E&&E.classList.remove("wizard-tile-selected"),_.classList.toggle("wizard-tile-selected")}});async function Zs(m,_,I){const E=ee();if(!E.prompt||!s(E.choices))return console.error("[Offline Wizard] Game elements not found"),{userCorrect:!1};E.questionView.style.display="flex",E.leaderboardView.style.display="none",E.prompt.textContent=m.prompt;const U=s(E.choices);U.innerHTML="";let B=!1,z=!1,K=0;(m.choices||[]).forEach((x,Q)=>{const N=document.createElement("button");N.className="btn",N.textContent=x,N.addEventListener("click",()=>{B||(B=!0,K=Date.now(),z=Q===m.correct_index-1,r(E.choices+" .btn").forEach(X=>X.disabled=!0),z?(N.style.outline="3px solid #2ea043",N.style.background="rgba(46, 160, 67, 0.2)"):(N.style.outline="3px solid #9e2a2b",N.style.background="rgba(158, 42, 43, 0.2)"))}),U.appendChild(N)});const L=m.time_limit_ms||7e3,te=s("#ogTimerProgress");if(te){te.style.width="100%",te.style.background="#00eaff";const x=Date.now();m.startTime=x;const Q=setInterval(()=>{const N=Date.now()-x,X=Math.max(0,L-N),Ae=X/L*100;te.style.width=Ae+"%",Ae<30?te.style.background="#ff4444":Ae<60&&(te.style.background="#ffd700"),X<=0&&clearInterval(Q)},100);await new Promise(N=>setTimeout(N,L)),clearInterval(Q),te.style.width="0%"}else m.startTime=Date.now(),await new Promise(x=>setTimeout(x,L));window.QuestionTimer&&window.QuestionTimer.hide(),r(E.choices+" .btn").forEach((x,Q)=>{x.disabled=!0,Q===m.correct_index-1&&(x.style.outline="3px solid #2ea043")});const P=I.find(x=>x.isHuman);if(z&&K>0){const x=K-m.startTime,Q=Math.max(0,(L-x)/1e3),N=L/1e3,X=window.calculateKahootStyleScore?window.calculateKahootStyleScore({correct:!0,timeRemaining:Q,maxTime:N,currentStreak:P.streak}):n(x,!1);P.score+=X,P.correctAnswers+=1,P.streak+=1,P.lastPoints=X,console.log("[Offline Wizard] Human scored",X,"points. Streak:",P.streak,"Total:",P.score)}else!z&&B&&(P.streak=0,console.log("[Offline Wizard] Human answered incorrectly. Streak reset."));return I.forEach(x=>{if(!x.isHuman)if(Js(_.difficulty)){const N=Ys(_.difficulty),X=Math.max(0,(L-N)/1e3),Ae=L/1e3,Z=window.calculateKahootStyleScore?window.calculateKahootStyleScore({correct:!0,timeRemaining:X,maxTime:Ae,currentStreak:x.streak}):n(N,!1);x.score+=Z,x.correctAnswers+=1,x.streak+=1}else x.streak=0}),{userCorrect:z,userAnswered:B,userAnswerTime:K}}async function qt(m){var _,I,E,U;console.log("[Offline Wizard] Starting match with config:",m);try{h();const B=ee();if(!B.screen){console.error("[Offline Wizard] Game screen not found");return}document.body.style.overflow="hidden",B.screen.classList.remove("hidden"),B.screen.style.display="flex",Ue=!0,Te=!1;const z=Qs(m);for(let P=1;P<=m.rounds;P++){if(Te){console.log("[Offline Wizard] Game interrupted by user");break}console.log(`[Offline Wizard] Starting round ${P}/${m.rounds}`);try{B.round.textContent=`Round ${P} / ${m.rounds}`;const x=Array.isArray(m.categoryPlan)?m.categoryPlan[P-1]:null;B.cat.textContent=x||"Any",(I=(_=m.elimination)==null?void 0:_.banner)!=null&&I.enabled&&P===m.elimination.banner.fireOnRound&&window.showEliminationBanner&&await new Promise(Z=>{window.showEliminationBanner(m.elimination.banner.text,5e3),setTimeout(Z,5e3)});const Q=x?[x]:(E=m.categories)!=null&&E.length?m.categories:[];console.log("[Offline Wizard] Round",P,"planCat:",x,"categories for question:",Q);let N=null,X=!1;if(window.nextQuestion)try{const Z=await window.nextQuestion({categories:Q,difficulty:m.difficulty});if(N=Z==null?void 0:Z.question,X=Z==null?void 0:Z.done,X||!N){const Wt=await window.nextQuestion({categories:[],difficulty:null});N=(Wt==null?void 0:Wt.question)||null}}catch(Z){console.error("[Offline Wizard] Question fetch error:",Z),N=null}if(!N){B.prompt.textContent="No questions available. Try different categories.",await new Promise(Z=>setTimeout(Z,3e3)),O();return}await Zs(N,m,z),B.questionView.style.display="none",B.leaderboardView.style.display="flex",Xs(z);const Ae=3e3;await new Promise(Z=>setTimeout(Z,Ae))}catch(x){i(x),await new Promise(Q=>setTimeout(Q,2e3)),O();return}}window.QuestionTimer&&window.QuestionTimer.hide();const K=((U=m.elimination)==null?void 0:U.schedule)||[],L=K[K.length-1],te=(L==null?void 0:L.playersRemaining)||2;if(console.log("[Offline Wizard] Game complete!",{finalPlayers:te,eliminationEnabled:m.eliminationEnabled}),typeof ke=="function"){const P=z.find(X=>X.isHuman||X.id==="human"),x=P?P.score:0,Q=P?P.correctAnswers:0;console.log("[Offline Wizard] Test Cash mode complete. User Kahoot score:",x,"Correct:",Q);const N=ke;ke=null,Dn=null,N(x,{correctAnswers:Q});return}window.showEliminationBanner&&(m.eliminationEnabled&&te===2?(window.showEliminationBanner("üèÜ Rounds complete! 2 finalists remain. Championship round starting‚Ä¶ (Best of 3)",5e3),await new Promise(P=>setTimeout(P,5e3))):(window.showEliminationBanner("üéâ Game complete! Thanks for playing!",3e3),await new Promise(P=>setTimeout(P,3e3)))),O()}catch(B){i(B),await new Promise(z=>setTimeout(z,2e3)),O()}finally{Ue=!1,Te=!1}}l.startGame&&l.startGame.addEventListener("click",()=>{try{const _=r("#catsGrid .wizard-tile.wizard-tile-selected").map(E=>E.dataset.cat).filter(E=>E!==void 0);d.categories=_.includes("")||_.length===0?[]:_;const I=1+d.players.bots;if(d.eliminationEnabled){const E=w(I,d.rounds);d.elimination.startRound=E,d.elimination.perRound=1,d.elimination.schedule=v(I,d.rounds,E),d.elimination.banner={enabled:!0,text:`Elimination begins on Round ${E}. From now on, the lowest scorer is eliminated each round.`,fireOnRound:E}}else d.elimination.startRound=null,d.elimination.perRound=0,d.elimination.schedule=Array.from({length:d.rounds},(E,U)=>({round:U+1,eliminate:0,playersRemaining:I})),d.elimination.banner={enabled:!1};d.championship={enabled:!0,format:"bo3",startsAfterRound:d.rounds},d.categoryPlan=b(d.categories,d.rounds),console.log("[Offline Wizard] Final config:",d),console.log("[Offline Wizard] Elimination schedule:",d.elimination.schedule),d.elimination.banner.enabled&&console.log("[Offline Wizard] Banner:",d.elimination.banner),console.log("[Offline Wizard] Championship:",d.championship),console.log("[Offline Wizard] Category plan:",d.categoryPlan);try{sessionStorage.setItem("bd.offline.config",JSON.stringify(d))}catch(E){console.warn("[Offline Wizard] Could not save config:",E)}typeof window.showCountdown=="function"?window.showCountdown(5,()=>{try{qt(d)}catch(E){i(E)}}):(console.log("[Offline Wizard] No countdown available, starting game directly"),qt(d))}catch(m){i(m)}}),l.backBots&&l.backBots.addEventListener("click",R),l.homeBots&&l.homeBots.addEventListener("click",O),l.backRounds&&l.backRounds.addEventListener("click",R),l.homeRounds&&l.homeRounds.addEventListener("click",O),l.backDiff&&l.backDiff.addEventListener("click",R),l.homeDiff&&l.homeDiff.addEventListener("click",O),l.backCats&&l.backCats.addEventListener("click",R),l.homeCats&&l.homeCats.addEventListener("click",O);let Ue=!1,Te=!1;const Nn=s("#ogBackToMenu");Nn&&Nn.addEventListener("click",()=>{if(Ue){if(!window.confirm("Are you sure you want to exit? Your progress will be lost."))return;Te=!0}window.QuestionTimer&&window.QuestionTimer.hide(),Ue=!1,Te=!1,O()}),window.startOfflineWizard=()=>{console.log("[Offline Wizard] Starting wizard flow"),f=[u.BOTS],T()};let ke=null,Dn=null;window.startOfflineMatch=async(m,_)=>{console.log("[Offline Wizard] === RECEIVED CONFIG ==="),console.log("[Offline Wizard] Mode:",m.mode),console.log("[Offline Wizard] categories:",m.categories),console.log("[Offline Wizard] categoryPlan:",m.categoryPlan),console.log("[Offline Wizard] Full config:",m),ke=_;try{Dn=null,await qt(m)}catch(I){console.error("[Offline Wizard] Match error:",I),typeof ke=="function"&&(ke(0),ke=null)}},O(),window.addEventListener("bd:error",m=>{var I;const _=((I=m.detail)==null?void 0:I.error)||"Unknown error";i("[API] "+_)}),console.log("[Offline Wizard] Initialized successfully")})();const Vr=!0,Cs={Politics:"politics","Business & Economics":"business",Sports:"sports",Music:"music",Movies:"movies",History:"history",Geography:"geography",Science:"science","Pop Culture":"pop_culture",Math:"math"};function Kr({correct:t,timeRemaining:e,maxTime:n,currentStreak:s}){if(!t)return 0;const r=1e3,o=Math.max(0,Math.min(e,n)),i=n>0?o/n:0,a=Math.round(r*i),l=Math.min(s*100,500),c=a+l;return console.log("[SCORING] correct:",t,"timeRemaining:",e,"currentStreak:",s,"=> base:",a,"streakBonus:",l,"total:",c),c}window.calculateKahootStyleScore=Kr;const C={id:"user-test-1",username:"You",balance:100},ut=[{id:"bot-1",username:"Bot Blake",balance:80},{id:"bot-2",username:"Bot Nova",balance:150},{id:"bot-3",username:"Bot Pixel",balance:200},{id:"bot-4",username:"Bot Turbo",balance:120}];let ie=[],it=null,ne=null,we=null,ve=null;const se={categories:[],stakes:[],sizes:[]};function Qr(){[{category:"Sports",stake:10,maxPlayers:2},{category:"Movies",stake:20,maxPlayers:2},{category:"Music",stake:10,maxPlayers:4},{category:"Science",stake:50,maxPlayers:2},{category:"Pop Culture",stake:10,maxPlayers:2}].forEach((e,n)=>{ie.push({id:`default-${n+1}`,hostId:"system",hostName:"BrainDash Auto Lobby",category:e.category,stake:e.stake,maxPlayers:e.maxPlayers,participants:[],status:"open",isDefault:!0})})}const Jr="https://dguhvsjrqnpeonfhotty.supabase.co",Yr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRndWh2c2pycW5wZW9uZmhvdHR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NDkxOTAsImV4cCI6MjA3OTIyNTE5MH0.VQ1LAy545BkKan70yHdnOup1y33BH4wm3w-bKq_qxAs",Je=gs(Jr,Yr),Vt=document.getElementById("toast"),Ct=document.getElementById("authSheet"),En=document.getElementById("freeSheet"),j=(t,e=3e3)=>{Vt.textContent=t,Vt.style.display="block",setTimeout(()=>Vt.style.display="none",e)},Sn=t=>{t.style.display="grid",t.setAttribute("aria-hidden","false")},Lt=t=>{t.style.display="none",t.setAttribute("aria-hidden","true")};let Ze=null,Nt=null;function Xr(t){console.log("[showScreen] Showing screen:",t),document.querySelectorAll(".screen").forEach(n=>{n.classList.add("hidden"),n.style.display="none"});const e=document.querySelector(".wrap");if(t==="home"&&e)e.style.display="flex",console.log("[showScreen] Showing homepage wrap");else{e&&(e.style.display="none",console.log("[showScreen] Hidden wrap element"));const n=document.getElementById(t);console.log("[showScreen] Found screen element:",n),n&&(n.classList.remove("hidden"),n.style.display="block",console.log("[showScreen] Screen display set to:",n.style.display),console.log("[showScreen] Screen classList:",n.classList.toString()))}t==="cash-test-screen"?(console.log("[showScreen] Starting bot simulation"),uo()):Os()}function Ne(t){if(console.log("[NAV] showScreen called",{target:t,activeMatchMode:Ze,activeMatchLobbyId:Nt}),Ze==="cash-test"&&["home","home-screen","main-menu"].includes(t)){console.warn("[NAV] ‚ùå BLOCKED navigation to",t,"during active cash-test match"),console.warn("[NAV] Match must complete or be exited before returning home");return}if(Ze==="cash-test"&&t==="cash-test-screen"){console.warn("[NAV] ‚ùå BLOCKED navigation to cash-test-screen during active match");return}console.log("[NAV] ‚úì Navigation allowed to",t),Xr(t)}function et(t){console.log("[hideScreen] Hiding screen:",t);const e=document.getElementById(t);e&&(e.classList.add("hidden"),e.style.display="none",console.log("[hideScreen] Screen hidden")),console.log("[FIX] NOT showing wrap - prevents unwanted home navigation"),t==="cash-test-screen"&&(console.log("[hideScreen] Stopping bot simulation"),Os())}function wt(){const t=document.getElementById("testBalance");t&&(t.textContent="$"+C.balance.toFixed(2))}function on({hostId:t,hostName:e,category:n,stake:s,maxPlayers:r,isBotHost:o}){const i=n,a=Cs[i]||null;console.log("[Test Cash] Creating lobby - categoryLabel:",i,"categoryKey:",a);const l={id:"lobby-"+Date.now()+"-"+Math.floor(Math.random()*9999),hostId:t,hostName:e,category:i,categoryLabel:i,categoryKey:a,stake:s,maxPlayers:r,participants:o?[{id:t,username:e,isBot:!0,hasAcceptedTerms:!0,isReady:!0}]:[],status:"open"};return ie.unshift(l),Ie(),l}function Rs(t,e){const n=ie.find(r=>r.id===t);if(!n)return console.error("[Join] Lobby not found:",t),!1;if(n.status!=="open"&&n.status!=="full")return console.error("[Join] Lobby status is",n.status,"- cannot join"),!1;if(n.participants.some(r=>r.id===e.id))return console.log("[Join] User already in lobby"),!1;if(n.participants.length>=n.maxPlayers)return console.log("[Join] Lobby is full (player count)"),!1;if(e.isBot){const r=ut.find(o=>o.id===e.id);r&&r.balance>=n.stake&&(r.balance-=n.stake)}else if(e.id===C.id){if(C.balance<n.stake)return!1;C.balance-=n.stake,wt()}const s=!!e.isBot;return n.participants.push({id:e.id,username:e.username,isBot:s,hasAcceptedTerms:s?!0:e.hasAcceptedTerms||!1,isReady:s?!0:e.isReady||!1}),e.id===C.id&&(ve=n.id,console.log("[Test Cash] User joined lobby:",n.id)),Ie(),n.participants.length>=n.maxPlayers&&(n.status="full"),De(n),In(n),!0}function Zr(t){if(console.log("[Lobby] Starting countdown for lobby:",t.id),!t.participants.some(n=>n.id===C.id)||ve!==t.id){console.log("[Test Cash] Skipping countdown for lobby",t.id,"because user is not in this lobby");return}De(t),t.status="in_progress",Ie(),eo(t)}function eo(t){if(!t.participants.some(i=>i.id===C.id)||ve!==t.id){console.log("[Test Cash] Skipping countdown display for lobby",t.id);return}const n=document.createElement("div");n.id="match-countdown-overlay",n.style.cssText=`
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  `,n.innerHTML=`
    <div style="text-align:center;max-width:600px;padding:40px">
      <h1 style="font-size:2.5rem;font-weight:900;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0 0 16px">Lobby Full!</h1>
      <div style="font-size:1.125rem;color:var(--muted);margin-bottom:32px">
        ${Tn(t.category)} ${t.category} ¬∑ $${t.stake} entry
      </div>
      <div style="font-size:1rem;color:var(--txt);margin-bottom:24px">Match starting in...</div>
      <div id="match-countdown-number" style="font-size:8rem;font-weight:900;color:var(--accent2);line-height:1;">3</div>
    </div>
  `,document.body.appendChild(n);let s=3;const r=document.getElementById("match-countdown-number"),o=setInterval(()=>{if(!t.participants.some(a=>a.id===C.id)||ve!==t.id){console.log("[Test Cash] User left lobby during countdown, stopping"),clearInterval(o),document.body.contains(n)&&document.body.removeChild(n);return}s--,s>0?(r.textContent=s,r.style.animation="none",setTimeout(()=>{r.style.animation="pulse 0.5s ease"},10)):(clearInterval(o),r.textContent="GO!",r.style.color="var(--accent)",setTimeout(()=>{document.body.removeChild(n),oo(t)},500))},1e3)}function an(t){ne=t;const e=ie.find(n=>n.id===t);e&&(De(e),Ne("lobby-details-screen"),we&&clearInterval(we),we=setInterval(()=>{const n=ie.find(s=>s.id===ne);(n&&n.status==="open"||n.status==="full")&&De(n)},1e3))}function De(t){if(!t)return;document.getElementById("lobbyDetailsIcon").textContent=Tn(t.category),document.getElementById("lobbyDetailsCategory").textContent=t.category,document.getElementById("lobbyDetailsHost").textContent=`Host: ${t.hostName}`,document.getElementById("lobbyDetailsStake").textContent=`$${t.stake}`,document.getElementById("lobbyDetailsPlayerCount").textContent=`(${t.participants.length}/${t.maxPlayers})`;const e=document.getElementById("lobbyDetailsStatus");t.status==="full"?(e.textContent="Lobby full! Preparing your match...",e.style.color="#FFC107"):t.participants.length<t.maxPlayers&&(e.textContent="Waiting for more players to join...",e.style.color="var(--muted)");const n=document.getElementById("lobbyDetailsPlayersList");n.innerHTML="",t.participants.forEach(o=>{const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:10px;padding:12px 16px",i.innerHTML=`
      <div style="display:flex;align-items:center;gap:12px">
        <div style="font-size:1.25rem">${o.isBot?"ü§ñ":"üë§"}</div>
        <div>
          <div style="font-size:0.9375rem;font-weight:600;color:var(--txt)">${o.username}</div>
          <div style="font-size:0.75rem;color:var(--muted)">${o.isBot?"Bot":"Player"}</div>
        </div>
      </div>
      ${o.isBot?"":'<div style="background:rgba(57,255,136,.1);border:1px solid rgba(57,255,136,.3);border-radius:6px;padding:4px 8px;font-size:0.75rem;font-weight:600;color:var(--accent)">YOU</div>'}
    `,n.appendChild(i)});const s=t.participants.some(o=>o.id===C.id),r=t.participants.length>=t.maxPlayers;if(document.getElementById("lobbyDetailsJoinSection").style.display=!s&&!r?"block":"none",document.getElementById("lobbyDetailsAlreadyJoined").style.display=s?"block":"none",document.getElementById("lobbyDetailsFull").style.display=!s&&r?"block":"none",s){const o=t.participants.find(i=>i.id===C.id);to(t,o)}}function to(t,e){if(!t||!e)return;const n=document.getElementById("lobby-terms-phase"),s=document.getElementById("lobby-ready-phase"),r=document.getElementById("lobby-waiting-phase"),o=t.participants.filter(a=>a.isReady).length,i=t.participants.length;if(!e.hasAcceptedTerms)n&&(n.style.display="block"),s&&(s.style.display="none"),r&&(r.style.display="none");else if(e.isReady){n&&(n.style.display="none"),s&&(s.style.display="none"),r&&(r.style.display="block");const a=document.getElementById("lobby-ready-status-waiting");a&&(a.textContent=`${o}/${i} players ready`)}else{n&&(n.style.display="none"),s&&(s.style.display="block"),r&&(r.style.display="none");const a=document.getElementById("lobby-ready-status");a&&(a.textContent=`${o}/${i} players ready`)}}function no(t){console.log("[LOBBY] User accepting terms",{lobbyId:t});const e=ie.find(s=>s.id===t);if(!e)return;const n=e.participants.find(s=>s.id===C.id);n&&(n.hasAcceptedTerms=!0,n.isReady=!1,console.log("[LOBBY] Terms accepted for user",C.id),De(e),In(e))}function so(t){console.log("[LOBBY] User ready up",{lobbyId:t});const e=ie.find(s=>s.id===t);if(!e)return;const n=e.participants.find(s=>s.id===C.id);if(!n){console.warn("[LOBBY] Participant not found in lobby");return}if(!n.hasAcceptedTerms){j("‚ö†Ô∏è You must accept the Terms & Conditions before readying up.");return}n.isReady=!0,console.log("[LOBBY] User marked as ready",C.id),De(e),In(e)}function In(t){if(!t)return;t.participants.forEach(r=>{r.isBot&&(r.hasAcceptedTerms=!0,r.isReady=!0)});const e=t.participants.some(r=>!r.isBot),n=t.participants.length>0&&t.participants.every(r=>r.hasAcceptedTerms),s=t.participants.length>0&&t.participants.every(r=>r.isReady);console.log("[LOBBY] checkLobbyAllReady",{lobbyId:t.id,hasRealUser:e,participants:t.participants.map(r=>({id:r.id,username:r.username,isBot:r.isBot,hasAcceptedTerms:r.hasAcceptedTerms,isReady:r.isReady})),allAccepted:n,allReady:s,status:t.status}),e&&n&&s&&(t.status==="open"||t.status==="full")?(console.log("[LOBBY] ‚úì All players accepted terms and ready! Starting countdown..."),t.status="countdown",Zr(t)):e||console.log("[LOBBY] ‚è∏Ô∏è Waiting for a real user to join before starting countdown")}function ro(t){const e=ie.find(s=>s.id===t);if(!e)return;const n=e.participants.findIndex(s=>s.id===C.id);n!==-1&&(e.participants.splice(n,1),C.balance+=e.stake,wt(),(e.status==="full"||e.status==="in_progress")&&e.participants.length<e.maxPlayers&&(e.status="open"),Ie(),console.log("[Lobby] User left lobby:",t),j("‚úì Left lobby. Stake refunded."),ve===t&&(ve=null,console.log("[Test Cash] User no longer in any lobby")),we&&clearInterval(we),ne=null,et("lobby-details-screen"),Ne("cash-test-screen"))}let Rt=null;function oo(t){if(console.log("[Test Cash] === startTestMatch called ==="),console.log("[Test Cash] Lobby ID:",t.id),console.log("[Test Cash] Category Key:",t.categoryKey),!t.participants.some(s=>s.id===C.id)||ve!==t.id){console.log("[Test Cash] Skipping match start - user not in lobby");return}Rt=t,Ze="cash-test",Nt=t.id,console.log("[FIX] Set activeMatchMode to cash-test and activeMatchLobbyId to",t.id),console.log("[Test Cash] Hiding all lobby screens"),we&&clearInterval(we),et("lobby-details-screen"),et("cash-test-screen");const n=document.querySelector(".wrap");n&&(n.style.display="none",console.log("[Test Cash] Hidden main wrap")),console.log("[DEBUG:CASH-COUNTDOWN] ========================================"),console.log("[DEBUG:CASH-COUNTDOWN] Countdown reached 0 for lobby:",t.id),console.log("[DEBUG:CASH-COUNTDOWN] Mode:",t.mode),console.log("[DEBUG:CASH-COUNTDOWN] Category:",t.categoryKey),console.log("[DEBUG:CASH-COUNTDOWN] Participants:",t.participants.length),console.log("[DEBUG:CASH-COUNTDOWN] Launching Test Cash match NOW"),console.log("[DEBUG:CASH-COUNTDOWN] ========================================"),console.log("[Test Cash] Calling startTestCashMatch..."),io(t)}async function io(t){if(console.log("[DEBUG:CASH-START] ========================================"),console.log("[DEBUG:CASH-START] startTestCashMatch called"),console.log("[DEBUG:CASH-START] Lobby ID:",t.id),console.log("[DEBUG:CASH-START] Mode:",t.mode),console.log("[DEBUG:CASH-START] Category Key (raw):",t.categoryKey),console.log("[DEBUG:CASH-START] Category Label:",t.categoryLabel||t.category),console.log("[DEBUG:CASH-START] Participants:",t.participants),console.log("[DEBUG:CASH-START] ========================================"),console.log("[CASH-TEST] ========================================"),console.log("[CASH-TEST] === STARTING MATCH ==="),console.log("[CASH-TEST] Lobby ID:",t.id),console.log("[CASH-TEST] Category Label:",t.categoryLabel||t.category),console.log("[CASH-TEST] Category Key (raw):",t.categoryKey),!t.categoryKey&&(t.categoryLabel||t.category)){const o=t.categoryLabel||t.category;t.categoryKey=Cs[o],console.log('[CASH-TEST] üîß Fixed missing categoryKey - mapped "'+o+'" to "'+t.categoryKey+'"')}if(console.log("[CASH-TEST] Category Key (final):",t.categoryKey),console.log("[CASH-TEST] ========================================"),!t.participants.some(o=>o.id===C.id)){console.log("[CASH-TEST] ‚ùå Not starting match - user not participant");return}if(console.log("[CASH-TEST] ‚úì User is participant"),console.log("[CASH-TEST] Checking for unified trivia engine..."),console.log("[CASH-TEST] - window.getQuestionsForSession:",typeof window.getQuestionsForSession),console.log("[CASH-TEST] - window.startTriviaSession:",typeof window.startTriviaSession),typeof window.getQuestionsForSession!="function"||typeof window.startTriviaSession!="function"){console.error("[CASH-TEST] ‚ùå Unified trivia engine not available!"),Hn(t);return}console.log("[CASH-TEST] ‚úì Unified trivia engine available");const n=t.categoryKey||"sports",s=10;console.log("[CASH-TEST] Using categoryKey:",n),console.log('[CASH-TEST] Calling getQuestionsForSession("'+n+'", '+s+") - ASYNC");const r=await window.getQuestionsForSession(n,s);if(console.log("[CASH-TEST] Questions returned:",r),console.log("[CASH-TEST] Questions length:",r?r.length:"null/undefined"),!r||r.length===0){console.error("[CASH-TEST] ‚ùå No questions available for category:",n),Hn(t);return}console.log("[CASH-TEST] ‚úì Loaded",r.length,"questions"),console.log("[CASH-TEST] First question preview:",r[0].question.substring(0,60)+"..."),console.log("[CASH-TEST] First question full:",r[0]),console.log("[DEBUG:CASH-START] ========================================"),console.log("[DEBUG:CASH-START] Questions loaded successfully"),console.log("[DEBUG:CASH-START] About to call window.startTriviaSession"),console.log("[DEBUG:CASH-START] - categoryKey:",n),console.log("[DEBUG:CASH-START] - questionCount:",r.length),console.log("[DEBUG:CASH-START] ========================================"),console.log("[CASH-TEST] ========================================"),console.log("[CASH-TEST] Calling startTriviaSession NOW"),console.log("[CASH-TEST] ========================================"),window.startTriviaSession({mode:"cash-test",categoryKey:n,questions:r,lobby:t,onComplete:(o,i)=>{console.log("[DEBUG:CASH-END] ========================================"),console.log("[DEBUG:CASH-END] Test Cash match completed"),console.log("[DEBUG:CASH-END] Lobby ID:",t.id),console.log("[DEBUG:CASH-END] Final score:",o),console.log("[DEBUG:CASH-END] Details:",i),console.log("[DEBUG:CASH-END] ========================================"),console.log("[CASH-TEST] Match completed! Score:",o),lo(o,i,t)}}),console.log("[DEBUG:CASH-START] startTriviaSession called - should start rendering shortly"),console.log("[CASH-TEST] startTriviaSession called successfully")}function Hn(t){console.log("[Test Cash] Using fallback match logic"),Ze=null,Nt=null,console.log("[Test Cash] Cleared active match flags for fallback");const e=t.stake*t.participants.length,n=t.participants.findIndex(o=>!o.isBot),s=Math.random()<.55&&n!==-1?n:Math.floor(Math.random()*t.participants.length),r=t.participants[s];if(r.isBot){const o=ut.find(i=>i.id===r.id);o&&(o.balance+=e)}else C.balance+=e;if(t.status="finished",t.winnerId=r.id,t.winnerName=r.username,wt(),Ie(),Ne("cash-test-screen"),t.participants.some(o=>o.id===C.id)){const o=r.id===C.id?`üéâ You WON this match! +$${e.toFixed(2)} (fake)`:`${r.username} won this match. You lost your $${t.stake.toFixed(2)} entry (fake).`;setTimeout(()=>{j(o,5e3)},500)}Rt=null}function ao(t){const e=(Math.random()-.5)*.8*t,n=Math.floor(t*.3);return Math.max(n,Math.round(t+e))}function lo(t,e,n){console.log("[Test Cash] Match complete. User Kahoot score:",t,"Details:",e),Ze=null,Nt=null,console.log("[FIX] Cleared activeMatchMode in onTestCashMatchComplete");const s=n||Rt;if(!s){console.error("[Test Cash] No active lobby found");return}console.log("[Test Cash] Using lobby:",s.id,"with",s.participants.length,"participants");const r=(e==null?void 0:e.correctAnswers)||0,o=[{id:C.id,username:C.username,score:t,correctCount:r,isBot:!1}];s.participants.forEach(u=>{if(u.isBot){const f=ao(t);o.push({id:u.id,username:u.username,score:f,isBot:!0})}}),o.sort((u,f)=>f.score-u.score);const i=o[0].score,a=o.filter(u=>u.score===i),l=a[Math.floor(Math.random()*a.length)];console.log("[Test Cash] Final results:",o.map(u=>`${u.username}: ${u.score}`).join(", "));const c=s.stake*s.participants.length;if(l.isBot){const u=ut.find(f=>f.id===l.id);u&&(u.balance+=c)}else C.balance+=c;s.status="finished",s.winnerId=l.id,s.winnerName=l.username,wt(),Ie(),ve===s.id&&(ve=null,console.log("[Test Cash] Match finished for lobby",s.id,"reset currentUserLobbyId")),Ne("cash-test-screen"),Rt=null,setTimeout(()=>{co(l.id===C.id,c,t,r,l)},500)}function co(t,e,n,s,r){const o=document.getElementById("match-end-modal"),i=document.getElementById("match-end-icon"),a=document.getElementById("match-end-title"),l=document.getElementById("match-end-message");if(!(!o||!i||!a||!l)){if(t)i.textContent="üéâ",a.textContent="Congratulations!",a.style.color="var(--accent)",l.innerHTML=`
      You won the match!<br>
      <strong style="color:var(--accent);font-size:1.3rem">+$${e.toFixed(2)}</strong> added to your balance<br>
      <span style="color:var(--muted);font-size:0.95rem">Score: ${Math.round(n)} pts (${s}/10 correct)</span>
    `;else{const c=Math.abs(Math.round(r.score)-Math.round(n));let u="Better luck next time!";c<500?u="You were so close!":c<1e3&&(u="Almost there!"),i.textContent="üòî",a.textContent=u,a.style.color="#ff5757",l.innerHTML=`
      ${r.username} won with ${Math.round(r.score)} pts<br>
      Your score: <strong>${Math.round(n)} pts</strong> (${s}/10 correct)<br>
      <span style="color:#ff5757;font-size:1.1rem">-$${e.toFixed(2)}</span>
    `}o.style.display="flex"}}function Kt(){const t=document.getElementById("match-end-modal");t&&(t.style.display="none")}function uo(){it||(it=setInterval(()=>{if(Math.random()<.5){const c=ie.filter(u=>u.status==="open"&&u.participants.length<u.maxPlayers);if(c.length>0){const u=c[Math.floor(Math.random()*c.length)],f=ut.filter(d=>d.balance>=u.stake&&!u.participants.some(g=>g.id===d.id));if(f.length>0){const d=f[Math.floor(Math.random()*f.length)];Rs(u.id,{...d,isBot:!0});return}}}const t=ut.filter(c=>c.balance>0);if(t.length===0)return;const e=t[Math.floor(Math.random()*t.length)];if(e.balance<=0)return;const n=["Politics","Business & Economics","Sports","Music","Movies","History","Geography","Science","Pop Culture"],s=n[Math.floor(Math.random()*n.length)],o=[1,10,20,50,100].filter(c=>c<=e.balance);if(o.length===0)return;const i=o[Math.floor(Math.random()*o.length)],a=[2,4],l=a[Math.floor(Math.random()*a.length)];e.balance>=i&&on({hostId:e.id,hostName:e.username,category:s,stake:i,maxPlayers:l,isBotHost:!0})},4e3))}function Os(){it&&(clearInterval(it),it=null)}function Tn(t){return{Politics:"üèõÔ∏è","Business & Economics":"üíº",Sports:"üèà",Music:"üéµ",Movies:"üé¨",History:"üìú",Geography:"üó∫Ô∏è",Science:"üî¨","Pop Culture":"‚≠ê"}[t]||"üéØ"}function Ie(){const t=document.getElementById("testLobbyList"),e=document.getElementById("emptyState"),n=document.getElementById("lobbyCount");if(!t||!n)return;let s=[...ie];if(se.categories.length>0&&(s=s.filter(r=>se.categories.includes(r.category))),se.stakes.length>0&&(s=s.filter(r=>se.stakes.includes(r.stake))),se.sizes.length>0&&(s=s.filter(r=>se.sizes.includes(r.maxPlayers))),n.textContent=`${s.length} ${s.length===1?"lobby":"lobbies"}`,s.length===0){if(t.innerHTML="",ie.length>0){const r=document.createElement("div");r.style.cssText="background:var(--card);border:1px dashed var(--line);border-radius:16px;padding:48px 24px;text-align:center",r.innerHTML=`
        <div style="font-size:3rem;margin-bottom:12px;opacity:0.5">üîç</div>
        <div style="font-size:1.125rem;font-weight:600;color:var(--muted);margin-bottom:8px">No lobbies match your filters</div>
        <div style="font-size:0.875rem;color:var(--dim)">Try changing the category, stake, or lobby size</div>
      `,t.appendChild(r)}else e&&(e.style.display="block",t.appendChild(e));return}e&&(e.style.display="none"),t.innerHTML="",s.forEach(r=>{const o=document.createElement("div");o.className="lobby-card";const i=r.status==="open"?"open":r.status==="in_progress"?"in-progress":"finished",a=r.status==="open"?"OPEN":r.status==="in_progress"?"IN PROGRESS":"FINISHED",l=r.participants.some(u=>u.id===C.id);r.status==="open"&&!l&&C.balance>=r.stake;let c="";r.status==="open"||r.status==="full"?c=`<button class="btn" style="padding:8px 20px;font-size:0.875rem" onclick="window.openLobbyDetailsWrapper('${r.id}')">View Lobby</button>`:c=`<button class="btn secondary" style="padding:8px 20px;font-size:0.875rem;opacity:0.5;cursor:not-allowed" disabled>${r.status==="in_progress"?"In Progress":"Finished"}</button>`,o.innerHTML=`
      <div style="display:flex;align-items:start;justify-content:space-between;margin-bottom:12px">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
            <span style="font-size:1.5rem">${Tn(r.category)}</span>
            <h3 style="font-size:1.25rem;font-weight:700;margin:0;color:var(--txt)">${r.category}</h3>
          </div>
          <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:8px">
            <span class="lobby-badge ${i}">${a}</span>
            <span style="font-size:0.875rem;color:var(--muted)">Host: ${r.hostName}</span>
          </div>
          ${r.status==="finished"?`<div style="font-size:0.875rem;color:var(--accent);font-weight:600">üèÜ Winner: ${r.winnerName}</div>`:""}
        </div>
        <div style="text-align:right">
          <div style="font-size:1.5rem;font-weight:700;color:var(--accent2);margin-bottom:4px">$${r.stake}</div>
          <div style="font-size:0.75rem;color:var(--muted)">entry fee</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding-top:12px;border-top:1px solid var(--line)">
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:0.875rem;color:var(--muted)">Players:</span>
          <span style="font-size:0.9375rem;font-weight:600;color:var(--txt)">${r.participants.length} / ${r.maxPlayers}</span>
        </div>
        ${c}
      </div>
    `,t.appendChild(o)})}window.openLobbyDetailsWrapper=function(t){an(t)};document.querySelectorAll(".close").forEach(t=>{t.addEventListener("click",e=>{const n=e.currentTarget.getAttribute("data-close"),s=document.getElementById(n);s&&Lt(s)})});[Ct,En].forEach(t=>{t.addEventListener("click",e=>{e.target===t&&Lt(t)})});let kn=null;{const t=document.getElementById("testCashBtn"),e=document.getElementById("testCashCard"),n=document.getElementById("testCashBackBtn"),s=document.getElementById("testCreateLobby"),r=document.getElementById("addTestFunds");t==null||t.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),console.log("[Test Mode] Opening Test Cash Challenge"),console.log("[Test Mode] Current TEST_CASH_MODE:",Vr),Ne("cash-test-screen"),console.log("[Test Mode] Screen shown")}),e==null||e.addEventListener("click",h=>{h.target!==t&&!t.contains(h.target)&&t.click()}),n==null||n.addEventListener("click",()=>{et("cash-test-screen")}),r==null||r.addEventListener("click",()=>{C.balance+=20,wt(),j("‚úì Added $20 to test balance!")}),document.querySelectorAll(".stake-quick-btn").forEach(h=>{h.addEventListener("click",()=>{const y=h.getAttribute("data-stake");document.getElementById("testStake").value=y,document.querySelectorAll(".stake-quick-btn").forEach(w=>w.classList.remove("active")),h.classList.add("active")})}),ie.length===0&&(Qr(),Ie());const o=document.getElementById("quickCashBtn");o==null||o.addEventListener("click",()=>{const h=C.balance>=10?10:C.balance>=1?1:null;if(!h){j("‚ö†Ô∏è Insufficient balance for Quick Cash Match");return}const y=["Politics","Business & Economics","Sports","Music","Movies","History","Geography","Science","Pop Culture"],w=y[Math.floor(Math.random()*y.length)],v=on({hostId:C.id,hostName:C.username,category:w,stake:h,maxPlayers:2,isBotHost:!1});j(`‚ö° Quick Cash Match created! ${w} ¬∑ $${h}`),setTimeout(()=>an(v.id),300)}),s==null||s.addEventListener("click",()=>{const h=document.getElementById("testCategory").value,y=parseInt(document.getElementById("testStake").value),w=parseInt(document.getElementById("testMaxPlayers").value),v=[1,10,20,50,100];if(!h||!y||!w){j("‚ö†Ô∏è Please fill in all fields");return}if(!v.includes(y)){j("‚ö†Ô∏è Stake must be $1, $10, $20, $50, or $100");return}if(y>C.balance){j("‚ö†Ô∏è Insufficient balance");return}if(w<2){j("‚ö†Ô∏è Max players must be at least 2");return}const b=on({hostId:C.id,hostName:C.username,category:h,stake:y,maxPlayers:w,isBotHost:!1});j("‚úì Lobby created!"),setTimeout(()=>an(b.id),300)}),document.querySelectorAll(".filter-pill").forEach(h=>{h.addEventListener("click",()=>{const y=h.getAttribute("data-type"),w=h.getAttribute("data-value");if(y==="category"){const v=se.categories.indexOf(w);v===-1?(se.categories.push(w),h.classList.add("active")):(se.categories.splice(v,1),h.classList.remove("active"))}else if(y==="stake"){const v=Number(w),b=se.stakes.indexOf(v);b===-1?(se.stakes.push(v),h.classList.add("active")):(se.stakes.splice(b,1),h.classList.remove("active"))}else if(y==="size"){const v=Number(w),b=se.sizes.indexOf(v);b===-1?(se.sizes.push(v),h.classList.add("active")):(se.sizes.splice(b,1),h.classList.remove("active"))}Ie()})});const i=document.getElementById("lobbyDetailsBackBtn"),a=document.getElementById("lobbyDetailsJoinBtn");console.log("[Init] lobbyDetailsJoinBtn element found:",a),a?console.log("[Init] Adding click listener to Join button"):console.error("[Init] Join button not found in DOM!"),i==null||i.addEventListener("click",()=>{const h=ie.find(w=>w.id===ne);if(h&&h.participants.some(w=>w.id===C.id)){const w=document.getElementById("leave-lobby-modal");w&&(w.style.display="flex")}else we&&clearInterval(we),ne=null,et("lobby-details-screen"),Ne("cash-test-screen")});const l=document.getElementById("confirmLeaveLobby"),c=document.getElementById("cancelLeaveLobby");l==null||l.addEventListener("click",()=>{const h=document.getElementById("leave-lobby-modal");h&&(h.style.display="none"),ne&&ro(ne)}),c==null||c.addEventListener("click",()=>{const h=document.getElementById("leave-lobby-modal");h&&(h.style.display="none")});const u=document.getElementById("match-end-home-btn"),f=document.getElementById("match-end-rematch-btn"),d=document.getElementById("match-end-deposit-btn");u==null||u.addEventListener("click",()=>{Kt(),et("cash-test-screen");const h=document.querySelector(".wrap");h&&(h.style.display="block"),Ne("fp-picker-screen")}),f==null||f.addEventListener("click",()=>{Kt(),j("Rematch feature coming soon!")}),d==null||d.addEventListener("click",()=>{Kt(),j("Deposit feature coming soon!")}),a?(a.addEventListener("click",()=>{if(console.log("[Join Button] ========== CLICKED =========="),console.log("[Join Button] currentLobbyId:",ne),console.log("[Join Button] testUser:",C),!ne){console.error("[Join Button] No currentLobbyId!"),j("‚ö†Ô∏è Error: No lobby selected");return}const h=ie.find(w=>w.id===ne);console.log("[Join Button] Found lobby:",h),console.log("[Join Button] User balance:",C.balance,"Lobby stake:",h==null?void 0:h.stake);const y=Rs(ne,{id:C.id,username:C.username,isBot:!1,hasAcceptedTerms:!1,isReady:!1});console.log("[Join Button] joinTestLobby returned:",y),j(y?"‚úì Joined lobby successfully!":"‚ö†Ô∏è Unable to join lobby")}),console.log("[Init] Join button click listener attached successfully")):console.error("[Init] Could not attach listener - button element is null");const g=document.getElementById("lobby-accept-terms-btn"),p=document.getElementById("lobby-ready-btn");g&&g.addEventListener("click",()=>{ne&&no(ne)}),p&&p.addEventListener("click",()=>{ne&&so(ne)})}const kt=document.getElementById("freeBtn"),ho=document.getElementById("freeCard");kt.addEventListener("click",()=>{console.log("[Free Play] Opening choice sheet"),Sn(En)});ho.addEventListener("click",t=>{t.target!==kt&&!kt.contains(t.target)&&kt.click()});document.getElementById("freeSignInBtn").addEventListener("click",async()=>{console.log("[Free Play] Sign-in requested"),kn="free",Lt(En),Sn(Ct)});const oe=document.getElementById("cashBtn"),fo=document.getElementById("cashCard");oe.addEventListener("click",go);fo.addEventListener("click",t=>{t.target!==oe&&!oe.contains(t.target)&&oe.click()});async function go(){console.log("[Cash Gate] Starting..."),kn="cash",oe.disabled=!0,oe.innerHTML='‚è± Checking... <span class="spinner"></span>';try{let t=(await Je.auth.getSession()).data.session;if(!t&&(console.log("[Cash Gate] No session - opening auth"),oe.disabled=!1,oe.innerHTML="Enter Cash Play",Sn(Ct),await mo(),Lt(Ct),t=(await Je.auth.getSession()).data.session,!t)){console.log("[Cash Gate] User cancelled");return}console.log("[Cash Gate] Authenticated, checking verification...");const{data:{user:e},error:n}=await Je.auth.getUser();if(n||!e){j("Failed to get user info. Try again."),oe.disabled=!1,oe.innerHTML="Enter Cash Play";return}const s=!!e.email_confirmed_at,r=!!e.phone&&!!e.phone_confirmed_at;if(console.log("[Cash Gate] Email verified:",s,"Phone verified:",r),!s&&!r){j("‚ö†Ô∏è Verify your email or phone first. Check your inbox/SMS.",5e3),oe.disabled=!1,oe.innerHTML="Enter Cash Play";return}console.log("[Cash Gate] Contact verified, checking KYC...");const{data:o}=await Je.from("user_kyc_status").select("kyc_status").eq("user_id",e.id).maybeSingle();if(console.log("[Cash Gate] KYC record:",o),(o==null?void 0:o.kyc_status)==="verified"){console.log("[Cash Gate] KYC verified - entering"),j("‚úì Verified! Entering Cash Play..."),setTimeout(()=>{window.location.href="/online.html"},800);return}console.log("[Cash Gate] KYC not verified - redirecting to verify-identity"),j("üîí Identity verification required..."),setTimeout(()=>{window.location.href="/verify-identity.html"},800)}catch(t){console.error("[Cash Gate] Error:",t),j("‚ö†Ô∏è Something went wrong. Try again."),oe.disabled=!1,oe.innerHTML="Enter Cash Play"}}Rr();document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("ogBackToMenu");t&&(t.addEventListener("click",()=>{typeof window.exitTriviaSession=="function"&&window.exitTriviaSession()}),console.log("[Trivia] Exit button wired to exitTriviaSession"));const e=()=>{const n=document.getElementById("catsGrid");if(!n||!window.TRIVIA_CATEGORIES){console.warn("[Categories] Cannot render - missing catsGrid or TRIVIA_CATEGORIES");return}console.log("[Categories] Rendering Free Play categories from TRIVIA_CATEGORIES"),n.innerHTML="",window.TRIVIA_CATEGORIES.forEach(s=>{const r=document.createElement("div");r.className=s.key==="mixed"?"wizard-tile wizard-tile-selected":"wizard-tile",r.setAttribute("data-cat",s.key),r.innerHTML=`
        <div class="cat-icon">${s.icon}</div>
        <div class="cat-title">${s.label}</div>
      `,n.appendChild(r)}),console.log("[Categories] Rendered",window.TRIVIA_CATEGORIES.length,"categories")};if(window.TRIVIA_CATEGORIES)e();else{const n=setInterval(()=>{window.TRIVIA_CATEGORIES&&(clearInterval(n),e())},100);setTimeout(()=>clearInterval(n),5e3)}});function mo(){return new Promise(t=>{const e=Je.auth.onAuthStateChange((n,s)=>{if(s){try{e.data.subscription.unsubscribe()}catch{}t()}});setTimeout(()=>{try{e.data.subscription.unsubscribe()}catch{}t()},12e4)})}(async()=>{const t=new URLSearchParams(window.location.search);(t.has("code")||t.has("access_token"))&&(console.log("[Init] OAuth redirect detected"),j("‚úì Signed in successfully!"),window.history.replaceState({},document.title,window.location.pathname),(await Je.auth.getSession()).data.session&&kn==="free"&&(console.log("[Init] Redirecting to free play after auth"),setTimeout(()=>{window.location.href="/offline.html"},1e3)))})();vr();Er();function po(){console.log("Cash duel UI initialized")}po();function Dt(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function yo(t,e,n,s){function r(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function a(u){try{c(s.next(u))}catch(f){i(f)}}function l(u){try{c(s.throw(u))}catch(f){i(f)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((s=s.apply(t,e||[])).next())})}const wo=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class An extends Error{constructor(e,n="FunctionsError",s){super(e),this.name=n,this.context=s}}class vo extends An{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Fn extends An{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Gn extends An{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ln;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(ln||(ln={}));class bo{constructor(e,{headers:n={},customFetch:s,region:r=ln.Any}={}){this.url=e,this.headers=n,this.region=r,this.fetch=wo(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return yo(this,arguments,void 0,function*(n,s={}){var r;let o,i;try{const{headers:a,method:l,body:c,signal:u,timeout:f}=s;let d={},{region:g}=s;g||(g=this.region);const p=new URL(`${this.url}/${n}`);g&&g!=="any"&&(d["x-region"]=g,p.searchParams.set("forceFunctionRegion",g));let h;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",h=c):typeof c=="string"?(d["Content-Type"]="text/plain",h=c):typeof FormData<"u"&&c instanceof FormData?h=c:(d["Content-Type"]="application/json",h=JSON.stringify(c)):h=c;let y=u;f&&(i=new AbortController,o=setTimeout(()=>i.abort(),f),u?(y=i.signal,u.addEventListener("abort",()=>i.abort())):y=i.signal);const w=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:h,signal:y}).catch($=>{throw new vo($)}),v=w.headers.get("x-relay-error");if(v&&v==="true")throw new Fn(w);if(!w.ok)throw new Gn(w);let b=((r=w.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),T;return b==="application/json"?T=yield w.json():b==="application/octet-stream"||b==="application/pdf"?T=yield w.blob():b==="text/event-stream"?T=w:b==="multipart/form-data"?T=yield w.formData():T=yield w.text(),{data:T,error:null,response:w}}catch(a){return{data:null,error:a,response:a instanceof Gn||a instanceof Fn?a.context:void 0}}finally{o&&clearTimeout(o)}})}}var _o=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},Eo=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let r=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{let i=null,a=null,l=null,c=o.status,u=o.statusText;if(o.ok){var f,d;if(n.method!=="HEAD"){var g;const w=await o.text();w===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((g=n.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?a=w:a=JSON.parse(w))}const h=(f=n.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),y=(d=o.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");h&&y&&y.length>1&&(l=parseInt(y[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(a)&&(a.length>1?(i={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var p;const h=await o.text();try{i=JSON.parse(h),Array.isArray(i)&&o.status===404&&(a=[],i=null,c=200,u="OK")}catch{o.status===404&&h===""?(c=204,u="No Content"):i={message:h}}if(i&&n.isMaybeSingle&&(!(i==null||(p=i.details)===null||p===void 0)&&p.includes("0 rows"))&&(i=null,c=200,u="OK"),i&&n.shouldThrowOnError)throw new _o(i)}return{error:i,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(r=r.catch(o=>{var i;let a="";const l=o==null?void 0:o.cause;if(l){var c,u,f,d;const p=(c=l==null?void 0:l.message)!==null&&c!==void 0?c:"",h=(u=l==null?void 0:l.code)!==null&&u!==void 0?u:"";a=`${(f=o==null?void 0:o.name)!==null&&f!==void 0?f:"FetchError"}: ${o==null?void 0:o.message}`,a+=`

Caused by: ${(d=l==null?void 0:l.name)!==null&&d!==void 0?d:"Error"}: ${p}`,h&&(a+=` (${h})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var g;a=(g=o==null?void 0:o.stack)!==null&&g!==void 0?g:""}return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}},So=class extends Eo{select(t){let e=!1;const n=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const o=r?`${r}.order`:"order",i=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${i?`${i},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${t}`),this.url.searchParams.set(o,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:o="text"}={}){var i;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=(i=this.headers.get("Accept"))!==null&&i!==void 0?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${l}"; options=${a};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const zn=new RegExp("[,()]");var ze=class extends So{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(s=>typeof s=="string"&&zn.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(s=>typeof s=="string"&&zn.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${r}fts${o}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},Io=class{constructor(t,{headers:e={},schema:n,fetch:s}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=s}select(t,e){const{head:n=!1,count:s}=e??{},r=n?"HEAD":"GET";let o=!1;const i=(t??"*").split("").map(a=>/\s/.test(a)&&!o?"":(a==='"'&&(o=!o),a)).join("");return this.url.searchParams.set("select",i),s&&this.headers.append("Prefer",`count=${s}`),new ze({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var s;const r="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((i,a)=>i.concat(Object.keys(a)),[]);if(o.length>0){const i=[...new Set(o)].map(a=>`"${a}"`);this.url.searchParams.set("columns",i.join(","))}}return new ze({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){var o;const i="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new ze({method:i,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(t,{count:e}={}){var n;const s="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new ze({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new ze({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},To=class xs{constructor(e,{headers:n={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(n),this.schemaName=s,this.fetch=r}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Io(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new xs(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:s=!1,get:r=!1,count:o}={}){var i;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;s||r?(a=s?"HEAD":"GET",Object.entries(n).filter(([f,d])=>d!==void 0).map(([f,d])=>[f,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([f,d])=>{l.searchParams.append(f,d)})):(a="POST",c=n);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new ze({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};class ko{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const s=n.node,r=parseInt(s.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const s=this.getWebSocketConstructor();return new s(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Ao="2.89.0",Co=`realtime-js/${Ao}`,Bs="1.0.0",Ro="2.0.0",Vn=Bs,cn=1e4,Oo=1e3,xo=100;var Ee;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Ee||(Ee={}));var V;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(V||(V={}));var ge;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ge||(ge={}));var un;(function(t){t.websocket="websocket"})(un||(un={}));var Be;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Be||(Be={}));class Bo{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,s;const r=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var n,s;const r=(s=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&s!==void 0?s:{},i=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,i)}_encodeUserBroadcastPush(e,n,s){var r,o;const i=e.topic,a=(r=e.ref)!==null&&r!==void 0?r:"",l=(o=e.join_ref)!==null&&o!==void 0?o:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+i.length+c.length+f.length,g=new ArrayBuffer(this.HEADER_LENGTH+d);let p=new DataView(g),h=0;p.setUint8(h++,this.KINDS.userBroadcastPush),p.setUint8(h++,l.length),p.setUint8(h++,a.length),p.setUint8(h++,i.length),p.setUint8(h++,c.length),p.setUint8(h++,f.length),p.setUint8(h++,n),Array.from(l,w=>p.setUint8(h++,w.charCodeAt(0))),Array.from(a,w=>p.setUint8(h++,w.charCodeAt(0))),Array.from(i,w=>p.setUint8(h++,w.charCodeAt(0))),Array.from(c,w=>p.setUint8(h++,w.charCodeAt(0))),Array.from(f,w=>p.setUint8(h++,w.charCodeAt(0)));var y=new Uint8Array(g.byteLength+s.byteLength);return y.set(new Uint8Array(g),0),y.set(new Uint8Array(s),g.byteLength),y.buffer}decode(e,n){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return n(s)}if(typeof e=="string"){const s=JSON.parse(e),[r,o,i,a,l]=s;return n({join_ref:r,ref:o,topic:i,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),s=n.getUint8(0),r=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,r)}}_decodeUserBroadcast(e,n,s){const r=n.getUint8(1),o=n.getUint8(2),i=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+r));l=l+r;const u=s.decode(e.slice(l,l+o));l=l+o;const f=s.decode(e.slice(l,l+i));l=l+i;const d=e.slice(l,e.byteLength),g=a===this.JSON_ENCODING?JSON.parse(s.decode(d)):d,p={type:this.BROADCAST_EVENT,event:u,payload:g};return i>0&&(p.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>n.includes(s)))}}class Ps{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var D;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(D||(D={}));const Kn=(t,e,n={})=>{var s;const r=(s=n.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((o,i)=>(o[i]=Po(i,t,e,r),o),{}):{}},Po=(t,e,n,s)=>{const r=e.find(a=>a.name===t),o=r==null?void 0:r.type,i=n[t];return o&&!s.includes(o)?$s(o,i):dn(i)},$s=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return Do(e,n)}switch(t){case D.bool:return $o(e);case D.float4:case D.float8:case D.int2:case D.int4:case D.int8:case D.numeric:case D.oid:return Lo(e);case D.json:case D.jsonb:return No(e);case D.timestamp:return Uo(e);case D.abstime:case D.date:case D.daterange:case D.int4range:case D.int8range:case D.money:case D.reltime:case D.text:case D.time:case D.timestamptz:case D.timetz:case D.tsrange:case D.tstzrange:return dn(e);default:return dn(e)}},dn=t=>t,$o=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Lo=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},No=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Do=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,s=t[n];if(t[0]==="{"&&s==="}"){let o;const i=t.slice(1,n);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(a=>$s(e,a))}return t},Uo=t=>typeof t=="string"?t.replace(" ","T"):t,Ls=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Qt{constructor(e,n,s={},r=cn){this.channel=e,this.event=n,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var s;return this._hasReceived(e)&&n((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Qn;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Qn||(Qn={}));class at{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=at.syncState(this.state,r,o,i),this.pendingDiffs.forEach(l=>{this.state=at.syncDiff(this.state,l,o,i)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},r=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=at.syncDiff(this.state,r,o,i),a())}),this.onJoin((r,o,i)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:o,newPresences:i})}),this.onLeave((r,o,i)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,s,r){const o=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(o,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const f=o[c];if(f){const d=u.map(y=>y.presence_ref),g=f.map(y=>y.presence_ref),p=u.filter(y=>g.indexOf(y.presence_ref)<0),h=f.filter(y=>d.indexOf(y.presence_ref)<0);p.length>0&&(a[c]=p),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(o,{joins:a,leaves:l},s,r)}static syncDiff(e,n,s,r){const{joins:o,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(o,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const f=e[a].map(g=>g.presence_ref),d=u.filter(g=>f.indexOf(g.presence_ref)<0);e[a].unshift(...d)}s(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(f=>f.presence_ref);c=c.filter(f=>u.indexOf(f.presence_ref)<0),e[a]=c,r(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(s=>n(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,s)=>{const r=e[s];return"metas"in r?n[s]=r.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[s]=r,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Jn;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Jn||(Jn={}));var lt;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(lt||(lt={}));var me;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(me||(me={}));class Ye{constructor(e,n={config:{}},s){var r,o;if(this.topic=e,this.params=n,this.socket=s,this.bindings={},this.state=V.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Qt(this,ge.join,this.params,this.timeout),this.rejoinTimer=new Ps(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=V.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=V.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ge.reply,{},(i,a)=>{this._trigger(this._replyEventName(a),i)}),this.presence=new at(this),this.broadcastEndpointURL=Ls(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var s,r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==V.closed){const{config:{broadcast:i,presence:a,private:l}}=this.params,c=(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(g=>g.filter))!==null&&r!==void 0?r:[],u=!!this.bindings[lt.PRESENCE]&&this.bindings[lt.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,f={},d={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(g=>e==null?void 0:e(me.CHANNEL_ERROR,g)),this._onClose(()=>e==null?void 0:e(me.CLOSED)),this.updateJoinPayload(Object.assign({config:d},f)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:g})=>{var p;if(this.socket._isManualToken()||this.socket.setAuth(),g===void 0){e==null||e(me.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,y=(p=h==null?void 0:h.length)!==null&&p!==void 0?p:0,w=[];for(let v=0;v<y;v++){const b=h[v],{filter:{event:T,schema:$,table:R,filter:O}}=b,ee=g&&g[v];if(ee&&ee.event===T&&Ye.isFilterValueEqual(ee.schema,$)&&Ye.isFilterValueEqual(ee.table,R)&&Ye.isFilterValueEqual(ee.filter,O))w.push(Object.assign(Object.assign({},b),{id:ee.id}));else{this.unsubscribe(),this.state=V.errored,e==null||e(me.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=w,e&&e(me.SUBSCRIBED);return}}).receive("error",g=>{this.state=V.errored,e==null||e(me.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(me.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,s){return this.state===V.joined&&e===lt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,s)}async httpSend(e,n,s={}){var r;if(n==null)return Promise.reject("Payload is required for httpSend()");const o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:i}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=c.body)===null||r===void 0?void 0:r.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=V.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ge.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Qt(this,ge.leave,{},e),s.receive("ok",()=>{n(),r("ok")}).receive("timeout",()=>{n(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=V.closed,this.bindings={}}async _fetchWithTimeout(e,n,s){const r=new AbortController,o=setTimeout(()=>r.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:r.signal}));return clearTimeout(o),i}_push(e,n,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Qt(this,e,n,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>xo){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,s){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,s){var r,o;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=ge;if(s&&[a,l,c,u].indexOf(i)>=0&&s!==this._joinRef())return;let d=this._onMessage(i,n,s);if(n&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(g=>{var p,h,y;return((p=g.filter)===null||p===void 0?void 0:p.event)==="*"||((y=(h=g.filter)===null||h===void 0?void 0:h.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===i}).map(g=>g.callback(d,s)):(o=this.bindings[i])===null||o===void 0||o.filter(g=>{var p,h,y,w,v,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in g){const T=g.id,$=(p=g.filter)===null||p===void 0?void 0:p.event;return T&&((h=n.ids)===null||h===void 0?void 0:h.includes(T))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((y=n.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const T=(v=(w=g==null?void 0:g.filter)===null||w===void 0?void 0:w.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return T==="*"||T===((b=n==null?void 0:n.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===i}).map(g=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:h,table:y,commit_timestamp:w,type:v,errors:b}=p;d=Object.assign(Object.assign({},{schema:h,table:y,commit_timestamp:w,eventType:v,new:{},old:{},errors:b}),this._getPayloadRecords(p))}g.callback(d,s)})}_isClosed(){return this.state===V.closed}_isJoined(){return this.state===V.joined}_isJoining(){return this.state===V.joining}_isLeaving(){return this.state===V.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,s){const r=e.toLocaleLowerCase(),o={type:r,filter:n,callback:s};return this.bindings[r]?this.bindings[r].push(o):this.bindings[r]=[o],this}_off(e,n){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(r=>{var o;return!(((o=r.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===s&&Ye.isEqual(r.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const s in e)if(e[s]!==n[s])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ge.close,{},e)}_onError(e){this._on(ge.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=V.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Kn(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Kn(e.columns,e.old_record)),n}}const Jt=()=>{},_t={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Mo=[1e3,2e3,5e3,1e4],jo=1e4,qo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Wo{constructor(e,n){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cn,this.transport=null,this.heartbeatIntervalMs=_t.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Jt,this.ref=0,this.reconnectTimer=null,this.vsn=Vn,this.logger=Jt,this.conn=null,this.sendBuffer=[],this.serializer=new Bo,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>r?(...o)=>r(...o):(...o)=>fetch(...o),!(!((s=n==null?void 0:n.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${un.websocket}`,this.httpEndpoint=Ls(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ko.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,s){this.logger(e,n,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ee.connecting:return Be.Connecting;case Ee.open:return Be.Open;case Ee.closing:return Be.Closing;default:return Be.Closed}}isConnected(){return this.connectionState()===Be.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(o=>o.topic===s);if(r)return r;{const o=new Ye(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:s,payload:r,ref:o}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${s} (${o})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Oo,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},_t.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:r,payload:o,ref:i}=n,a=i?`(${i})`:"",l=o.status||"";this.log("receive",`${l} ${s} ${r} ${a}`.trim(),o),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(r,o,i)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Ee.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ee.open||this.conn.readyState===Ee.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ge.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(n);return`${e}${s}${r}`}_workerObjectUrl(e){let n;if(e)n=e;else{const s=new Blob([qo],{type:"application/javascript"});n=URL.createObjectURL(s)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,s=!1;if(e)n=e,s=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),n=this.accessTokenValue}else n=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:Co};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(ge.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(n)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Ps(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},_t.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,s,r,o,i,a,l,c,u,f,d,g;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:cn,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:_t.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=e==null?void 0:e.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Jt,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:Vn,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:p=>Mo[p-1]||jo,this.vsn){case Bs:this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(p,h)=>h(JSON.stringify(p)),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:(p,h)=>h(JSON.parse(p));break;case Ro:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var dt=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Ho(t,e,n){const s=new URL(e,t);if(n)for(const[r,o]of Object.entries(n))o!==void 0&&s.searchParams.set(r,o);return s.toString()}async function Fo(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function Go(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:s,query:r,body:o,headers:i}){const a=Ho(t.baseUrl,s,r),l=await Fo(t.auth),c=await e(a,{method:n,headers:{...o?{"Content-Type":"application/json"}:{},...l,...i},body:o?JSON.stringify(o):void 0}),u=await c.text(),f=(c.headers.get("content-type")||"").includes("application/json"),d=f&&u?JSON.parse(u):u;if(!c.ok){const g=f?d:void 0,p=g==null?void 0:g.error;throw new dt((p==null?void 0:p.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:p==null?void 0:p.type,icebergCode:p==null?void 0:p.code,details:g})}return{status:c.status,headers:c.headers,data:d}}}}function Et(t){return t.join("")}var zo=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Et(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Et(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Et(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Et(t.namespace)}`}),!0}catch(e){if(e instanceof dt&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof dt&&n.status===409)return;throw n}}};function je(t){return t.join("")}var Vo=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${je(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof dt&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof dt&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},Ko=class{constructor(t){var s;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=Go({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(s=t.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new zo(this.client,e),this.tableOps=new Vo(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Ut=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function M(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Qo=class extends Ut{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},hn=class extends Ut{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const Cn=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Jo=()=>Response,fn=t=>{if(Array.isArray(t))return t.map(n=>fn(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,s])=>{const r=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[r]=fn(s)}),e},Yo=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Xo=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function ht(t){"@babel/helpers - typeof";return ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(t)}function Zo(t,e){if(ht(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(ht(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ei(t){var e=Zo(t,"string");return ht(e)=="symbol"?e:e+""}function ti(t,e,n){return(e=ei(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Yn(Object(n),!0).forEach(function(s){ti(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}const Yt=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},ni=async(t,e,n)=>{t instanceof await Jo()&&!(n!=null&&n.noResolveJson)?t.json().then(s=>{const r=t.status||500,o=(s==null?void 0:s.statusCode)||r+"";e(new Qo(Yt(s),r,o))}).catch(s=>{e(new hn(Yt(s),s))}):e(new hn(Yt(t),t))},si=(t,e,n,s)=>{const r={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!s?r:(Yo(s)?(r.headers=A({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(s)):r.body=s,e!=null&&e.duplex&&(r.duplex=e.duplex),A(A({},r),n))};async function vt(t,e,n,s,r,o){return new Promise((i,a)=>{t(n,si(e,s,r,o)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>ni(l,a,s))})}async function ft(t,e,n,s){return vt(t,"GET",e,n,s)}async function fe(t,e,n,s,r){return vt(t,"POST",e,s,r,n)}async function gn(t,e,n,s,r){return vt(t,"PUT",e,s,r,n)}async function ri(t,e,n,s){return vt(t,"HEAD",e,A(A({},n),{},{noResolveJson:!0}),s)}async function Rn(t,e,n,s,r){return vt(t,"DELETE",e,s,r,n)}var oi=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(M(e))return{data:null,error:e};throw e}}};let Ns;Ns=Symbol.toStringTag;var ii=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Ns]="BlobDownloadBuilder",this.promise=null}asStream(){return new oi(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(M(e))return{data:null,error:e};throw e}}};const ai={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var li=class{constructor(t,e={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=Cn(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,s){var r=this;try{let o;const i=A(A({},Xn),s);let a=A(A({},r.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",r.encodeMetadata(l)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.has("cacheControl")||o.append("cacheControl",i.cacheControl),l&&!o.has("metadata")&&o.append("metadata",r.encodeMetadata(l))):(o=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=r.toBase64(r.encodeMetadata(l))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!i.duplex&&(i.duplex="half")),s!=null&&s.headers&&(a=A(A({},a),s.headers));const c=r._removeEmptyFolders(e),u=r._getFinalPath(c),f=await(t=="PUT"?gn:fe)(r.fetch,`${r.url}/object/${u}`,o,A({headers:a},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{data:{path:c,id:f.Id,fullPath:f.Key},error:null}}catch(o){if(r.shouldThrowOnError)throw o;if(M(o))return{data:null,error:o};throw o}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,s){var r=this;const o=r._removeEmptyFolders(t),i=r._getFinalPath(o),a=new URL(r.url+`/object/upload/sign/${i}`);a.searchParams.set("token",e);try{let l;const c=A({upsert:Xn.upsert},s),u=A(A({},r.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType),{data:{path:o,fullPath:(await gn(r.fetch,a.toString(),l,{headers:u})).Key},error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(M(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var n=this;try{let s=n._getFinalPath(t);const r=A({},n.headers);e!=null&&e.upsert&&(r["x-upsert"]="true");const o=await fe(n.fetch,`${n.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(n.url+o.url),a=i.searchParams.get("token");if(!a)throw new Ut("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:a},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(M(s))return{data:null,error:s};throw s}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var s=this;try{return{data:await fe(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers}),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(M(r))return{data:null,error:r};throw r}}async copy(t,e,n){var s=this;try{return{data:{path:(await fe(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:s.headers})).Key},error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(M(r))return{data:null,error:r};throw r}}async createSignedUrl(t,e,n){var s=this;try{let r=s._getFinalPath(t),o=await fe(s.fetch,`${s.url}/object/sign/${r}`,A({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:s.headers});const i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${s.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(M(r))return{data:null,error:r};throw r}}async createSignedUrls(t,e,n){var s=this;try{const r=await fe(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(i=>A(A({},i),{},{signedUrl:i.signedURL?encodeURI(`${s.url}${i.signedURL}${o}`):null})),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(M(r))return{data:null,error:r};throw r}}download(t,e){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),r=s?`?${s}`:"",o=this._getFinalPath(t),i=()=>ft(this.fetch,`${this.url}/${n}/${o}${r}`,{headers:this.headers,noResolveJson:!0});return new ii(i,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:fn(await ft(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(M(s))return{data:null,error:s};throw s}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await ri(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(M(s)&&s instanceof hn){const r=s.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const n=this._getFinalPath(t),s=[],r=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";r!==""&&s.push(r);const o=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});i!==""&&s.push(i);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${a}`)}}}async remove(t){var e=this;try{return{data:await Rn(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async list(t,e,n){var s=this;try{const r=A(A(A({},ai),e),{},{prefix:t||""});return{data:await fe(s.fetch,`${s.url}/object/list/${s.bucketId}`,r,{headers:s.headers},n),error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(M(r))return{data:null,error:r};throw r}}async listV2(t,e){var n=this;try{const s=A({},t);return{data:await fe(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,s,{headers:n.headers},e),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(M(s))return{data:null,error:s};throw s}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const Ds="2.89.0",Us={"X-Client-Info":`storage-js/${Ds}`};var ci=class{constructor(t,e={},n,s){this.shouldThrowOnError=!1;const r=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href.replace(/\/$/,""),this.headers=A(A({},Us),e),this.fetch=Cn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await ft(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await ft(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await fe(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(M(s))return{data:null,error:s};throw s}}async updateBucket(t,e){var n=this;try{return{data:await gn(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(M(s))return{data:null,error:s};throw s}}async emptyBucket(t){var e=this;try{return{data:await fe(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Rn(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},ui=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=A(A({},Us),e),this.fetch=Cn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await fe(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const s=n.toString(),r=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return{data:await ft(e.fetch,r,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Rn(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(M(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!Xo(t))throw new Ut("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new Ko({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(n,{get(r,o){const i=r[o];return typeof i!="function"?i:async(...a)=>{try{return{data:await i.apply(r,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}};const On={"X-Client-Info":`storage-js/${Ds}`,"Content-Type":"application/json"};var Ms=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function le(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var Xt=class extends Ms{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},di=class extends Ms{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const xn=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),hi=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Zn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),fi=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const s=t.status||500,r=t;if(typeof r.json=="function")r.json().then(o=>{const i=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||s+"";e(new Xt(Zn(o),s,i))}).catch(()=>{const o=s+"";e(new Xt(r.statusText||`HTTP ${s} error`,s,o))});else{const o=s+"";e(new Xt(r.statusText||`HTTP ${s} error`,s,o))}}else e(new di(Zn(t),t))},gi=(t,e,n,s)=>{const r={method:t,headers:(e==null?void 0:e.headers)||{}};return s?(hi(s)?(r.headers=A({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(s)):r.body=s,A(A({},r),n)):r};async function mi(t,e,n,s,r,o){return new Promise((i,a)=>{t(n,gi(e,s,r,o)).then(l=>{if(!l.ok)throw l;if(s!=null&&s.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>i(l)).catch(l=>fi(l,a,s))})}async function ce(t,e,n,s,r){return mi(t,"POST",e,s,r,n)}var pi=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=A(A({},On),e),this.fetch=xn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await ce(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(le(s))return{data:null,error:s};throw s}}async listIndexes(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await ce(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(le(s))return{data:null,error:s};throw s}}},yi=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=A(A({},On),e),this.fetch=xn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await ce(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await ce(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await ce(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}},wi=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=A(A({},On),e),this.fetch=xn(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await ce(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await ce(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(le(n))return{data:null,error:n};throw n}}},vi=class extends wi{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new bi(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},bi=class extends pi{constructor(t,e,n,s){super(t,e,s),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new _i(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},_i=class extends yi{constructor(t,e,n,s,r){super(t,e,r),this.vectorBucketName=n,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,A(A({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},Ei=class extends ci{constructor(t,e={},n,s){super(t,e,n,s)}from(t){return new li(this.url,this.headers,t,this.fetch)}get vectors(){return new vi(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ui(this.url+"/iceberg",this.headers,this.fetch)}};const js="2.89.0",Ve=30*1e3,mn=3,Zt=mn*Ve,Si="http://localhost:9999",Ii="supabase.auth.token",Ti={"X-Client-Info":`gotrue-js/${js}`},pn="X-Supabase-Api-Version",qs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ki=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ai=10*60*1e3;class gt extends Error{constructor(e,n,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=s}}function S(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Ci extends gt{constructor(e,n,s){super(e,n,s),this.name="AuthApiError",this.status=n,this.code=s}}function Ri(t){return S(t)&&t.name==="AuthApiError"}class Pe extends gt{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class be extends gt{constructor(e,n,s,r){super(e,s,r),this.name=n,this.status=s}}class ae extends be{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Oi(t){return S(t)&&t.name==="AuthSessionMissingError"}class qe extends be{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class St extends be{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class It extends be{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xi(t){return S(t)&&t.name==="AuthImplicitGrantRedirectError"}class es extends be{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Bi extends be{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class yn extends be{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function en(t){return S(t)&&t.name==="AuthRetryableFetchError"}class ts extends be{constructor(e,n,s){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=s}}class wn extends be{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ns=` 	
\r=`.split(""),Pi=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ns.length;e+=1)t[ns[e].charCodeAt(0)]=-2;for(let e=0;e<Ot.length;e+=1)t[Ot[e].charCodeAt(0)]=e;return t})();function ss(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(Ot[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;n(Ot[s]),e.queuedBits-=6}}function Ws(t,e,n){const s=Pi[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function rs(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},o=i=>{Ni(i,s,n)};for(let i=0;i<t.length;i+=1)Ws(t.charCodeAt(i),r,o);return e.join("")}function $i(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Li(t,e){for(let n=0;n<t.length;n+=1){let s=t.charCodeAt(n);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(t.charCodeAt(n+1)-56320&65535|r)+65536,n+=1}$i(s,e)}}function Ni(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let s=1;s<6;s+=1)if(!(t>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function tt(t){const e=[],n={queue:0,queuedBits:0},s=r=>{e.push(r)};for(let r=0;r<t.length;r+=1)Ws(t.charCodeAt(r),n,s);return new Uint8Array(e)}function Di(t){const e=[];return Li(t,n=>e.push(n)),new Uint8Array(e)}function Le(t){const e=[],n={queue:0,queuedBits:0},s=r=>{e.push(r)};return t.forEach(r=>ss(r,n,s)),ss(null,n,s),e.join("")}function Ui(t){return Math.round(Date.now()/1e3)+t}function Mi(){return Symbol("auth-callback")}const Y=()=>typeof window<"u"&&typeof document<"u",Re={tested:!1,writable:!1},Hs=()=>{if(!Y())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Re.tested)return Re.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Re.tested=!0,Re.writable=!0}catch{Re.tested=!0,Re.writable=!1}return Re.writable};function ji(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((r,o)=>{e[o]=r})}catch{}return n.searchParams.forEach((s,r)=>{e[r]=s}),e}const Fs=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),qi=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Ke=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Oe=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},J=async(t,e)=>{await t.removeItem(e)};class Mt{constructor(){this.promise=new Mt.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Mt.promiseConstructor=Promise;function tn(t){const e=t.split(".");if(e.length!==3)throw new wn("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!ki.test(e[s]))throw new wn("JWT not in base64url format");return{header:JSON.parse(rs(e[0])),payload:JSON.parse(rs(e[1])),signature:tt(e[2]),raw:{header:e[0],payload:e[1]}}}async function Wi(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Hi(t,e){return new Promise((s,r)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await t(o);if(!e(o,null,i)){s(i);return}}catch(i){if(!e(o,i)){r(i);return}}})()})}function Fi(t){return("0"+t.toString(16)).substr(-2)}function Gi(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=n.length;let r="";for(let o=0;o<56;o++)r+=n.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,Fi).join("")}async function zi(t){const n=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",n),r=new Uint8Array(s);return Array.from(r).map(o=>String.fromCharCode(o)).join("")}async function Vi(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await zi(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function We(t,e,n=!1){const s=Gi();let r=s;n&&(r+="/PASSWORD_RECOVERY"),await Ke(t,`${e}-code-verifier`,r);const o=await Vi(s);return[o,s===o?"plain":"s256"]}const Ki=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Qi(t){const e=t.headers.get(pn);if(!e||!e.match(Ki))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ji(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Yi(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Xi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function He(t){if(!Xi.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function nn(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Zi(t,e){return new Proxy(t,{get:(n,s,r)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const o=s.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,s,r)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,s,r)}})}function os(t){return JSON.parse(JSON.stringify(t))}const xe=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ea=[502,503,504];async function is(t){var e;if(!qi(t))throw new yn(xe(t),0);if(ea.includes(t.status))throw new yn(xe(t),t.status);let n;try{n=await t.json()}catch(o){throw new Pe(xe(o),o)}let s;const r=Qi(t);if(r&&r.getTime()>=qs["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?s=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(s=n.error_code),s){if(s==="weak_password")throw new ts(xe(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ae}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new ts(xe(n),t.status,n.weak_password.reasons);throw new Ci(xe(n),t.status||500,s)}const ta=(t,e,n,s)=>{const r={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),n))};async function k(t,e,n,s){var r;const o=Object.assign({},s==null?void 0:s.headers);o[pn]||(o[pn]=qs["2024-01-01"].name),s!=null&&s.jwt&&(o.Authorization=`Bearer ${s.jwt}`);const i=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(i.redirect_to=s.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await na(t,e,n+a,{headers:o,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function na(t,e,n,s,r,o){const i=ta(e,s,r,o);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new yn(xe(l),0)}if(a.ok||await is(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await is(l)}}function he(t){var e;let n=null;oa(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Ui(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:s},error:null}}function as(t){const e=he(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Se(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function sa(t){return{data:t,error:null}}function ra(t){const{action_link:e,email_otp:n,hashed_token:s,redirect_to:r,verification_type:o}=t,i=Dt(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:s,redirect_to:r,verification_type:o},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function ls(t){return t}function oa(t){return t.access_token&&t.refresh_token&&t.expires_in}const sn=["global","local","others"];class ia{constructor({url:e="",headers:n={},fetch:s}){this.url=e,this.headers=n,this.fetch=Fs(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=sn[0]){if(sn.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${sn.join(", ")}`);try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(S(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,n={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Se})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:n}=e,s=Dt(e,["options"]),r=Object.assign(Object.assign({},s),n);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ra,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(S(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Se})}catch(n){if(S(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,s,r,o,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(o=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:ls});if(u.error)throw u.error;const f=await u.json(),d=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,g=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(p=>{const h=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(p.split(";")[1].split("=")[1]);c[`${y}Page`]=h}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(S(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){He(e);try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Se})}catch(n){if(S(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){He(e);try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Se})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,n=!1){He(e);try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Se})}catch(s){if(S(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){He(e.userId);try{const{data:n,error:s}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:n,error:s}}catch(n){if(S(n))return{data:null,error:n};throw n}}async _deleteFactor(e){He(e.userId),He(e.id);try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(S(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,s,r,o,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await k(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:"",per_page:(o=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:ls});if(u.error)throw u.error;const f=await u.json(),d=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,g=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(p=>{const h=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(p.split(";")[1].split("=")[1]);c[`${y}Page`]=h}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(S(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await k(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(S(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await k(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(S(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await k(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(S(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await k(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(S(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await k(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(S(n))return{data:null,error:n};throw n}}}function cs(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Fe={debug:!!(globalThis&&Hs()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Gs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class aa extends Gs{}async function la(t,e,n){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,r.name);try{return await n()}finally{Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,r.name)}}else{if(e===0)throw Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new aa(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Fe.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function ca(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function zs(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function ua(t){return parseInt(t,16)}function da(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function ha(t){var e;const{chainId:n,domain:s,expirationTime:r,issuedAt:o=new Date,nonce:i,notBefore:a,requestId:l,resources:c,scheme:u,uri:f,version:d}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const g=zs(t.address),p=u?`${u}://${s}`:s,h=t.statement?`${t.statement}
`:"",y=`${p} wants you to sign in with your Ethereum account:
${g}

${h}`;let w=`URI: ${f}
Version: ${d}
Chain ID: ${n}${i?`
Nonce: ${i}`:""}
Issued At: ${o.toISOString()}`;if(r&&(w+=`
Expiration Time: ${r.toISOString()}`),a&&(w+=`
Not Before: ${a.toISOString()}`),l&&(w+=`
Request ID: ${l}`),c){let v=`
Resources:`;for(const b of c){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);v+=`
- ${b}`}w+=v}return`${y}
${w}`}class F extends Error{constructor({message:e,code:n,cause:s,name:r}){var o;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(o=r??(s instanceof Error?s.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class xt extends F{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function fa({error:t,options:e}){var n,s,r;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new F({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new F({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new F({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new F({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new F({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new F({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new F({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new F({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(Vs(i)){if(o.rp.id!==i)return new F({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new F({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new F({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new F({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new F({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function ga({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new F({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new F({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(Vs(s)){if(n.rpId!==s)return new F({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new F({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new F({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new F({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class ma{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const pa=new ma;function ya(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:s}=t,r=Dt(t,["challenge","user","excludeCredentials"]),o=tt(e).buffer,i=Object.assign(Object.assign({},n),{id:tt(n.id).buffer}),a=Object.assign(Object.assign({},r),{challenge:o,user:i});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:tt(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function wa(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,s=Dt(t,["challenge","allowCredentials"]),r=tt(e).buffer,o=Object.assign(Object.assign({},s),{challenge:r});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let i=0;i<n.length;i++){const a=n[i];o.allowCredentials[i]=Object.assign(Object.assign({},a),{id:tt(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return o}function va(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Le(new Uint8Array(t.response.attestationObject)),clientDataJSON:Le(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ba(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,s=t.getClientExtensionResults(),r=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Le(new Uint8Array(r.authenticatorData)),clientDataJSON:Le(new Uint8Array(r.clientDataJSON)),signature:Le(new Uint8Array(r.signature)),userHandle:r.userHandle?Le(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Vs(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function us(){var t,e;return!!(Y()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function _a(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xt("Browser returned unexpected credential type",e)}:{data:null,error:new xt("Empty credential response",e)}}catch(e){return{data:null,error:fa({error:e,options:t})}}}async function Ea(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xt("Browser returned unexpected credential type",e)}:{data:null,error:new xt("Empty credential response",e)}}catch(e){return{data:null,error:ga({error:e,options:t})}}}const Sa={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Ia={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Bt(...t){const e=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),n=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),s={};for(const r of t)if(r)for(const o in r){const i=r[o];if(i!==void 0)if(Array.isArray(i))s[o]=i;else if(n(i))s[o]=i;else if(e(i)){const a=s[o];e(a)?s[o]=Bt(a,i):s[o]=Bt(i)}else s[o]=i}return s}function Ta(t,e){return Bt(Sa,t,e||{})}function ka(t,e){return Bt(Ia,t,e||{})}class Aa{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:s,signal:r},o){try{const{data:i,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!i)return{data:null,error:a};const l=r??pa.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:c}=i.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(i.webauthn.type){case"create":{const c=Ta(i.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:u,error:f}=await _a({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case"request":{const c=ka(i.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:u,error:f}=await Ea(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(i){return S(i)?{data:null,error:i}:{data:null,error:new Pe("Unexpected error in challenge",i)}}}async _verify({challengeId:e,factorId:n,webauthn:s}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},o){if(!n)return{data:null,error:new gt("rpId is required for WebAuthn authentication")};try{if(!us())return{data:null,error:new Pe("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:s},signal:r},{request:o});if(!i)return{data:null,error:a};const{webauthn:l}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:s,credential_response:l.credential_response}})}catch(i){return S(i)?{data:null,error:i}:{data:null,error:new Pe("Unexpected error in authenticate",i)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},o){if(!n)return{data:null,error:new gt("rpId is required for WebAuthn registration")};try{if(!us())return{data:null,error:new Pe("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(u=>{var f;return(f=u.data)===null||f===void 0?void 0:f.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:n,rpOrigins:s},signal:r},{create:o});return l?this._verify({factorId:i.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(i){return S(i)?{data:null,error:i}:{data:null,error:new Pe("Unexpected error in register",i)}}}}ca();const Ca={url:Si,storageKey:Ii,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ti,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ds(t,e,n){return await n()}const Ge={};class mt{get jwks(){var e,n;return(n=(e=Ge[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Ge[this.storageKey]=Object.assign(Object.assign({},Ge[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Ge[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ge[this.storageKey]=Object.assign(Object.assign({},Ge[this.storageKey]),{cachedAt:e})}constructor(e){var n,s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},Ca),e);if(this.storageKey=o.storageKey,this.instanceID=(n=mt.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,mt.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Y()){const i=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(i),this.logDebugMessages&&console.trace(i)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new ia({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Fs(o.fetch),this.lock=o.lock||ds,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:this.persistSession&&Y()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=la:this.lock=ds,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Aa(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Hs()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=cs(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=cs(this.memoryStorage)),Y()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${js}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},s="none";if(Y()&&(n=ji(window.location.href),this._isImplicitGrantCallback(n)?s="implicit":await this._isPKCECallback(n)&&(s="pkce")),Y()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:o}=await this._getSessionFromURL(n,s);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),xi(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return S(n)?this._returnResult({error:n}):this._returnResult({error:new Pe("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,s,r;try{const o=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:he}),{data:i,error:a}=o;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(o){if(S(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,s,r;try{let o;if("email"in e){const{email:u,password:f,options:d}=e;let g=null,p=null;this.flowType==="pkce"&&([g,p]=await We(this.storage,this.storageKey)),o=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:f,data:(n=d==null?void 0:d.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:g,code_challenge_method:p},xform:he})}else if("phone"in e){const{phone:u,password:f,options:d}=e;o=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(r=d==null?void 0:d.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:he})}else throw new St("You must provide either an email or phone number and a password");const{data:i,error:a}=o;if(a||!i)return await J(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(o){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:i,options:a}=e;n=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:as})}else if("phone"in e){const{phone:o,password:i,options:a}=e;n=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:as})}else throw new St("You must provide either an email or phone number and a password");const{data:s,error:r}=n;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!s||!s.session||!s.user){const o=new qe;return this._returnResult({data:{user:null,session:null},error:o})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(n){if(S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,s,r,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,s,r,o,i,a,l,c,u,f,d;let g,p;if("message"in e)g=e.message,p=e.signature;else{const{chain:h,wallet:y,statement:w,options:v}=e;let b;if(Y())if(typeof y=="object")b=y;else{const de=window;if("ethereum"in de&&typeof de.ethereum=="object"&&"request"in de.ethereum&&typeof de.ethereum.request=="function")b=de.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=y}const T=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href),$=await b.request({method:"eth_requestAccounts"}).then(de=>de).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const R=zs($[0]);let O=(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!O){const de=await b.request({method:"eth_chainId"});O=ua(de)}const ee={domain:T.host,address:R,statement:w,uri:T.href,version:"1",chainId:O,nonce:(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(i=(o=v==null?void 0:v.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=v==null?void 0:v.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.resources};g=ha(ee),p=await b.request({method:"personal_sign",params:[da(g),R]})}try{const{data:h,error:y}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:p},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:he});if(y)throw y;if(!h||!h.session||!h.user){const w=new qe;return this._returnResult({data:{user:null,session:null},error:w})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:Object.assign({},h),error:y})}catch(h){if(S(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async signInWithSolana(e){var n,s,r,o,i,a,l,c,u,f,d,g;let p,h;if("message"in e)p=e.message,h=e.signature;else{const{chain:y,wallet:w,statement:v,options:b}=e;let T;if(Y())if(typeof w=="object")T=w;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))T=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=w}const $=new URL((n=b==null?void 0:b.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in T&&T.signIn){const R=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),v?{statement:v}:null));let O;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")O=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)O=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in O&&"signature"in O&&(typeof O.signedMessage=="string"||O.signedMessage instanceof Uint8Array)&&O.signature instanceof Uint8Array)p=typeof O.signedMessage=="string"?O.signedMessage:new TextDecoder().decode(O.signedMessage),h=O.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${$.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(r=(s=b==null?void 0:b.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b==null?void 0:b.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((f=(u=b==null?void 0:b.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||f===void 0)&&f.length?["Resources",...b.signInWithSolana.resources.map(O=>`- ${O}`)]:[]].join(`
`);const R=await T.signMessage(new TextEncoder().encode(p),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");h=R}}try{const{data:y,error:w}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Le(h)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:he});if(w)throw w;if(!y||!y.session||!y.user){const v=new qe;return this._returnResult({data:{user:null,session:null},error:v})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:w})}catch(y){if(S(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async _exchangeCodeForSession(e){const n=await Oe(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(n??"").split("/");try{if(!s&&this.flowType==="pkce")throw new Bi;const{data:o,error:i}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:he});if(await J(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!o||!o.session||!o.user){const a=new qe;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:r??null}),error:i})}catch(o){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:s,token:r,access_token:o,nonce:i}=e,a=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:he}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new qe;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(n){if(S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,s,r,o,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await We(this.storage,this.storageKey));const{error:f}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u})}throw new St("You must provide either an email or phone number.")}catch(a){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,s;try{let r,o;"options"in e&&(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:i,error:a}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:r,xform:he});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var n,s,r,o,i;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await We(this.storage,this.storageKey));const c=await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:sa});return!((o=c.data)===null||o===void 0)&&o.url&&Y()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;if(s)throw s;if(!n)throw new ae;const{error:r}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(S(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:o}=e,{error:i}=await k(this.fetch,"POST",n,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}else if("phone"in e){const{phone:s,type:r,options:o}=e,{data:i,error:a}=await k(this.fetch,"POST",n,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:a})}throw new St("You must provide either an email or phone number and a type")}catch(n){if(S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await n()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=n();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Zt:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const i=await Oe(this.userStorage,this.storageKey+"-user");i!=null&&i.user?e.user=i.user:e.user=nn()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const i={value:this.suppressGetSessionWarning};e.user=Zi(e.user,i),i.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Se}):await this._useSession(async n=>{var s,r,o;const{data:i,error:a}=n;if(a)throw a;return!(!((s=i.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ae}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0,xform:Se})})}catch(n){if(S(n))return Oi(n)&&(await this._removeSession(),await J(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async s=>{const{data:r,error:o}=s;if(o)throw o;if(!r.session)throw new ae;const i=r.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await We(this.storage,this.storageKey));const{data:c,error:u}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Se});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(s){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ae;const n=Date.now()/1e3;let s=n,r=!0,o=null;const{payload:i}=tn(e.access_token);if(i.exp&&(s=i.exp,r=s<=n),r){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-n,expires_at:s},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(S(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var s;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(s=i.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new ae;const{data:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(S(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Y())throw new It("No browser detected.");if(e.error||e.error_description||e.error_code)throw new It(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new es("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new It("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new es("No code detected.");const{data:v,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:o,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!o||!a||!i||!c)throw new It("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(a);let d=u+f;l&&(d=parseInt(l));const g=d-u;g*1e3<=Ve&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${f}s`);const p=d-f;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:h,error:y}=await this._getUser(o);if(y)throw y;const w={provider_token:s,provider_refresh_token:r,access_token:o,expires_in:f,expires_at:d,refresh_token:i,token_type:c,user:h.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:w,redirectType:e.type},error:null})}catch(s){if(S(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var s;const{data:r,error:o}=n;if(o)return this._returnResult({error:o});const i=(s=r.session)===null||s===void 0?void 0:s.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(Ri(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await J(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=Mi(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async n=>{var s,r;try{const{data:{session:o},error:i}=n;if(i)throw i;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await We(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:s,error:r}=await this._useSession(async o=>{var i,a,l,c,u;const{data:f,error:d}=o;if(d)throw d;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",g,{headers:this.headers,jwt:(u=(c=f.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(r)throw r;return Y()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(S(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var s;try{const{error:r,data:{session:o}}=n;if(r)throw r;const{options:i,provider:a,token:l,access_token:c,nonce:u}=e,f=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=o==null?void 0:o.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:he}),{data:d,error:g}=f;return g?this._returnResult({data:{user:null,session:null},error:g}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new qe}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:g}))}catch(r){if(await J(this.storage,`${this.storageKey}-code-verifier`),S(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var s,r;const{data:o,error:i}=n;if(i)throw i;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const s=Date.now();return await Hi(async r=>(r>0&&await Wi(200*Math.pow(2,r-1)),this._debug(n,"refreshing attempt",r),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:he})),(r,o)=>{const i=200*Math.pow(2,r);return o&&en(o)&&Date.now()+i-s<Ve})}catch(s){if(this._debug(n,"error",s),S(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",s),Y()&&!n.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,n;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await Oe(this.storage,this.storageKey);if(r&&this.userStorage){let i=await Oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:r.user},await Ke(this.userStorage,this.storageKey+"-user",i)),r.user=(e=i==null?void 0:i.user)!==null&&e!==void 0?e:nn()}else if(r&&!r.user&&!r.user){const i=await Oe(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(r.user=i.user,await J(this.storage,this.storageKey+"-user"),await Ke(this.storage,this.storageKey,r)):r.user=nn()}if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const o=((n=r.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Zt;if(this._debug(s,`session has${o?"":" not"} expired with margin of ${Zt}s`),o){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),en(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(r.access_token);!a&&(i!=null&&i.user)?(r.user=i.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(s,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var n,s;if(!e)throw new ae;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Mt;const{data:o,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!o.session)throw new ae;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={data:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(r,"error",o),S(o)){const i={data:null,error:o};return en(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(o),o}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,n,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",n,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){o.push(l)}});if(await Promise.all(i),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await J(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),s=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&n.user&&await Ke(this.userStorage,this.storageKey+"-user",{user:n.user});const r=Object.assign({},n);delete r.user;const o=os(r);await Ke(this.storage,this.storageKey,o)}else{const r=os(n);await Ke(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await J(this.storage,this.storageKey),await J(this.storage,this.storageKey+"-code-verifier"),await J(this.storage,this.storageKey+"-user"),this.userStorage&&await J(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Y()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ve);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:s}}=n;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/Ve);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Ve}ms, refresh threshold is ${mn} ticks`),r<=mn&&await this._callRefreshToken(s.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Gs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Y()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,s){const r=[`provider=${encodeURIComponent(n)}`];if(s!=null&&s.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[o,i]=await We(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});r.push(a.toString())}if(s!=null&&s.queryParams){const o=new URLSearchParams(s.queryParams);r.push(o.toString())}return s!=null&&s.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var s;const{data:r,error:o}=n;return o?this._returnResult({data:null,error:o}):await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var s,r;const{data:o,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await k(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=o==null?void 0:o.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((r=l==null?void 0:l.totp)===null||r===void 0)&&r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:r,error:o}=n;if(o)return this._returnResult({data:null,error:o});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?va(e.webauthn.credential_response):ba(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var s;const{data:r,error:o}=n;if(o)return this._returnResult({data:null,error:o});const i=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});if(i.error)return i;const{data:a}=i;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:ya(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:wa(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:s}=await this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])r.all.push(o),o.status==="verified"&&r[o.factor_type].push(o);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:s},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=tn(s.access_token);let i=null;o.aal&&(i=o.aal);let a=i;((n=(e=s.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const c=o.amr||[];return{data:{currentLevel:i,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;return r?this._returnResult({data:null,error:r}):s?await k(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new ae})})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:r},error:o}=s;if(o)return this._returnResult({data:null,error:o});if(!r)return this._returnResult({data:null,error:new ae});const i=await k(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return i.data&&i.data.redirect_url&&Y()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,n){try{return await this._useSession(async s=>{const{data:{session:r},error:o}=s;if(o)return this._returnResult({data:null,error:o});if(!r)return this._returnResult({data:null,error:new ae});const i=await k(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return i.data&&i.data.redirect_url&&Y()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:s}=e;return s?this._returnResult({data:null,error:s}):n?await k(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new ae})})}catch(e){if(S(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;return r?this._returnResult({data:null,error:r}):s?(await k(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ae})})}catch(n){if(S(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let s=n.keys.find(a=>a.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+Ai>r)return s;const{data:o,error:i}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=r,s=o.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,n={}){try{let s=e;if(!s){const{data:g,error:p}=await this.getSession();if(p||!g.session)return this._returnResult({data:null,error:p});s=g.session.access_token}const{header:r,payload:o,signature:i,raw:{header:a,payload:l}}=tn(s);n!=null&&n.allowExpired||Ji(o.exp);const c=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!c){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:o,header:r,signature:i},error:null}}const u=Yi(r.alg),f=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,f,i,Di(`${a}.${l}`)))throw new wn("Invalid JWT signature");return{data:{claims:o,header:r,signature:i},error:null}}catch(s){if(S(s))return this._returnResult({data:null,error:s});throw s}}}mt.nextInstanceID={};const Ra=mt,Oa="2.89.0";let rt="";typeof Deno<"u"?rt="deno":typeof document<"u"?rt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?rt="react-native":rt="node";const xa={"X-Client-Info":`supabase-js-${rt}/${Oa}`},Ba={headers:xa},Pa={schema:"public"},$a={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},La={};function pt(t){"@babel/helpers - typeof";return pt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(t)}function Na(t,e){if(pt(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(pt(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Da(t){var e=Na(t,"string");return pt(e)=="symbol"?e:e+""}function Ua(t,e,n){return(e=Da(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,s)}return n}function q(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hs(Object(n),!0).forEach(function(s){Ua(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}const Ma=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),ja=()=>Headers,qa=(t,e,n)=>{const s=Ma(n),r=ja();return async(o,i)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let c=new r(i==null?void 0:i.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(o,q(q({},i),{},{headers:c}))}};function Wa(t){return t.endsWith("/")?t:t+"/"}function Ha(t,e){var n,s;const{db:r,auth:o,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:f}=e,d={db:q(q({},l),r),auth:q(q({},c),o),realtime:q(q({},u),i),storage:{},global:q(q(q({},f),a),{},{headers:q(q({},(n=f==null?void 0:f.headers)!==null&&n!==void 0?n:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}function Fa(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Wa(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Ga=class extends Ra{constructor(t){super(t)}},za=class{constructor(t,e,n){var s,r;this.supabaseUrl=t,this.supabaseKey=e;const o=Fa(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const i=`sb-${o.hostname.split(".")[0]}-auth-token`,a={db:Pa,realtime:La,auth:q(q({},$a),{},{storageKey:i}),global:Ba},l=Ha(n??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=l.global.headers)!==null&&r!==void 0?r:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=qa(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(q({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new To(new URL("rest/v1",o).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Ei(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new bo(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:s,userStorage:r,storageKey:o,flowType:i,lock:a,debug:l,throwOnError:c},u,f){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ga({url:this.authUrl.href,headers:q(q({},d),u),storageKey:o,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:s,userStorage:r,flowType:i,lock:a,debug:l,throwOnError:c,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Wo(this.realtimeUrl.href,q(q({},t),{},{params:q(q({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Va=(t,e,n)=>new za(t,e,n);function Ka(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Ka()&&console.warn("‚ö†Ô∏è  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Bn="https://dguhvsjrqnpeonfhotty.supabase.co",Qa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRndWh2c2pycW5wZW9uZmhvdHR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NDkxOTAsImV4cCI6MjA3OTIyNTE5MH0.VQ1LAy545BkKan70yHdnOup1y33BH4wm3w-bKq_qxAs";console.log("[OAuth Test] Initializing Google OAuth test...");console.log("[OAuth Test] Supabase URL:",Bn);console.log("[OAuth Test] Wallet blocker active:",{ethereum:window.ethereum,solana:window.solana,bybitWallet:window.bybitWallet});const Ks=Va(Bn,Qa);var fs;(fs=document.getElementById("testGoogleLogin"))==null||fs.addEventListener("click",async()=>{try{console.log("[OAuth Test] ========================================"),console.log("[OAuth Test] Starting Google OAuth flow..."),console.log("[OAuth Test] Client ID: 184979617710-i9rcsvn3etaklq35ng3srofoiatj6v03.apps.googleusercontent.com"),console.log("[OAuth Test] Expected callback:",`${Bn}/auth/v1/callback`),console.log("[OAuth Test] ========================================");const{data:t,error:e}=await Ks.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin,queryParams:{access_type:"offline",prompt:"consent"}}});e?(console.error("[OAuth Test] ‚ùå Error initiating OAuth:",e),console.error("[OAuth Test] Error details:",{message:e.message,status:e.status,name:e.name}),alert("OAuth Error: "+e.message+`

Check console for details.`)):(console.log("[OAuth Test] ‚úÖ OAuth flow initiated successfully!"),console.log("[OAuth Test] Response data:",t),console.log("[OAuth Test] Redirecting to Google..."))}catch(t){console.error("[OAuth Test] ‚ùå Exception during OAuth:",t),console.error("[OAuth Test] Stack trace:",t.stack),alert("OAuth Exception: "+t.message+`

Check console for details.`)}});Ks.auth.onAuthStateChange((t,e)=>{var n,s,r;console.log("[OAuth Test] ========================================"),console.log("[OAuth Test] Auth state changed:",t),console.log("[OAuth Test] ========================================"),t==="SIGNED_IN"&&e&&(console.log("[OAuth Test] ‚úÖ Successfully signed in!"),console.log("[OAuth Test] User:",e.user),console.log("[OAuth Test] Access Token (first 50 chars):",e.access_token.substring(0,50)+"..."),console.log("[OAuth Test] Refresh Token (first 50 chars):",((n=e.refresh_token)==null?void 0:n.substring(0,50))+"..."),console.log("[OAuth Test] Provider:",(s=e.user.app_metadata)==null?void 0:s.provider),console.log("[OAuth Test] Email:",e.user.email),console.log("[OAuth Test] Full session object:",e),console.log("[OAuth Test] ========================================"),alert(`‚úÖ Google OAuth Success!

User: `+e.user.email+`
Provider: `+((r=e.user.app_metadata)==null?void 0:r.provider)+`

Check console for full token details.`)),t==="SIGNED_OUT"&&console.log("[OAuth Test] ‚ÑπÔ∏è User signed out"),t==="TOKEN_REFRESHED"&&(console.log("[OAuth Test] ‚ÑπÔ∏è Token refreshed"),console.log("[OAuth Test] New session:",e)),t==="USER_UPDATED"&&(console.log("[OAuth Test] ‚ÑπÔ∏è User updated"),console.log("[OAuth Test] Updated user:",e==null?void 0:e.user))});console.log('[OAuth Test] Test button ready. Click "Test Google Login" to start.');
