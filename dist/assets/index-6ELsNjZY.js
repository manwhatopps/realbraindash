import{createClient as qt}from"https://esm.sh/@supabase/supabase-js@2";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const Pt=["localhost","127.0.0.1","local.stackblitz.io"],je=window.__DEV_MODE__===!0,_t=1e4;function Ut(){if(typeof window>"u")return!1;const e=window.location.hostname;return Pt.includes(e)||e.includes("stackblitz")||e.includes("webcontainer")}function Gt(){if(je&&!Ut())throw new Error(`üö® DEV MODE BLOCKED ON NON-LOCALHOST üö®
Dev mode can only run on localhost, 127.0.0.1, or StackBlitz environments.
Current hostname: ${window.location.hostname}
This is a security measure to prevent dev mode from running in production.`)}function $t(){je&&(Gt(),console.warn("%c‚ö†Ô∏è DEV MODE ENABLED ‚ö†Ô∏è","background: #ff6b6b; color: white; font-size: 20px; padding: 10px; font-weight: bold;"),console.warn("DEV MODE is active. This should NEVER happen in production."),console.warn("Features enabled:"),console.warn("  - Bypass authentication"),console.warn("  - Auto-approve KYC"),console.warn("  - Fake wallet balance: $"+(_t/100).toFixed(2)),console.warn("  - Test data flag on all transactions"))}function Ht(){}if(typeof window<"u")try{$t(),je&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ht):void 0)}catch(e){throw console.error("DEV MODE initialization error:",e),alert(e.message),e}window.__QBANKS__=window.__QBANKS__||{};function Wt(e,t){window.__QBANKS__.__builders=window.__QBANKS__.__builders||{},window.__QBANKS__.__builders[e]=t}function Ue(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function N(e,t,o){return Math.floor(e()*(o-t+1))+t}function we(e,t){return t[Math.floor(e()*t.length)]}function ft(e,t){for(let o=t.length-1;o>0;o--){const s=Math.floor(e()*(o+1));[t[o],t[s]]=[t[s],t[o]]}}function zt(e,t,o,s){return new Set([String(e),String(t),String(o),String(s)]).size===4}function rt(e,t=120){return e.length<=t?e:e.slice(0,t-1)}function gt(e,t){for(;t;)[e,t]=[t,e%t];return Math.abs(e)}function Qt(e,t){return Math.abs(e*t)/gt(e,t)}function Ft(e){let t=2166136261;for(let o=0;o<e.length;o++)t^=e.charCodeAt(o),t=Math.imul(t,16777619);return t^=t<<13,t^=t>>>17,t^=t<<5,t>>>0}const ke={Easy:7e3,Medium:1e4,Hard:15e3};function Vt(e,t,o=[-2,-1,1,2],s=!0,n=!1){const i=new Set([String(t)]),a=()=>{const u=we(e,o);let p=t+u;return s&&p<0&&(p=t+Math.abs(u)),n&&p===0&&(p+=1),p};let r=0;for(;i.size<4&&r<100;){r++;const u=a();i.has(String(u))||i.add(String(u))}for(;i.size<4;){const u=t+N(e,-50,50);u!==t&&!i.has(String(u))&&i.add(String(u))}const c=Array.from(i).map(u=>Number.isNaN(Number(u))?u:Number(u));ft(e,c);const d=c.findIndex(u=>String(u)===String(t));return{arr:c,correctLetter:["A","B","C","D"][d]}}function jt(e,t,o){const s=new Set([t]),n=()=>`1/${Math.max(2,o+we(e,[-2,-1,1,2]))}`;let i=0;for(;s.size<4&&i<50;){i++;const c=n();s.has(c)||s.add(c)}for(;s.size<4;)s.add(`1/${Math.max(2,o+N(e,-5,5))}`);const a=Array.from(s);ft(e,a);const r=a.findIndex(c=>c===t);return{arr:a,correctLetter:["A","B","C","D"][r]}}function Kt(e,t){const o=window.__STATIC_EASY_MATH__||[];return o.length===0?(console.warn("No static easy math questions loaded, returning empty array"),[]):o.map((n,i)=>{const a=n.options.findIndex(c=>c===n.answer),r=["A","B","C","D"][a];return{category:t,difficulty:"Easy",question:n.question,option_a:n.options[0],option_b:n.options[1],option_c:n.options[2],option_d:n.options[3],correct_option:r,time_limit_ms:ke.Easy}})}function Yt(e,t){const o=window.__STATIC_MEDIUM_MATH__||[];return o.length===0?(console.warn("No static medium math questions loaded, returning empty array"),[]):o.map((n,i)=>{const a=n.options.findIndex(c=>c===n.answer),r=["A","B","C","D"][a];return{category:t,difficulty:"Medium",question:n.question,option_a:n.options[0],option_b:n.options[1],option_c:n.options[2],option_d:n.options[3],correct_option:r,time_limit_ms:ke.Medium}})}function Jt(e,t){const o=[],s=new Set,n=[()=>{const a=N(e,2,12),r=N(e,2,12),c=N(e,2,12),d=a*r-c;return{q:`${a} √ó ${r} ‚àí ${c} = ?`,ans:d}},()=>{const a=N(e,3,20),r=N(e,3,20),c=N(e,2,9),d=N(e,1,20),u=(a+r)*c-d;return{q:`(${a} + ${r}) √ó ${c} ‚àí ${d} = ?`,ans:u}},()=>{const a=N(e,6,20),r=N(e,2,5),c=a+r,d=a-r,u=c*c-d*d;return{q:`${c}¬≤ ‚àí ${d}¬≤ = ?`,ans:u}},()=>{const a=N(e,4,12),r=`1/${a}`,{arr:c,correctLetter:d}=jt(e,r,a);return{q:`Bag: ${a-1} red, 1 blue. P(blue) = ?`,ans:r,optionsOverride:{arr:c,correctLetter:d}}},()=>{const a=we(e,[30,35,40,45,50,55,60,65]),r=we(e,["comp","supp"]),c=r==="comp"?90-a:180-a;return{q:r==="comp"?`Complement of ${a}¬∞ = ?`:`Supplement of ${a}¬∞ = ?`,ans:c}},()=>{const a=N(e,3,12),r=N(e,3,12),c=Qt(a,r);return{q:`LCM(${a}, ${r}) = ?`,ans:c}},()=>{const a=N(e,8,50),r=N(e,8,50),c=gt(a,r);return{q:`GCD(${a}, ${r}) = ?`,ans:c}},()=>{const a=N(e,5,30),r=N(e,35,80),c=r-a;return{q:`If x + ${a} = ${r}, x = ?`,ans:c}},()=>{const a=N(e,2,12),r=N(e,3,15),c=a*r;return{q:`If ${a}x = ${c}, x = ?`,ans:r}}];let i=0;for(;o.length<300&&i<5e3;){i++;const a=we(e,n)(),r=`${a.q}|${a.ans}`;if(s.has(r))continue;if(s.add(r),a.optionsOverride){const[S,h,w,E]=a.optionsOverride.arr.map(String);o.push({category:t,difficulty:"Hard",question:rt(a.q),option_a:S,option_b:h,option_c:w,option_d:E,correct_option:a.optionsOverride.correctLetter,time_limit_ms:ke.Hard});continue}const{arr:c,correctLetter:d}=Vt(e,a.ans,[-30,-15,-5,-1,1,5,15,30],!0,!1);if(!zt(c[0],c[1],c[2],c[3]))continue;const[u,p,m,I]=c.map(String);o.push({category:t,difficulty:"Hard",question:rt(a.q),option_a:u,option_b:p,option_c:m,option_d:I,correct_option:d,time_limit_ms:ke.Hard})}return o}function Zt(e="math-royale-v1"){const t="Math",o=Ft(e),s=Kt(Ue(o^42405),t),n=Yt(Ue(o^23130),t),i=Jt(Ue(o^50115),t);return{easy:s,medium:n,hard:i}}(async()=>{try{const t=await(await fetch("/src/easy_math_500.json")).json();window.__STATIC_EASY_MATH__=t,console.log(`Loaded ${t.length} static easy math questions`)}catch(e){console.error("Failed to load easy math questions:",e),window.__STATIC_EASY_MATH__=[]}})();(async()=>{try{const t=await(await fetch("/src/medium_math_500.json")).json();window.__STATIC_MEDIUM_MATH__=t,console.log(`Loaded ${t.length} static medium math questions`)}catch(e){console.error("Failed to load medium math questions:",e),window.__STATIC_MEDIUM_MATH__=[]}})();Wt("math",e=>Zt(e));console.log("Question selection module loaded");const j={math:{easy:[],medium:[],hard:[]},sports:{easy:[],medium:[],hard:[]}};let Ge=new Set;async function Xt(){try{console.log("[Question Selection] Loading question files...");const[e,t]=await Promise.all([fetch("/src/easy_math_500.json"),fetch("/src/medium_math_500.json")]);j.math.easy=await e.json(),j.math.medium=await t.json(),j.math.hard=[],console.log("[Question Selection] Loaded math questions:",{easy:j.math.easy.length,medium:j.math.medium.length,hard:j.math.hard.length});try{const s=await(await fetch("/src/sports_easy_60.json")).json();j.sports.easy=s,j.sports.medium=s,j.sports.hard=s,console.log("[Question Selection] Loaded sports questions:",s.length)}catch(o){console.warn("[Question Selection] Sports questions not available:",o)}}catch(e){console.error("[Question Selection] Failed to load questions:",e)}}Xt();window.nextQuestion=async function({categories:e=[],difficulty:t=null}={}){console.log("[Question Selection] === nextQuestion called ==="),console.log("[Question Selection] categories:",e),console.log("[Question Selection] difficulty:",t);let o=null;Array.isArray(e)&&e.length>0&&(o=e[0],console.log("[Question Selection] Using category from array:",o)),!o||!j[o]?(console.log("[Question Selection] No valid category provided or category not found in pools"),console.log("[Question Selection] Requested category:",o),console.log("[Question Selection] Available pools:",Object.keys(j)),console.log("[Question Selection] Defaulting to math"),o="math"):console.log("[Question Selection] ‚úì Valid category found:",o);const s=j[o];let n=s.medium;if(t==="easy"?n=s.easy:t==="hard"?n=s.hard.length>0?s.hard:s.medium:(t==="normal"||t==="medium")&&(n=s.medium),console.log("[Question Selection] Selected pool:",o,t,"size:",n.length),n.length===0)return console.warn("[Question Selection] No questions available for category:",o,"difficulty:",t),{question:null,done:!0};let i=0,a=-1;const r=n.length*2;for(;i<r;){a=Math.floor(Math.random()*n.length);const m=`${o}-${t}-${a}`;if(!Ge.has(m))break;i++}i>=r&&(console.log("[Question Selection] All questions used, clearing cache"),Ge.clear(),a=Math.floor(Math.random()*n.length));const c=`${o}-${t}-${a}`;Ge.add(c);const d=n[a],u=d.options.indexOf(d.answer)+1,p={id:`${o}-${t}-${a}`,prompt:d.question,choices:d.options,correct_index:u,time_limit_ms:t==="easy"?7e3:1e4,category:o,difficulty:d.difficulty||t||"medium"};return console.log("[Question Selection] === Returning question ==="),console.log("[Question Selection] Question category:",p.category),console.log("[Question Selection] Question prompt:",p.prompt.substring(0,50)+"..."),{question:p,done:!1}};console.log("[Question Selection] window.nextQuestion registered");const ve="https://uhhpldqfwkrulhlgkfhn.supabase.co",eo="sb_publishable_k_XxPBDJ06zGjT_VmG0pWg_8U8seMvb";if(ve.includes("dguhvsjrqnpeonfhotty"))throw console.error("‚ùå [Supabase] CRITICAL ERROR: Using wrong project (dguhvsjrqnpeonfhotty)!"),console.error("‚ùå [Supabase] Must use project: uhhpldqfwkrulhlgkfhn"),new Error("Wrong Supabase project configured! Expected uhhpldqfwkrulhlgkfhn, got dguhvsjrqnpeonfhotty");ve.includes("uhhpldqfwkrulhlgkfhn")||console.warn("‚ö†Ô∏è [Supabase] URL does not contain expected project ref: uhhpldqfwkrulhlgkfhn");const L=qt(ve,eo,{auth:{flowType:"pkce",autoRefreshToken:!0,detectSessionInUrl:!0,persistSession:!0,storage:window.localStorage,storageKey:"braindash-auth"},global:{headers:{"X-Client-Info":"braindash-web"}}});console.log("[Supabase] ‚úÖ Client initialized (singleton)");console.log("[Supabase] ‚úÖ URL:",ve);var mt;console.log("[Supabase] ‚úÖ Project ref:",(mt=ve.match(/https:\/\/(.+?)\.supabase\.co/))==null?void 0:mt[1]);console.log("[Supabase] Flow type: PKCE (redirect-only)");window.__SUPABASE_CLIENT_INITIALIZED__?console.warn("[Supabase] ‚ö†Ô∏è Multiple client instances detected! Use the singleton from supabase-client.js"):window.__SUPABASE_CLIENT_INITIALIZED__=!0;let fe=null;L.auth.onAuthStateChange((e,t)=>{(async()=>(fe=(t==null?void 0:t.user)||null,fe&&await be()))()});async function be(){if(fe)try{const{data:e}=await L.auth.getSession();if(!e.session)return;const t=await fetch("https://uhhpldqfwkrulhlgkfhn.supabase.co/functions/v1/wallet_balance",{headers:{Authorization:`Bearer ${e.session.access_token}`,"Content-Type":"application/json"}});if(t.ok){const s=(((await t.json()).balance_cents||0)/100).toFixed(2),n=document.getElementById("walletBalance");if(n){n.textContent=`Balance: $${s}`;const r=localStorage.getItem("hideBalance")==="true";n.style.display=r?"none":"inline-flex"}const i=document.getElementById("headerWalletBalance");i&&(i.textContent=`$${s}`);const a=document.getElementById("headerMobileWalletBalance");a&&(a.textContent=`$${s}`)}}catch(e){console.error("Failed to refresh balance:",e)}}function to(){const e=document.getElementById("openDeposit"),t=document.getElementById("openWithdraw"),o=document.getElementById("depositModal"),s=document.getElementById("withdrawModal"),n=document.getElementById("closeDeposit"),i=document.getElementById("closeWithdraw"),a=document.getElementById("payStripeLink"),r=document.getElementById("doWithdraw"),c=document.getElementById("toggleBalance"),d=document.getElementById("walletBalance");function u(I){I==null||I.classList.remove("hidden")}function p(I){I==null||I.classList.add("hidden")}const m=localStorage.getItem("hideBalance")==="true";d&&(d.style.display=m?"none":"inline-flex"),c&&(c.textContent=m?"üëÅÔ∏è":"üôà"),c==null||c.addEventListener("click",()=>{const S=!(localStorage.getItem("hideBalance")==="true");localStorage.setItem("hideBalance",String(S)),d&&(d.style.display=S?"none":"inline-flex"),c.textContent=S?"üëÅÔ∏è":"üôà"}),e==null||e.addEventListener("click",()=>{if(!fe){alert("Please sign in to deposit funds");return}u(o)}),t==null||t.addEventListener("click",()=>{if(!fe){alert("Please sign in to withdraw funds");return}u(s)}),n==null||n.addEventListener("click",()=>p(o)),i==null||i.addEventListener("click",()=>p(s)),a==null||a.addEventListener("click",async()=>{const I=document.getElementById("depAmount"),S=Math.max(1,Math.floor(Number(I.value)||10));try{const{data:h}=await L.auth.getSession();if(!h.session){alert("Please sign in first");return}const w=await fetch("https://uhhpldqfwkrulhlgkfhn.supabase.co/functions/v1/stripe_create_checkout",{method:"POST",headers:{Authorization:`Bearer ${h.session.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({amount_cents:S*100})}),E=await w.json();if(!w.ok){alert(E.error||"Deposit failed");return}window.location.href=E.url}catch(h){console.error("Deposit error:",h),alert("Failed to initiate deposit")}}),r==null||r.addEventListener("click",async()=>{const I=document.getElementById("wdAmount"),S=Math.max(1,Math.floor(Number(I.value)||10));try{const{data:h}=await L.auth.getSession();if(!h.session){alert("Please sign in first");return}const w=await fetch("https://uhhpldqfwkrulhlgkfhn.supabase.co/functions/v1/wallet_withdraw",{method:"POST",headers:{Authorization:`Bearer ${h.session.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({amount_cents:S*100})}),E=await w.json();if(!w.ok){alert(E.error||"Withdrawal failed");return}alert("Withdrawal requested. You'll be notified when paid."),p(s),await be()}catch(h){console.error("Withdrawal error:",h),alert("Failed to request withdrawal")}}),setInterval(()=>{fe&&be()},1e4)}const me={unverified:{name:"Unverified",badge:"Unverified ‚Äî KYC Required",color:"#F59E0B",icon:"‚è≥",description:"Complete KYC to unlock cash play",features:["Free play mode only","KYC verification required for cash matches"],limits:{deposit:"$0",withdrawal:"$0",cashMatches:!1},requirements:["Full legal name","Date of birth (18+ required)","Full address","SSN last 4 digits","Government ID scan","Selfie verification"]},T2:{name:"Verified Competitor",badge:"Tier 2 ‚Äî Verified Competitor",color:"#22C55E",icon:"‚úì",description:"Full KYC verified",features:["All cash matches","Deposits up to $2,500/month","Withdrawals up to $5,000/month","Standard tournaments","Compete for real money"],limits:{deposit:"$2,500/month",withdrawal:"$5,000/month",cashMatches:!0,vipAccess:!1},requirements:["Full legal name","Date of birth (18+ required)","Full address","SSN last 4 digits","Government ID scan","Selfie verification"]},T3:{name:"Elite Competitor",badge:"Tier 3 ‚Äî Elite Competitor",color:"#A855F7",icon:"üëë",description:"VIP & High Stakes",features:["All T2 features","High-stakes matches ($100+ buy-ins)","VIP tournaments","Sponsored events","Influencer/streamer access","Deposits up to $10,000/month","Withdrawals up to $20,000/month","Priority support"],limits:{deposit:"$10,000/month",withdrawal:"$20,000/month",cashMatches:!0,vipAccess:!0},requirements:["All T2 requirements met","Proof of address (utility bill, bank statement)","Proof of income/source of funds","2FA enabled (mandatory)","Manual compliance approval","Enhanced background check"]}},$e={unverified:{label:"Unverified",color:"#9CA3AF",description:"Verification not started"},pending:{label:"Verification in Review",color:"#F59E0B",description:"Your verification is being processed"},verified:{label:"Verified",color:"#22C55E",description:"Verification complete"},rejected:{label:"Verification Failed",color:"#EF4444",description:"Contact support for assistance"},review_required:{label:"Extra Review Required",color:"#F59E0B",description:"Additional information needed"}};let ct=null;async function oo(){try{const{data:{user:e}}=await L.auth.getUser();if(!e)return{tier:null,status:"unverified",tierInfo:me.unverified,statusInfo:$e.unverified};const{data:t,error:o}=await L.from("user_verification_profiles").select("*").eq("user_id",e.id).maybeSingle();o&&o.code!=="PGRST116"&&console.error("Error fetching tier:",o);const s=(t==null?void 0:t.verification_tier)||null,n=(t==null?void 0:t.verification_status)||"unverified";return ct={tier:s,status:n,tierInfo:s?me[s]:me.unverified,statusInfo:$e[n],profile:t},ct}catch(e){return console.error("Error in getUserTier:",e),{tier:null,status:"unverified",tierInfo:me.unverified,statusInfo:$e.unverified}}}function no(e,t=!0){const o=e?me[e]:me.unverified;return o?`
    <span class="badge badge-tier-${e.toLowerCase()}">
      ${t?o.icon+" ":""}${o.badge}
    </span>
  `:""}let re=null;function so(){console.log("[Header] Initializing"),L.auth.onAuthStateChange((e,t)=>{(async()=>(re=(t==null?void 0:t.user)||null,lt(),re&&await be()))()}),(async()=>{const{data:{session:e}}=await L.auth.getSession();re=(e==null?void 0:e.user)||null,lt(),re&&await be()})(),io()}function lt(){const e=document.getElementById("headerGuestControls"),t=document.getElementById("headerAuthControls"),o=document.getElementById("oldWalletStrip"),s=document.getElementById("headerMobileGuestSection"),n=document.getElementById("headerMobileAuthSection");if(re){e&&(e.style.display="none"),t&&(t.style.display="flex"),o&&(o.style.display="none"),s&&(s.style.display="none"),n&&(n.style.display="block");const i=document.getElementById("headerUserName");if(i){const c=(re.email||"User").split("@")[0];i.textContent=c}const a=document.getElementById("headerUserAvatar");if(a){const r=re.email||"U";a.textContent=r.charAt(0).toUpperCase()}(async()=>{const r=await oo(),c=document.getElementById("headerTierBadge");c&&r&&(c.innerHTML=no(r.tier,!1),c.style.display="inline-flex")})()}else e&&(e.style.display="flex"),t&&(t.style.display="none"),o&&(o.style.display="none"),s&&(s.style.display="block"),n&&(n.style.display="none")}function io(){const e=document.getElementById("headerSignIn"),t=document.getElementById("headerSignUp"),o=document.getElementById("headerWalletPill"),s=document.getElementById("headerUserMenuBtn");document.getElementById("headerUserMenu");const n=document.getElementById("headerSignOut"),i=document.getElementById("headerMobileMenuBtn");document.getElementById("headerMobileMenu");const a=document.getElementById("headerMobileSignIn"),r=document.getElementById("headerMobileSignUp"),c=document.getElementById("headerMobileSignOut"),d=document.querySelectorAll('[data-action="deposit"]'),u=document.querySelectorAll('[data-action="withdraw"]'),p=document.getElementById("headerRulesBtn"),m=document.getElementById("headerHelpBtn"),I=document.getElementById("headerTermsBtn"),S=document.getElementById("headerMobileRulesBtn"),h=document.getElementById("headerMobileHelpBtn"),w=document.getElementById("headerMobileTermsBtn");e==null||e.addEventListener("click",()=>{Ae("signin")}),t==null||t.addEventListener("click",()=>{Ae("signup")}),a==null||a.addEventListener("click",()=>{te(),Ae("signin")}),r==null||r.addEventListener("click",()=>{te(),Ae("signup")}),o==null||o.addEventListener("click",E=>{E.stopPropagation(),co()}),s==null||s.addEventListener("click",E=>{E.stopPropagation(),lo()}),n==null||n.addEventListener("click",async()=>{await L.auth.signOut(),sessionStorage.removeItem("bd_oauth_success_shown"),Qe(),window.location.href="/"}),c==null||c.addEventListener("click",async()=>{te(),await L.auth.signOut(),sessionStorage.removeItem("bd_oauth_success_shown"),window.location.href="/"}),i==null||i.addEventListener("click",E=>{E.stopPropagation(),uo()}),document.addEventListener("click",()=>{Qe(),Ce()}),p==null||p.addEventListener("click",()=>{he("rules")}),m==null||m.addEventListener("click",()=>{he("help")}),I==null||I.addEventListener("click",()=>{he("terms")}),S==null||S.addEventListener("click",()=>{te(),he("rules")}),h==null||h.addEventListener("click",()=>{te(),he("help")}),w==null||w.addEventListener("click",()=>{te(),he("terms")}),d.forEach(E=>{E.addEventListener("click",()=>{Ce(),te();const v=document.getElementById("openDeposit");v&&v.click()})}),u.forEach(E=>{E.addEventListener("click",()=>{Ce(),te();const v=document.getElementById("openWithdraw");v&&v.click()})})}function Ae(e="signin"){const t=document.getElementById("signInSheet"),o=document.getElementById("signUpSheet");e==="signup"&&o?(o.style.display="grid",o.setAttribute("aria-hidden","false")):t&&(t.style.display="grid",t.setAttribute("aria-hidden","false"))}function ao(){const e=document.getElementById("signInSheet"),t=document.getElementById("signUpSheet");e&&(e.style.display="none",e.setAttribute("aria-hidden","true")),t&&(t.style.display="grid",t.setAttribute("aria-hidden","false"))}function ro(){const e=document.getElementById("signInSheet"),t=document.getElementById("signUpSheet");t&&(t.style.display="none",t.setAttribute("aria-hidden","true")),e&&(e.style.display="grid",e.setAttribute("aria-hidden","false"))}function co(){const e=document.getElementById("headerWalletMenu");if(!e)return;const t=e.style.display==="none"||!e.style.display;e.style.display=t?"block":"none",Qe()}function Ce(){const e=document.getElementById("headerWalletMenu");e&&(e.style.display="none")}function lo(){const e=document.getElementById("headerUserMenu");if(!e)return;const t=e.style.display==="none"||!e.style.display;e.style.display=t?"block":"none",Ce()}function Qe(){const e=document.getElementById("headerUserMenu");e&&(e.style.display="none")}function uo(){const e=document.getElementById("headerMobileMenu");if(!e)return;const t=e.style.display==="none"||!e.style.display;e.style.display=t?"flex":"none"}function te(){const e=document.getElementById("headerMobileMenu");e&&(e.style.display="none")}function he(e){const o={rules:{title:"Game Rules",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">How to Play</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px">
          <li>Answer trivia questions as fast as possible</li>
          <li>Each correct answer earns you points</li>
          <li>Speed matters - faster answers = more points</li>
          <li>In elimination rounds, the slowest player is eliminated</li>
          <li>Last player standing wins!</li>
        </ul>

        <h3 style="color:var(--accent2);margin:20px 0 12px">Game Modes</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px">
          <li><strong>Free Play:</strong> Practice mode with no stakes</li>
          <li><strong>Cash Play:</strong> Compete for real prizes (ID verification required)</li>
        </ul>
      `},help:{title:"Help & Support",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">Getting Started</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          New to BrainDash? Start with Free Play to get familiar with the game mechanics.
          When you're ready, sign up to save your progress and unlock Cash Play.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Cash Play Requirements</h3>
        <ul style="line-height:1.8;color:var(--txt);margin-left:20px;margin-bottom:16px">
          <li>Create an account and verify your identity</li>
          <li>Deposit funds to your wallet</li>
          <li>Must be 18+ years old</li>
          <li>Available in select regions only</li>
        </ul>

        <h3 style="color:var(--accent2);margin-bottom:12px">Need More Help?</h3>
        <p style="line-height:1.8;color:var(--txt)">
          Contact us at <a href="mailto:support@braindash.com" style="color:var(--accent2)">support@braindash.com</a>
        </p>
      `},terms:{title:"Terms & Conditions",body:`
        <h3 style="color:var(--accent2);margin-bottom:12px">Acceptance of Terms</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          By accessing and using BrainDash, you accept and agree to be bound by the terms and provisions of this agreement.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Cash Play</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Cash Play features involve real money. You must be 18 years or older and comply with all applicable laws in your jurisdiction.
          Identity verification is required for all Cash Play participants.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Fair Play</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Cheating, collusion, or use of automated tools is strictly prohibited and will result in account termination
          and forfeiture of any funds or prizes.
        </p>

        <h3 style="color:var(--accent2);margin-bottom:12px">Privacy</h3>
        <p style="line-height:1.8;color:var(--txt);margin-bottom:16px">
          Your privacy is important to us. We collect and process personal data in accordance with our
          <a href="/legal/privacy.md" target="_blank" style="color:var(--accent2)">Privacy Policy</a>.
        </p>

        <p style="line-height:1.8;color:var(--muted);font-size:0.875rem;margin-top:24px">
          Last updated: November 2025<br>
          For full terms, visit <a href="/legal/terms.md" target="_blank" style="color:var(--accent2)">/legal/terms.md</a>
        </p>
      `}}[e];if(!o)return;const s=document.getElementById("infoModal");s&&s.remove();const n=document.createElement("div");n.id="infoModal",n.className="sheet",n.style.display="grid",n.setAttribute("aria-hidden","false"),n.innerHTML=`
    <div class="modal" style="max-height:85vh;overflow-y:auto">
      <button class="close" onclick="document.getElementById('infoModal').remove()" aria-label="Close">&times;</button>
      <h2 class="modal-title">${o.title}</h2>
      <div style="margin-top:20px">
        ${o.body}
      </div>
      <button class="btn" onclick="document.getElementById('infoModal').remove()" style="margin-top:24px;width:100%">Close</button>
    </div>
  `,n.addEventListener("click",i=>{i.target===n&&n.remove()}),document.body.appendChild(n)}let pt=null;function ho(){console.log("[Auth] Initializing auth UI"),mo(),fo(),go(),Io()}function yt(){return pt||sessionStorage.getItem("auth_redirect")}function Et(){pt=null,sessionStorage.removeItem("auth_redirect")}function mo(){const e=document.getElementById("emailSignUpForm"),t=document.getElementById("phoneSignUpForm"),o=document.querySelectorAll('[data-switch="signin"]'),s=document.getElementById("signUpTabEmail"),n=document.getElementById("signUpTabPhone");s==null||s.addEventListener("click",()=>{var i,a;(i=document.getElementById("emailSignUpSection"))==null||i.classList.remove("hidden"),(a=document.getElementById("phoneSignUpSection"))==null||a.classList.add("hidden"),s.classList.add("active-tab"),n==null||n.classList.remove("active-tab")}),n==null||n.addEventListener("click",()=>{var i,a;(i=document.getElementById("phoneSignUpSection"))==null||i.classList.remove("hidden"),(a=document.getElementById("emailSignUpSection"))==null||a.classList.add("hidden"),n.classList.add("active-tab"),s==null||s.classList.remove("active-tab")}),e==null||e.addEventListener("submit",async i=>{i.preventDefault(),await po()}),t==null||t.addEventListener("submit",async i=>{i.preventDefault(),await yo()}),o.forEach(i=>{i.addEventListener("click",a=>{a.preventDefault(),ro()})})}function fo(){const e=document.getElementById("emailSignInForm"),t=document.getElementById("phoneSignInForm"),o=document.querySelectorAll('[data-switch="signup"]'),s=document.getElementById("signInTabEmail"),n=document.getElementById("signInTabPhone");s==null||s.addEventListener("click",()=>{var i,a;(i=document.getElementById("emailSignInSection"))==null||i.classList.remove("hidden"),(a=document.getElementById("phoneSignInSection"))==null||a.classList.add("hidden"),s.classList.add("active-tab"),n==null||n.classList.remove("active-tab")}),n==null||n.addEventListener("click",()=>{var i,a;(i=document.getElementById("phoneSignInSection"))==null||i.classList.remove("hidden"),(a=document.getElementById("emailSignInSection"))==null||a.classList.add("hidden"),n.classList.add("active-tab"),s==null||s.classList.remove("active-tab")}),e==null||e.addEventListener("submit",async i=>{i.preventDefault(),await Eo()}),t==null||t.addEventListener("submit",async i=>{i.preventDefault(),await wo()}),o.forEach(i=>{i.addEventListener("click",a=>{a.preventDefault(),ao()})})}function go(){const e=document.querySelectorAll('[data-oauth="google"]'),t=document.querySelectorAll('[data-oauth="apple"]');e.forEach(o=>{o.addEventListener("click",async s=>{s.preventDefault(),await dt("google")})}),t.forEach(o=>{o.addEventListener("click",async s=>{s.preventDefault(),await dt("apple")})})}async function po(){const e=document.getElementById("signUpName"),t=document.getElementById("signUpEmail"),o=document.getElementById("signUpPassword"),s=document.getElementById("emailSignUpMessage"),n=e==null?void 0:e.value.trim(),i=t==null?void 0:t.value.trim(),a=o==null?void 0:o.value;if(!i){M(s,"Please enter your email address","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){M(s,"Please enter a valid email address","error");return}if(!a){M(s,"Please enter a password","error");return}if(a.length<8){M(s,"Password must be at least 8 characters long","error");return}M(s,"Creating your account...","info");try{const{data:c,error:d}=await L.auth.signUp({email:i,password:a,options:{data:{name:n||i.split("@")[0]}}});if(d)throw d.message.includes("already registered")?new Error("This email is already registered. Please sign in instead."):d;c!=null&&c.user&&(M(s,"Account created! You're now signed in.","success"),setTimeout(()=>{Me(),xe("Welcome to BrainDash!");const u=yt();u&&(Et(),window.location.href=u)},1e3))}catch(c){console.error("[Auth] Sign up error:",c);const d=c.message||"Unable to create account. Please try again.";M(s,d,"error")}}async function yo(){const e=document.getElementById("signUpPhoneName"),t=document.getElementById("signUpPhone"),o=document.getElementById("signUpPhonePassword"),s=document.getElementById("phoneSignUpMessage"),n=e==null?void 0:e.value.trim(),i=t==null?void 0:t.value.trim(),a=o==null?void 0:o.value;if(!i||!a){M(s,"Please fill in all required fields","error");return}if(a.length<8){M(s,"Password must be at least 8 characters","error");return}M(s,"Creating account...","info");try{const{data:r,error:c}=await L.auth.signUp({phone:i,password:a,options:{data:{name:n||i}}});if(c)throw c;M(s,"Account created successfully!","success"),Me(),xe("Welcome to BrainDash!")}catch(r){console.error("[Auth] Phone sign up error:",r),M(s,r.message||"Sign up failed","error")}}async function Eo(){const e=document.getElementById("signInEmail"),t=document.getElementById("signInPassword"),o=document.getElementById("emailSignInMessage"),s=e==null?void 0:e.value.trim(),n=t==null?void 0:t.value;if(!s){M(o,"Please enter your email address","error");return}if(!n){M(o,"Please enter your password","error");return}M(o,"Signing in...","info");try{const{data:i,error:a}=await L.auth.signInWithPassword({email:s,password:n});if(a)throw a.message.includes("Invalid")||a.message.includes("incorrect")?new Error("Incorrect email or password, or account not found."):a;M(o,"Welcome back!","success"),setTimeout(()=>{Me(),xe("Signed in successfully!");const r=yt();r&&(Et(),window.location.href=r)},800)}catch(i){console.error("[Auth] Sign in error:",i);const a=i.message||"Unable to sign in. Please check your credentials.";M(o,a,"error")}}async function wo(){const e=document.getElementById("signInPhone"),t=document.getElementById("signInPhonePassword"),o=document.getElementById("phoneSignInMessage"),s=e==null?void 0:e.value.trim(),n=t==null?void 0:t.value;if(!s||!n){M(o,"Please enter your phone and password","error");return}M(o,"Signing in...","info");try{const{data:i,error:a}=await L.auth.signInWithPassword({phone:s,password:n});if(a)throw a;M(o,"Welcome back!","success"),Me(),xe("Signed in successfully!")}catch(i){console.error("[Auth] Phone sign in error:",i),M(o,i.message||"Sign in failed","error")}}async function dt(e){try{console.log(`[Auth] ‚úÖ ${e} OAuth started`),console.log("[Auth] Using Supabase Site URL for redirect");const{data:t,error:o}=await L.auth.signInWithOAuth({provider:e});if(o)throw console.error(`[Auth] ‚ùå ${e} OAuth error:`,o),o;console.log(`[Auth] ‚úÖ Redirected to ${e}`)}catch(t){console.error(`[Auth] ${e} OAuth error:`,t),xe(`${e} sign in failed. Please try again.`)}}function M(e,t,o){e&&(e.textContent=t,e.style.display="block",o==="error"?e.style.color="#ff6b6b":o==="success"?e.style.color="var(--accent)":e.style.color="var(--muted)")}function Me(){const e=document.getElementById("signInSheet"),t=document.getElementById("signUpSheet");e&&(e.style.display="none",e.setAttribute("aria-hidden","true")),t&&(t.style.display="none",t.setAttribute("aria-hidden","true"))}function xe(e){const t=document.getElementById("toast");t&&(t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}function Io(){const e=document.getElementById("biometricSignIn"),t=document.getElementById("biometricSignUpBtn");e&&e.addEventListener("click",o=>{o.preventDefault(),ut()}),t&&t.addEventListener("click",o=>{o.preventDefault(),ut()})}function ut(){const e=document.createElement("div");e.className="sheet",e.style.display="grid",e.setAttribute("aria-hidden","false"),e.innerHTML=`
    <div class="modal" style="max-width:400px">
      <button class="close" onclick="this.closest('.sheet').remove()" aria-label="Close">&times;</button>
      <div style="text-align:center;padding:20px">
        <div style="font-size:48px;margin-bottom:16px">üîê</div>
        <h2 class="modal-title">Biometric Login Coming Soon</h2>
        <p style="color:var(--muted);margin-top:16px;line-height:1.6">
          Face ID, Touch ID, and passkey login will be available soon on supported devices.
          This feature will provide quick and secure access to your account.
        </p>
        <p style="color:var(--muted);margin-top:12px;font-size:0.875rem">
          For now, please continue using email and password to sign in.
        </p>
        <button class="btn" onclick="this.closest('.sheet').remove()" style="margin-top:24px;width:100%">
          Got it
        </button>
      </div>
    </div>
  `,e.addEventListener("click",t=>{t.target===e&&e.remove()}),document.body.appendChild(e)}console.log("[Questions] Loading new category-based question bank...");const J={sports:[{question:"Which country won the FIFA World Cup in 2018?",choices:["Brazil","Germany","France","Argentina"],correctIndex:2},{question:"In basketball, how many points is a free throw worth?",choices:["1","2","3","4"],correctIndex:0},{question:"Which NBA legend is known as 'His Airness'?",choices:["Kobe Bryant","LeBron James","Michael Jordan","Magic Johnson"],correctIndex:2},{question:"How many players are on a soccer team on the field?",choices:["9","10","11","12"],correctIndex:2},{question:"Which sport uses a puck instead of a ball?",choices:["Soccer","Hockey","Basketball","Tennis"],correctIndex:1},{question:"In which sport would you perform a slam dunk?",choices:["Volleyball","Basketball","Tennis","Baseball"],correctIndex:1},{question:"How many Grand Slam tournaments are there in tennis?",choices:["2","3","4","5"],correctIndex:2},{question:"Which country hosted the 2016 Summer Olympics?",choices:["China","Brazil","UK","Russia"],correctIndex:1},{question:"What color card does a referee show for a serious foul in soccer?",choices:["Yellow","Red","Green","Blue"],correctIndex:1},{question:"How many points is a touchdown worth in American football?",choices:["3","6","7","10"],correctIndex:1}],politics:[{question:"What is the primary purpose of a constitution?",choices:["To list all citizens","To establish the framework of government","To set tax rates","To choose political parties"],correctIndex:1},{question:"Which branch of government interprets laws?",choices:["Executive","Legislative","Judicial","Military"],correctIndex:2},{question:"How many senators does each U.S. state have?",choices:["1","2","4","Varies by population"],correctIndex:1},{question:"What is the term length for a U.S. President?",choices:["2 years","4 years","6 years","8 years"],correctIndex:1},{question:"Which document begins with 'We the People'?",choices:["Declaration of Independence","Bill of Rights","U.S. Constitution","Magna Carta"],correctIndex:2},{question:"What is the minimum age to be U.S. President?",choices:["30","35","40","45"],correctIndex:1},{question:"How many branches are in the U.S. government?",choices:["2","3","4","5"],correctIndex:1},{question:"What is the capital of the United States?",choices:["New York","Washington D.C.","Philadelphia","Boston"],correctIndex:1},{question:"Who is the commander-in-chief of the U.S. military?",choices:["Secretary of Defense","Chairman of Joint Chiefs","The President","Speaker of the House"],correctIndex:2},{question:"How many justices sit on the U.S. Supreme Court?",choices:["7","9","11","13"],correctIndex:1}],business:[{question:"What does ROI stand for in business?",choices:["Rate of Interest","Return on Investment","Revenue on Income","Risk of Increase"],correctIndex:1},{question:"What is the primary goal of a for-profit business?",choices:["Hiring employees","Generating profit","Filing taxes","Building offices"],correctIndex:1},{question:"What does CEO stand for?",choices:["Central Executive Officer","Chief Executive Officer","Corporate Enterprise Officer","Company Equity Officer"],correctIndex:1},{question:"What is a stock dividend?",choices:["A tax on stocks","A payment to shareholders","A stock price increase","A company merger"],correctIndex:1},{question:"What does IPO stand for?",choices:["Initial Public Offering","Internal Profit Operation","Investment Portfolio Option","International Price Order"],correctIndex:0},{question:"What is GDP?",choices:["Government Development Plan","Gross Domestic Product","Global Distribution Program","General Data Protection"],correctIndex:1},{question:"What is inflation?",choices:["Increase in prices over time","Decrease in prices over time","Stable prices","Government spending"],correctIndex:0},{question:"What is a monopoly?",choices:["Many small competitors","One dominant seller","Government ownership","No sellers"],correctIndex:1},{question:"What does LLC stand for?",choices:["Limited Liability Company","Large Local Corporation","Legal License Contract","Long-term Loan Credit"],correctIndex:0},{question:"What is supply and demand?",choices:["A pricing theory","A tax system","A trade agreement","A stock market"],correctIndex:0}],music:[{question:"Which artist is known as the 'King of Pop'?",choices:["Prince","Elvis Presley","Michael Jackson","Freddie Mercury"],correctIndex:2},{question:"Which band sang 'Bohemian Rhapsody'?",choices:["The Beatles","Led Zeppelin","Queen","Pink Floyd"],correctIndex:2},{question:"Who is known as the 'Queen of Soul'?",choices:["Whitney Houston","Aretha Franklin","Diana Ross","Tina Turner"],correctIndex:1},{question:"Which instrument has 88 keys?",choices:["Guitar","Violin","Piano","Organ"],correctIndex:2},{question:"What genre is Bob Marley associated with?",choices:["Jazz","Reggae","Blues","Rock"],correctIndex:1},{question:"Which rapper's real name is Marshall Mathers?",choices:["Dr. Dre","Snoop Dogg","Eminem","50 Cent"],correctIndex:2},{question:"What is the highest female singing voice?",choices:["Alto","Soprano","Mezzo","Contralto"],correctIndex:1},{question:"Which band had a hit with 'Stairway to Heaven'?",choices:["The Rolling Stones","Led Zeppelin","The Who","Aerosmith"],correctIndex:1},{question:"What nationality is classical composer Mozart?",choices:["German","Italian","Austrian","French"],correctIndex:2},{question:"Which instrument is Jimi Hendrix famous for playing?",choices:["Drums","Piano","Guitar","Saxophone"],correctIndex:2}],movies:[{question:"Which movie features the quote, 'I'll be back'?",choices:["Die Hard","The Terminator","RoboCop","Predator"],correctIndex:1},{question:"Who directed 'Jurassic Park'?",choices:["George Lucas","James Cameron","Steven Spielberg","Ridley Scott"],correctIndex:2},{question:"What is the highest-grossing film of all time (adjusted for inflation)?",choices:["Titanic","Avatar","Gone with the Wind","Star Wars"],correctIndex:2},{question:"Which movie won Best Picture at the 2020 Oscars?",choices:["1917","Joker","Parasite","Once Upon a Time in Hollywood"],correctIndex:2},{question:"Who played Iron Man in the Marvel Cinematic Universe?",choices:["Chris Evans","Chris Hemsworth","Robert Downey Jr.","Mark Ruffalo"],correctIndex:2},{question:"What year was the first 'Star Wars' movie released?",choices:["1975","1977","1980","1983"],correctIndex:1},{question:"Which actor played Jack in 'Titanic'?",choices:["Brad Pitt","Leonardo DiCaprio","Tom Cruise","Johnny Depp"],correctIndex:1},{question:"What is the name of the hobbit played by Elijah Wood?",choices:["Bilbo","Frodo","Sam","Pippin"],correctIndex:1},{question:"Which movie features a character named Forrest Gump?",choices:["Forrest Gump","Rain Man","Philadelphia","Cast Away"],correctIndex:0},{question:"Who directed 'The Dark Knight'?",choices:["Zack Snyder","Christopher Nolan","Tim Burton","Sam Raimi"],correctIndex:1}],history:[{question:"In which year did World War II end?",choices:["1942","1945","1948","1950"],correctIndex:1},{question:"Who was the first President of the United States?",choices:["Thomas Jefferson","George Washington","John Adams","Benjamin Franklin"],correctIndex:1},{question:"What year did the Berlin Wall fall?",choices:["1987","1989","1991","1993"],correctIndex:1},{question:"Which civilization built the pyramids?",choices:["Romans","Greeks","Egyptians","Mayans"],correctIndex:2},{question:"What year did Christopher Columbus reach the Americas?",choices:["1492","1500","1520","1450"],correctIndex:0},{question:"Who was the first person to walk on the moon?",choices:["Buzz Aldrin","Neil Armstrong","John Glenn","Yuri Gagarin"],correctIndex:1},{question:"In what year did the United States declare independence?",choices:["1774","1776","1778","1780"],correctIndex:1},{question:"Who wrote the Declaration of Independence?",choices:["George Washington","Benjamin Franklin","Thomas Jefferson","John Adams"],correctIndex:2},{question:"What was the name of the ship that brought the Pilgrims to America?",choices:["Santa Maria","Mayflower","Nina","Pinta"],correctIndex:1},{question:"Which war was fought between the North and South in the United States?",choices:["Revolutionary War","Civil War","War of 1812","Spanish-American War"],correctIndex:1}],geography:[{question:"What is the largest ocean on Earth?",choices:["Atlantic Ocean","Pacific Ocean","Indian Ocean","Arctic Ocean"],correctIndex:1},{question:"What is the capital of France?",choices:["London","Paris","Berlin","Rome"],correctIndex:1},{question:"Which continent is the largest by area?",choices:["Africa","North America","Asia","Europe"],correctIndex:2},{question:"What is the longest river in the world?",choices:["Amazon","Nile","Mississippi","Yangtze"],correctIndex:1},{question:"Which country has the most time zones?",choices:["Russia","USA","China","France"],correctIndex:3},{question:"What is the smallest country in the world?",choices:["Monaco","Vatican City","San Marino","Liechtenstein"],correctIndex:1},{question:"Mount Everest is located in which mountain range?",choices:["Andes","Alps","Himalayas","Rockies"],correctIndex:2},{question:"Which desert is the largest hot desert in the world?",choices:["Gobi","Kalahari","Sahara","Arabian"],correctIndex:2},{question:"What is the capital of Japan?",choices:["Seoul","Beijing","Tokyo","Bangkok"],correctIndex:2},{question:"Which U.S. state is the largest by area?",choices:["Texas","California","Alaska","Montana"],correctIndex:2}],science:[{question:"What is the chemical symbol for water?",choices:["O2","H2O","CO2","HO"],correctIndex:1},{question:"What planet is known as the Red Planet?",choices:["Venus","Mars","Jupiter","Saturn"],correctIndex:1},{question:"What is the speed of light?",choices:["186,000 mph","186,000 km/s","300,000 km/s","300,000 mph"],correctIndex:2},{question:"What is the powerhouse of the cell?",choices:["Nucleus","Mitochondria","Ribosome","Chloroplast"],correctIndex:1},{question:"How many bones are in the adult human body?",choices:["186","206","226","246"],correctIndex:1},{question:"What is the largest planet in our solar system?",choices:["Saturn","Jupiter","Neptune","Uranus"],correctIndex:1},{question:"What gas do plants absorb from the atmosphere?",choices:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctIndex:2},{question:"What is the hardest natural substance on Earth?",choices:["Gold","Iron","Diamond","Titanium"],correctIndex:2},{question:"What type of animal is a dolphin?",choices:["Fish","Mammal","Reptile","Amphibian"],correctIndex:1},{question:"What is the freezing point of water in Celsius?",choices:["-10¬∞C","0¬∞C","10¬∞C","32¬∞C"],correctIndex:1}],pop_culture:[{question:"Which social media platform is known for short 15-60 second videos?",choices:["Instagram","Facebook","TikTok","Twitter"],correctIndex:2},{question:"Who is known as 'The Rock' in entertainment?",choices:["Vin Diesel","John Cena","Dwayne Johnson","Jason Statham"],correctIndex:2},{question:"Which TV show features the character Walter White?",choices:["The Wire","Breaking Bad","Mad Men","The Sopranos"],correctIndex:1},{question:"What year did the first iPhone release?",choices:["2005","2007","2009","2011"],correctIndex:1},{question:"Which streaming service created 'Stranger Things'?",choices:["Hulu","Amazon Prime","Netflix","Disney+"],correctIndex:2},{question:"Who won the first season of American Idol?",choices:["Carrie Underwood","Kelly Clarkson","Ruben Studdard","Fantasia"],correctIndex:1},{question:"What is the name of the coffee shop in 'Friends'?",choices:["Central Perk","Starbucks","Coffee House","Cafe Latte"],correctIndex:0},{question:"Which Marvel movie was the first in the MCU?",choices:["Captain America","Thor","Iron Man","Hulk"],correctIndex:2},{question:"What is the highest-grossing video game franchise?",choices:["Call of Duty","Grand Theft Auto","Mario","Pokemon"],correctIndex:3},{question:"Which singer's real name is Stefani Germanotta?",choices:["Madonna","Lady Gaga","Katy Perry","Rihanna"],correctIndex:1}],mixed:[]},Ke=[{label:"Sports",key:"sports",icon:"üèà"},{label:"Politics",key:"politics",icon:"üèõÔ∏è"},{label:"Business & Economics",key:"business",icon:"üíº"},{label:"Music",key:"music",icon:"üéµ"},{label:"Movies",key:"movies",icon:"üé¨"},{label:"History",key:"history",icon:"üìú"},{label:"Geography",key:"geography",icon:"üó∫Ô∏è"},{label:"Science",key:"science",icon:"üî¨"},{label:"Pop Culture",key:"pop_culture",icon:"üé≠"},{label:"Mixed",key:"mixed",icon:"üé≤"}],bo=Ke.reduce((e,t)=>(e[t.label]=t.key,e),{});function So(e,t){var i;console.log("[QUESTIONS] === getQuestionsForSession ==="),console.log("[QUESTIONS] categoryKey:",e),console.log("[QUESTIONS] count:",t);let o=J[e];(!o||o.length===0)&&(console.warn("[QUESTIONS] Missing or empty pool for categoryKey:",e,"-> falling back to 'mixed'"),o=J.mixed,(!o||o.length===0)&&(console.log("[QUESTIONS] Building mixed pool from all categories"),o=Object.values(J).filter(a=>Array.isArray(a)&&a.length>0).flat())),console.log("[QUESTIONS] Pool size for",e,":",o.length);const n=[...o].sort(()=>Math.random()-.5).slice(0,t);return console.log("[QUESTIONS] Selected",n.length,"questions"),console.log("[QUESTIONS] First question:",((i=n[0])==null?void 0:i.question.substring(0,50))+"..."),n}let He=new Set;window.nextQuestion=async function({categories:e=[],difficulty:t=null}={}){console.log("[Questions] nextQuestion called (compatibility mode)"),console.log("[Questions] categories:",e),console.log("[Questions] difficulty:",t);let o=null;Array.isArray(e)&&e.length>0&&(o=e[0],console.log("[Questions] Using category:",o));let s=J[o];if((!s||s.length===0)&&(console.log("[Questions] Category not found, using mixed pool"),o="mixed",s=J[o],(!s||s.length===0)&&(s=Object.values(J).filter(d=>Array.isArray(d)&&d.length>0).flat())),s.length===0)return console.error("[Questions] No questions available!"),{question:null,done:!0};let n=0,i=-1;const a=s.length*2;for(;n<a;){i=Math.floor(Math.random()*s.length);const d=`${o}-${i}`;if(!He.has(d)){He.add(d);break}n++}n>=a&&(console.log("[Questions] All questions used, clearing cache"),He.clear(),i=Math.floor(Math.random()*s.length));const r=s[i],c={id:`${o}-${i}`,prompt:r.question,choices:r.choices,correct_index:r.correctIndex+1,time_limit_ms:1e4,category:o,difficulty:t||"normal"};return console.log("[Questions] Returning question:",c.prompt.substring(0,50)+"..."),console.log("[Questions] Category:",c.category),console.log("[Questions] Correct index:",c.correct_index),{question:c,done:!1}};window.QUESTION_BANK=J;window.TRIVIA_CATEGORIES=Ke;window.TRIVIA_CATEGORY_MAP=bo;window.getQuestionsForSession=So;console.log("[Questions] ‚úì New question bank loaded successfully");console.log("[Questions] Available categories:",Ke.map(e=>e.label).join(", "));console.log("[Questions] Total questions by category:",Object.keys(J).reduce((e,t)=>(e[t]=J[t].length,e),{}));console.log("[Questions] ‚úì Compatibility layer for nextQuestion() enabled");console.log("[Trivia Engine] Loading unified trivia engine...");let D=null,Y=null;const Ee={},ae={};async function vo(e,t){var i;console.log("[QUESTIONS] === getQuestionsForSession ==="),console.log("[QUESTIONS] Category:",e,"Count:",t),Ee[e]||(Ee[e]=[]),ae[e]||(ae[e]=new Set);let o=Ee[e].filter(a=>{if(!a)return!1;const r=a.id||a.question;return!ae[e].has(r)});if(console.log("[QUESTIONS] Available unseen questions:",o.length),console.log("[QUESTIONS] Seen question IDs in this category:",ae[e].size),o.length<t){const a=t-o.length;console.log("[QUESTIONS] ‚ö†Ô∏è  Need",a,"more questions, fetching from AI/bank...");const r=await xo(e,a);Ee[e].push(...r),o=Ee[e].filter(c=>{const d=c.id||c.question;return!ae[e].has(d)})}const n=[...o].sort(()=>Math.random()-.5).slice(0,t);return n.forEach(a=>{const r=a.id||a.question;ae[e].add(r)}),console.log("[QUESTIONS] ‚úì Selected",n.length,"questions"),console.log("[QUESTIONS] Total seen in",e+":",ae[e].size),console.log("[QUESTIONS] First question:",((i=n[0])==null?void 0:i.question.substring(0,50))+"..."),n}async function xo(e,t){var o,s,n,i;console.log("[QUESTIONS] fetchQuestionsForCategory",{categoryKey:e,count:t});try{console.log("[QUESTIONS] üóÑÔ∏è Attempting to fetch from database...");const a=window.VITE_SUPABASE_URL,r=window.VITE_SUPABASE_ANON_KEY;if(console.log("[QUESTIONS] Supabase URL:",a?"FOUND":"MISSING"),console.log("[QUESTIONS] Supabase Key:",r?"FOUND":"MISSING"),a&&r){const c=`${a}/functions/v1/get-questions`;console.log("[QUESTIONS] Calling database endpoint:",c);const d=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({category:e,difficulty:"medium",count:t,mode:"free_play"})});if(console.log("[QUESTIONS] Database response status:",d.status),d.ok){const u=await d.json();console.log("[QUESTIONS] ‚úì Received",(o=u.questions)==null?void 0:o.length,"questions from database"),console.log("[QUESTIONS] Sample question:",(i=(n=(s=u.questions)==null?void 0:s[0])==null?void 0:n.question)==null?void 0:i.substring(0,50));const p=(u.questions||[]).map(m=>({id:m.id||Math.random().toString(36),question:m.question,choices:m.choices||m.answers||[],correctIndex:m.correctIndex??m.correct_index??0,category:e}));return At(),p}else{const u=await d.text();console.warn("[QUESTIONS] ‚ö†Ô∏è  Database endpoint failed:",d.status,u)}}else console.log("[QUESTIONS] ‚ÑπÔ∏è  Supabase env vars not configured, using offline mode")}catch(a){console.error("[QUESTIONS] ‚ö†Ô∏è  Failed to fetch from database:",a),console.error("[QUESTIONS] Error details:",a.message,a.stack)}return console.log("[QUESTIONS] üìö Falling back to static question bank"),Tt(),window.QUESTION_BANK&&window.QUESTION_BANK[e]?[...window.QUESTION_BANK[e]].sort(()=>Math.random()-.5).slice(0,t).map((d,u)=>({id:d.id||`${e}-${d.question.substring(0,50).replace(/\s+/g,"-")}`,question:d.question,choices:d.choices,correctIndex:d.correctIndex})):(console.warn("[QUESTIONS] No database connection and no static bank available"),[])}function To(e){if(!e)return console.warn("[NORMALIZE] Null/undefined question object"),null;if(e.question&&Array.isArray(e.choices)&&typeof e.correctIndex=="number")return{id:e.id,question:e.question,choices:e.choices,correctIndex:e.correctIndex};console.log("[NORMALIZE] Processing non-standard question:",{hasQuestion:!!e.question,hasText:!!e.text,hasPrompt:!!e.prompt,hasChoices:!!e.choices,hasAnswers:!!e.answers,hasOptions:!!e.options,hasCorrectIndex:typeof e.correctIndex=="number"});const t=e.question||e.text||e.prompt||e.questionText||null,o=e.choices||e.answers||e.options||null;let s=typeof e.correctIndex=="number"?e.correctIndex:typeof e.correctAnswerIndex=="number"?e.correctAnswerIndex:typeof e.answerIndex=="number"?e.answerIndex:typeof e.correct=="number"?e.correct:null;if(s===null&&o&&e.correctAnswer&&typeof e.correctAnswer=="string"){const n=o.indexOf(e.correctAnswer);n>=0&&(s=n,console.log("[NORMALIZE] Found correctIndex from correctAnswer string:",n))}return!t||!Array.isArray(o)||s===null?(console.error("[NORMALIZE] ‚ùå Could not normalize question:",{hasQuestionText:!!t,hasChoices:Array.isArray(o),hasCorrectIndex:s!==null,raw:e}),null):(console.log("[NORMALIZE] ‚úì Normalized successfully"),{id:e.id,question:t,choices:o,correctIndex:s})}function Ye({correct:e,responseTimeMs:t,questionTimerSec:o,basePoints:s=1e3,currentStreak:n}){if(!e)return{points:0,basePoints:0,streakBonus:0,newStreak:0};const i=o,a=Math.max(0,Math.min(t/1e3,i));let r;if(a<.5)r=s;else{const p=1-a/i/2;r=Math.round(p*s),r=Math.max(0,Math.min(r,s))}const c=n+1;let d=0;c===2?d=100:c===3?d=200:c===4?d=300:c===5?d=400:c>=6&&(d=500);const u=r+d;return console.log("[SCORING] BrainDash",{correct:e,responseTimeMs:t,responseTimeSec:(t/1e3).toFixed(2),questionTimerSec:o,currentStreak:n,newStreak:c,basePointsEarned:r,streakBonus:d,points:u}),{points:u,basePoints:r,streakBonus:d,newStreak:c}}async function wt(e){let{mode:t,categoryKey:o,questions:s,onComplete:n}=e;if(console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[DEBUG:ENGINE-ENTRY] === TRIVIA ENGINE CALLED ==="),console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[DEBUG:ENGINE-ENTRY] Mode:",t),console.log("[DEBUG:ENGINE-ENTRY] Category:",o),console.log("[DEBUG:ENGINE-ENTRY] Questions count (raw):",(s==null?void 0:s.length)||0),console.log("[DEBUG:ENGINE-ENTRY] First question (raw):",s==null?void 0:s[0]),console.log("[DEBUG:ENGINE-ENTRY] Has onComplete callback:",typeof n=="function"),console.log("[DEBUG:ENGINE-ENTRY] ========================================"),console.log("[TRIVIA] === START TRIVIA SESSION ==="),console.log("[TRIVIA] Mode:",t),console.log("[TRIVIA] Category:",o),console.log("[TRIVIA] Questions (raw):",(s==null?void 0:s.length)||0),Ne(),!s||s.length===0){console.error("[TRIVIA] No questions provided!"),typeof n=="function"&&n(0,{error:"No questions available"});return}console.log("[TRIVIA] Normalizing questions...");const i=s.map(To).filter(a=>a!==null);if(console.log("[TRIVIA] Normalized",i.length,"valid questions"),console.log("[TRIVIA] First normalized question:",i[0]),i.length===0){console.error("[TRIVIA] No valid questions after normalization!"),typeof n=="function"&&n(0,{error:"No valid questions after normalization"});return}s=i,typeof activeMatchMode<"u"&&(activeMatchMode=t,console.log("[TRIVIA] Set activeMatchMode:",t)),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),D={mode:t,categoryKey:o,questions:s,currentIndex:0,score:0,streak:0,correctCount:0,onComplete:n,questionStartTime:null,maxTimePerQuestion:8,currentQuestionLocked:!1,awaitingScoreboard:!1},It(),bt()}function Ne(){console.log("[TRIVIA] Cleaning up trivia session"),Y&&(clearInterval(Y),Y=null),D=null}function Ao(){if(console.log("[TRIVIA] User exiting trivia session"),!D){console.log("[TRIVIA] No active session to exit");return}const e=D.mode;Ne(),typeof activeMatchMode<"u"&&(console.log("[TRIVIA] Clearing activeMatchMode for exit (was:",activeMatchMode,")"),activeMatchMode=null),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),e==="free"?showScreen("home"):e==="cash-test"?showScreen("cash-test-screen"):e==="cash"&&showScreen("cash-challenge-screen"),console.log("[TRIVIA] Exited to",e,"screen")}function It(){console.log("[TRIVIA] === showTriviaScreen CALLED ===");const e=document.getElementById("match-countdown-overlay");e&&(console.warn("[TRIVIA] ‚ö†Ô∏è Found countdown overlay still present! Removing..."),e.remove());const t=document.getElementById("offlineGame");if(console.log("[TRIVIA] Found #offlineGame element:",!!t),!t){console.error("[TRIVIA] ‚ùå Trivia screen element #offlineGame not found!"),console.error("[TRIVIA] Available elements with id:",Array.from(document.querySelectorAll("[id]")).map(r=>r.id));return}console.log("[TRIVIA] Before show - offlineGame display:",t.style.display),console.log("[TRIVIA] Before show - offlineGame classList:",t.classList.toString()),t.classList.remove("hidden"),t.style.cssText=`
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 10005 !important;
    display: flex !important;
    flex-direction: column;
    overflow: hidden;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  `,console.log("[TRIVIA] After show - offlineGame display:",t.style.display),console.log("[TRIVIA] After show - offlineGame classList:",t.classList.toString()),console.log("[TRIVIA] After show - offlineGame visibility:",t.style.visibility);const o=document.getElementById("ogQuestionView"),s=document.getElementById("ogLeaderboardView");o?(o.style.display="flex",console.log("[TRIVIA] Showing #ogQuestionView")):console.error("[TRIVIA] ‚ùå #ogQuestionView not found!"),s&&(s.style.display="none",console.log("[TRIVIA] Hiding #ogLeaderboardView"));const n=document.querySelector(".wrap");n&&(n.style.display="none",console.log("[TRIVIA] Hidden main wrap"));const i=document.querySelectorAll(".screen");console.log("[TRIVIA] Hiding",i.length,"other screens"),i.forEach(r=>{r.id!=="offlineGame"&&(r.classList.add("hidden"),r.style.display="none")});const a=window.getComputedStyle(t);console.log("[TRIVIA] Computed display:",a.display),console.log("[TRIVIA] Computed visibility:",a.visibility),console.log("[TRIVIA] Computed z-index:",a.zIndex),console.log("[TRIVIA] ‚úì Trivia screen shown successfully")}function bt(){var w,E;if(!D){console.error("[TRIVIA] No active game");return}const{mode:e,questions:t,currentIndex:o,score:s,streak:n}=D,i=t[o];if(!i){console.log("[TRIVIA] No more questions, finishing session"),xt();return}console.log("[RENDER] ========================================"),console.log("[RENDER] State snapshot:"),console.log("[RENDER] - Mode:",e),console.log("[RENDER] - Current index:",o),console.log("[RENDER] - Total questions:",t.length),console.log("[RENDER] - Question object:",i),console.log("[RENDER] - Has .question?",!!i.question),console.log("[RENDER] - Has .choices?",Array.isArray(i.choices)),console.log("[RENDER] - Choices length:",(w=i.choices)==null?void 0:w.length),console.log("[RENDER] - Has .correctIndex?",typeof i.correctIndex=="number"),console.log("[RENDER] ========================================"),console.log("[DEBUG:ENGINE-RENDER] ========================================"),console.log("[DEBUG:ENGINE-RENDER] Rendering question",o+1,"/",t.length),console.log("[DEBUG:ENGINE-RENDER] Question text:",((E=i.question)==null?void 0:E.substring(0,60))+"..."),console.log("[DEBUG:ENGINE-RENDER] ========================================"),console.log("[TRIVIA] === Rendering Question",o+1,"/",t.length,"==="),console.log("[TRIVIA] Question:",i.question);const a=document.getElementById("ogPrompt"),r=document.getElementById("ogChoices"),c=document.getElementById("ogRoundLabel"),d=document.getElementById("ogCategoryLabel"),u=document.getElementById("ogScoreDisplay"),p=document.getElementById("ogStreakDisplay");if(console.log("[RENDER] UI Elements check:"),console.log("[RENDER] - #ogPrompt:",!!a),console.log("[RENDER] - #ogChoices:",!!r),console.log("[RENDER] - #ogRoundLabel:",!!c),console.log("[RENDER] - #ogCategoryLabel:",!!d),!a||!r){console.error("[RENDER] ‚ùå Missing required UI elements!"),console.error("[RENDER] questionEl:",a),console.error("[RENDER] answersEl:",r),console.error("[RENDER] Available elements:",Array.from(document.querySelectorAll("[id]")).map(v=>v.id).filter(v=>v.startsWith("og")));return}const m=document.getElementById("ogScoringBreakdown");m&&(m.innerHTML="",console.log("[RENDER] Cleared previous answer feedback")),console.log("[RENDER] Setting question text:",i.question),a.textContent=i.question,console.log("[RENDER] Question text set. questionEl.textContent:",a.textContent);const I=o+1,S=t.length;c&&(c.textContent=`Question ${I}/${S}`,console.log("[RENDER] Round label set:",c.textContent),console.log("[RENDER] Question index:",o,"Displaying as:",I,"of",S)),d&&(d.textContent=D.categoryKey.toUpperCase(),console.log("[RENDER] Category label set:",d.textContent)),u&&(u.textContent=`Score: ${s}`),p&&(p.textContent=`Streak: ${n} üî•`),console.log("[RENDER] Rendering",i.choices.length,"answer buttons"),r.innerHTML="",i.choices.forEach((v,O)=>{console.log("[RENDER] Creating button",O+1,":",v);const z=document.createElement("button");z.className="btn trivia-answer-btn",z.textContent=v,z.style.cssText=`
      width: 100%;
      text-align: center;
      padding: 20px 24px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 12px;
      background: var(--card);
      border: 2px solid var(--line);
      color: var(--txt);
      cursor: pointer;
      transition: all .2s ease;
      margin-bottom: 12px;
    `,z.addEventListener("click",()=>{St(O)}),r.appendChild(z),console.log("[RENDER] Button",O+1,"appended to answersEl")}),console.log("[RENDER] ‚úì All",i.choices.length,"buttons rendered"),console.log("[RENDER] answersEl.children.length:",r.children.length);const h=document.getElementById("offlineGame");if(h){const v=window.getComputedStyle(h);console.log("[RENDER] Parent #offlineGame display:",v.display),console.log("[RENDER] Parent #offlineGame visibility:",v.visibility),console.log("[RENDER] Parent #offlineGame z-index:",v.zIndex),console.log("[RENDER] Parent #offlineGame innerHTML length:",h.innerHTML.length),console.log("[RENDER] Parent #offlineGame children count:",h.children.length),console.log("[RENDER] questionEl in DOM?",document.body.contains(a)),console.log("[RENDER] answersEl in DOM?",document.body.contains(r));const O=h.getBoundingClientRect();if(console.log("[RENDER] #offlineGame dimensions:",{width:O.width,height:O.height,top:O.top,left:O.left}),a){const z=a.getBoundingClientRect(),ee=window.getComputedStyle(a);console.log("[RENDER] questionEl dimensions:",{width:z.width,height:z.height,top:z.top,left:z.left}),console.log("[RENDER] questionEl computed styles:",{display:ee.display,visibility:ee.visibility,fontSize:ee.fontSize,color:ee.color,textContent:a.textContent.substring(0,50)});const K=a.parentElement;if(K){const Q=K.getBoundingClientRect(),de=window.getComputedStyle(K);console.log("[RENDER] questionEl parent (#ogQuestionView?) dimensions:",{id:K.id,width:Q.width,height:Q.height,display:de.display,visibility:de.visibility})}}(v.display==="none"||v.visibility==="hidden")&&(console.warn("[RENDER] ‚ö†Ô∏è Parent was hidden! Re-showing..."),It())}console.log("[RENDER] Starting question timer"),Co(),console.log("[RENDER] ‚úì renderTriviaQuestion COMPLETE")}function Co(){if(!D)return;const e=D,t=e.maxTimePerQuestion;e.questionStartTime=Date.now(),e.currentQuestionLocked=!1,e.awaitingScoreboard=!1;const o=document.getElementById("ogTimerProgress");let s=t;Y&&(clearInterval(Y),Y=null),o&&(o.style.width="100%",o.style.transition="none",o.offsetHeight,o.style.transition=`width ${t}s linear`,o.style.width="0%"),Y=setInterval(()=>{const n=(Date.now()-e.questionStartTime)/1e3;s=Math.max(0,t-n),s<=0&&(clearInterval(Y),Y=null,console.log("[TRIVIA] Time's up!"),Bo())},100),console.log("[TRIVIA] Timer started for",t,"seconds")}function Bo(){if(!D)return;if(D.currentQuestionLocked){console.log("[TRIVIA] Timer expired, answer already processed, showing scoreboard..."),vt();return}console.log("[TRIVIA] Timer expired with no answer, processing as incorrect..."),St(null,{fromTimer:!0})}function St(e,t={}){if(!D){console.error("[TRIVIA] No active game");return}const o=D,{questions:s,currentIndex:n,maxTimePerQuestion:i}=o;if(o.currentQuestionLocked){console.log("[TRIVIA] Question already locked, ignoring duplicate answer");return}const a=s[n];if(!a){console.error("[TRIVIA] No question at index",n);return}const r=Date.now(),c=o.questionStartTime?r-o.questionStartTime:i*1e3,d=e!==null&&e===a.correctIndex;console.log("[TRIVIA] === Answer Selected ==="),console.log("[TRIVIA] Selected:",e,"Correct:",a.correctIndex),console.log("[TRIVIA] Is correct:",d),console.log("[TRIVIA] Response time:",(c/1e3).toFixed(2),"s");const{points:u,basePoints:p,streakBonus:m,newStreak:I}=Ye({correct:d,responseTimeMs:c,questionTimerSec:i,basePoints:1e3,currentStreak:o.streak});o.streak=I,d&&(o.correctCount+=1),o.score+=u,o.currentQuestionLocked=!0,console.log("[TRIVIA] Points earned:",u),console.log("[TRIVIA] New total score:",o.score),console.log("[TRIVIA] New streak:",o.streak),ko(d,u,p,m,a.correctIndex);const S=document.getElementById("ogScoreDisplay"),h=document.getElementById("ogStreakDisplay");S&&(S.textContent=`Score: ${o.score}`),h&&(h.textContent=`Streak: ${o.streak} üî•`),t.fromTimer&&vt()}function ko(e,t,o,s,n){console.log("[TRIVIA] Showing feedback:",e?"‚úì CORRECT":"‚úó WRONG","Points:",t);const i=document.getElementById("ogChoices");i&&i.querySelectorAll("button").forEach((u,p)=>{u.disabled=!0,u.style.cursor="not-allowed",p===n&&(u.style.background="rgba(57, 255, 136, 0.3)",u.style.borderColor="var(--accent)",u.style.borderWidth="3px")});const a=document.getElementById("ogScoringBreakdown");a&&(e?a.innerHTML=`
        <div style="background: rgba(57, 255, 136, 0.08); border: 1px solid var(--accent); border-radius: 8px; padding: 10px; margin: 12px 0;">
          <div style="font-size: 1rem; font-weight: 700; color: var(--accent); margin-bottom: 4px;">
            ‚úì CORRECT! +${t} pts
          </div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            Base: ${o} | Streak: ${s}
          </div>
        </div>
      `:a.innerHTML=`
        <div style="background: rgba(255, 87, 87, 0.08); border: 1px solid #ff5757; border-radius: 8px; padding: 10px; margin: 12px 0;">
          <div style="font-size: 1rem; font-weight: 700; color: #ff5757; margin-bottom: 4px;">
            ‚úó INCORRECT - 0 pts
          </div>
          <div style="font-size: 0.8rem; color: var(--muted);">
            Streak reset
          </div>
        </div>
      `);const r=document.getElementById("ogScoreDisplay"),c=document.getElementById("ogStreakDisplay");r&&(r.textContent=`Score: ${D.score}`),c&&(c.textContent=`Streak: ${D.streak} üî•`)}function vt(){var u;if(!D||D.awaitingScoreboard){console.log("[SCOREBOARD] Already awaiting scoreboard or no active game");return}const e=D;e.awaitingScoreboard=!0;const{currentIndex:t,questions:o,score:s,lobby:n}=e,i=t+1,a=o.length,r=i===a;console.log(`[SCOREBOARD] Showing scoreboard for question ${i}/${a}`),console.log("[SCOREBOARD] Lobby data:",n),console.log("[SCOREBOARD] Lobby participants:",n==null?void 0:n.participants),console.log("[SCOREBOARD] Participants count:",(u=n==null?void 0:n.participants)==null?void 0:u.length),console.log("[SCOREBOARD] Is last question:",r);const c=document.getElementById("ogQuestionView"),d=document.getElementById("ogLeaderboardView");if(c&&(c.style.display="none"),d){d.style.display="flex";const p=document.getElementById("ogLeaderboard");if(p){let m="";if(n&&n.participants&&n.participants.length>0){console.log("[SCOREBOARD] Building multiplayer leaderboard with",n.participants.length,"players"),console.log("[SCOREBOARD] Participants:",n.participants);const I=n.participants.map(S=>{if(S.isBot){const h=Math.floor(Math.random()*1e3)-500,w=Math.max(0,s+h);return console.log("[SCOREBOARD] Bot player:",S.username,"Score:",w),{username:S.username,score:w,isBot:!0,isUser:!1}}else return console.log("[SCOREBOARD] Real player:",S.username,"Score:",s),{username:S.username,score:s,isBot:!1,isUser:!0}});I.sort((S,h)=>h.score-S.score),console.log("[SCOREBOARD] Sorted players:",I),m=`
          <div style="padding: 24px 20px; max-width: 500px; margin: 0 auto;">
            <div style="font-size: 1.5rem; font-weight: 900; color: var(--accent2); margin-bottom: 12px; text-align: center;">
              Question ${i}/${a} Complete
            </div>
            ${r?'<div style="font-size: 1rem; color: var(--muted); margin-bottom: 20px; text-align: center;">Final Results</div>':'<div id="scoreboard-countdown" style="font-size: 1.2rem; font-weight: 700; color: var(--accent); margin-bottom: 20px; text-align: center;">Next question in <span id="countdown-seconds">4</span>s</div>'}
            <div style="background: var(--card); border-radius: 12px; padding: 16px; border: 1px solid var(--line);">
              ${I.map((S,h)=>{const w=S.isUser;return`
                  <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; margin-bottom: 8px; background: ${w?"rgba(57, 255, 136, 0.1)":"transparent"}; border: 1px solid ${w?"var(--accent)":"transparent"}; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <span style="font-size: 1.2rem; font-weight: 900; color: var(--muted); min-width: 24px;">${(h===0?"ü•á":h===1?"ü•à":h===2?"ü•â":"")||h+1}</span>
                      <span style="font-size: 1rem; font-weight: ${w?"700":"600"}; color: var(--txt);">${S.username}</span>
                    </div>
                    <span style="font-size: 1.1rem; font-weight: 700; color: ${w?"var(--accent)":"var(--txt)"}">${Math.round(S.score)}</span>
                  </div>
                `}).join("")}
            </div>
          </div>
        `}else console.log("[SCOREBOARD] No lobby data or single player mode"),m=`
          <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 2rem; font-weight: 900; color: var(--accent2); margin-bottom: 16px;">
              Question ${i}/${a}
            </div>
            <div style="font-size: 1.5rem; font-weight: 700; color: var(--txt); margin-bottom: 8px;">
              Your Score: ${s}
            </div>
            ${r?'<div style="font-size: 1rem; color: var(--muted);">Game Complete!</div>':'<div id="scoreboard-countdown" style="font-size: 1rem; color: var(--muted);">Next question in <span id="countdown-seconds">4</span>s</div>'}
          </div>
        `;if(p.innerHTML=m,console.log("[SCOREBOARD] Leaderboard HTML set, length:",m.length),!r){let I=4;const S=document.getElementById("countdown-seconds"),h=setInterval(()=>{I--,S&&I>0?S.textContent=I:clearInterval(h)},1e3)}}}setTimeout(r?()=>{console.log("[SCOREBOARD] Last question completed, finishing session..."),xt()}:()=>{console.log("[SCOREBOARD] Advancing to next question..."),d&&(d.style.display="none"),c&&(c.style.display="flex"),e.currentIndex+=1,e.currentQuestionLocked=!1,e.awaitingScoreboard=!1,bt()},4e3)}function xt(){if(!D){console.error("[TRIVIA] No active session to finish");return}const e=D,{mode:t,categoryKey:o,score:s,correctCount:n,questions:i,onComplete:a}=e;console.log("[TRIVIA] === SESSION FINISHED ==="),console.log("[TRIVIA] Mode:",t),console.log("[TRIVIA] Category:",o),console.log("[TRIVIA] Final score:",s),console.log("[TRIVIA] Correct:",n,"/",i.length);const r={mode:t,categoryKey:o,score:s,correctCount:n,correctAnswers:n,totalQuestions:i.length};Ne(),typeof activeMatchMode<"u"&&(console.log("[TRIVIA] Clearing activeMatchMode (was:",activeMatchMode,")"),activeMatchMode=null),typeof activeMatchLobbyId<"u"&&(activeMatchLobbyId=null),typeof a=="function"&&a(s,r)}function Tt(){let e=document.getElementById("offline-mode-banner");if(e){e.style.display="block";return}e=document.createElement("div"),e.id="offline-mode-banner",e.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    color: white;
    padding: 12px 20px;
    text-align: center;
    font-weight: 700;
    font-size: 0.9rem;
    z-index: 100000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  `,e.innerHTML=`
    <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
    <span>OFFLINE MODE: Using fallback questions (limited variety)</span>
  `,document.body.appendChild(e),console.log("[OFFLINE-BANNER] Offline mode banner displayed")}function At(){const e=document.getElementById("offline-mode-banner");e&&(e.style.display="none",console.log("[OFFLINE-BANNER] Offline mode banner hidden"))}window.getQuestionsForSession=vo;window.startTriviaSession=wt;window.cleanupTriviaSession=Ne;window.exitTriviaSession=Ao;window.calculateBrainDashScore=Ye;window.showOfflineBanner=Tt;window.hideOfflineBanner=At;window.startTriviaEngine=wt;window.calculateKahootStyleScore=Ye;console.log("[Trivia Engine] ‚úì Unified trivia engine loaded successfully");console.log("[Trivia Engine] Available functions:",["getQuestionsForSession","startTriviaSession","cleanupTriviaSession","exitTriviaSession","calculateBrainDashScore"]);console.log("Freeplay flow loaded");document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("guestBtn"),t=document.getElementById("freeSheet");document.getElementById("freeplaySetup");const o=document.getElementById("offlineStepBots");e&&e.addEventListener("click",()=>{console.log("[Freeplay] Guest button clicked"),t&&(t.style.display="none",t.setAttribute("aria-hidden","true")),o&&(o.style.display="grid",o.setAttribute("aria-hidden","false"))})});(function(){console.log("[Offline Wizard] Initializing...");function e(l){const f=Math.trunc(l*1e3+(l>=0?.5:-.5))/1e3;return Number(f.toFixed(3))}function t(l,f=7e3){if(l<=1)return 100;const y=100/f;return Math.max(0,100-y*(l-1))}function o(l,f=!1){const y=e(t(l)),R=e(y*1);return e(R+(f?5:0))}const s=l=>document.querySelector(l),n=l=>Array.from(document.querySelectorAll(l)),i="bd-wizard-errors";function a(l){const f=(l==null?void 0:l.message)||(l==null?void 0:l.toString())||String(l);console.error("[Offline Wizard Error]",f);try{let y=document.getElementById(i);y||(y=document.createElement("pre"),y.id=i,y.style.cssText="position:fixed;bottom:8px;left:8px;z-index:9999;background:#240;color:#fff;padding:8px 10px;border-radius:8px;max-width:60vw;max-height:40vh;overflow:auto;font:12px/1.3 ui-monospace,monospace;",document.body.appendChild(y)),y.textContent="[Offline Wizard Error] "+f}catch(y){console.error("[Offline Wizard] Could not display error:",y)}}const r={bots:s("#offlineStepBots"),rounds:s("#offlineStepRounds"),difficulty:s("#offlineStepDifficulty"),categories:s("#offlineStepCategories")},c={backBots:s("#offBackBots"),homeBots:s("#offHomeBots"),backRounds:s("#offBackRounds"),homeRounds:s("#offHomeRounds"),backDiff:s("#offBackDiff"),homeDiff:s("#offHomeDiff"),backCats:s("#offBackCats"),homeCats:s("#offHomeCats"),nextFromBots:s("#nextFromBots"),nextFromRounds:s("#nextFromRounds"),nextFromDiff:s("#nextFromDiff"),startGame:s("#startOfflineWizard")},d={botsInput:s("#botsInput"),roundsInput:s("#roundsInput"),elimStart:s("#elimStartInput"),catsGrid:s("#catsGrid")},u={HOME:"home",BOTS:"bots",ROUNDS:"rounds",DIFF:"difficulty",CATS:"categories"};let p=[];const m={mode:"offline",players:{human:1,bots:3},rounds:5,difficulty:"normal",eliminationEnabled:!0,elimination:{startRound:3,perRound:1,schedule:[]},categories:[]},I=l=>{l&&(l.style.display="grid",l.setAttribute("aria-hidden","false"))},S=l=>{l&&(l.style.display="none",l.setAttribute("aria-hidden","true"))},h=()=>{Object.values(r).forEach(S)},w=(l,f,y)=>Math.min(y,Math.max(f,l)),E=(l,f)=>{const y=l-2,g=f-y+1;return Math.max(2,Math.min(g,f))},v=(l,f,y)=>{const g=[];let R=l;for(let T=1;T<=f;T++){let q=0;T>=y&&R>2&&(q=1,R-=1),g.push({round:T,eliminate:q,playersRemaining:R})}return console.log("[Elimination Schedule]",{totalPlayers:l,totalRounds:f,startRound:y,finalPlayers:R,schedule:g}),g},O=(l,f)=>{if(!Array.isArray(l)||l.length===0)return Array(f).fill(null);const y=[...new Set(l)],g=y.length,R=Math.floor(f/g);let T=f%g;const q=y.map(()=>R);for(let C=0;C<T;C++)q[C]++;const P=[];y.forEach((C,$)=>{for(let A=0;A<q[$];A++)P.push(C)});for(let C=P.length-1;C>0;C--){const $=Math.floor(Math.random()*(C+1));[P[C],P[$]]=[P[$],P[C]]}return P},z=()=>{const l=p[p.length-1]||u.HOME;console.log("[Offline Wizard] Current state:",l),h(),l===u.BOTS?I(r.bots):l===u.ROUNDS?I(r.rounds):l===u.DIFF?I(r.difficulty):l===u.CATS&&I(r.categories)},ee=l=>{p[p.length-1]!==l&&p.push(l),z()},K=()=>{p.length>1?(p.pop(),z()):Q()},Q=()=>{var f;p=[],h();const l=s("#offlineGame");if(l){l.classList.add("hidden"),l.style.display="none";const y=l.querySelector("#ogQuestionView"),g=l.querySelector("#ogLeaderboardView");y&&(y.style.display="none"),g&&(g.style.display="none")}document.body.style.overflow="",window.QuestionTimer&&window.QuestionTimer.hide(),(f=window.__questionLoader__)!=null&&f.clearAllQuestionBanks&&window.__questionLoader__.clearAllQuestionBanks(),window.hideEliminationBanner&&window.hideEliminationBanner(),typeof ue<"u"&&(ue=!1),typeof ne<"u"&&(ne=!1),console.log("[Offline Wizard] Returned to home, all state reset")};function de(){return{screen:s("#offlineGame"),back:s("#ogBackToMenu"),round:s("#ogRoundLabel"),cat:s("#ogCategoryLabel"),prompt:s("#ogPrompt"),choices:"#ogChoices",questionView:s("#ogQuestionView"),leaderboardView:s("#ogLeaderboardView"),leaderboard:s("#ogLeaderboard")}}function Rt(){const l=["Swift","Clever","Mighty","Quick","Smart","Brave","Bold","Wise","Fast","Sharp"],f=["Fox","Eagle","Tiger","Wolf","Hawk","Bear","Lion","Panther","Falcon","Dragon"],y=l[Math.floor(Math.random()*l.length)],g=f[Math.floor(Math.random()*f.length)];return`${y}${g}${Math.floor(Math.random()*99)+1}`}function Lt(l){const f=[{id:"human",name:"You",isHuman:!0,score:0,correctAnswers:0,streak:0}];for(let y=0;y<l.players.bots;y++)f.push({id:`bot${y+1}`,name:Rt(),isHuman:!1,score:0,correctAnswers:0,streak:0});return f}function Mt(l){const y={Easy:.5,easy:.5,Medium:.625,medium:.625,normal:.625,Hard:.65,hard:.65}[l]||.625;return Math.random()<y}function Nt(l){const f=(l||"normal").toLowerCase();return f==="easy"?3e3+Math.random()*5e3:f==="medium"||f==="normal"?2e3+Math.random()*4e3:1500+Math.random()*3500}function Dt(l){const f=de();if(!f.leaderboard)return;const y=[...l].sort((g,R)=>R.score!==g.score?R.score-g.score:R.correctAnswers-g.correctAnswers);f.leaderboard.innerHTML=y.map((g,R)=>{const T=R+1,q=T===1?"ü•á":T===2?"ü•à":T===3?"ü•â":`${T}.`,P=g.isHuman?"rgba(57, 255, 136, 0.15)":"rgba(255, 255, 255, 0.03)",C=g.isHuman?"var(--accent2)":"var(--line)";return`
        <div style="background:${P};border:2px solid ${C};border-radius:12px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between">
          <div style="display:flex;align-items:center;gap:16px">
            <span style="font-size:24px;font-weight:700;min-width:40px">${q}</span>
            <div>
              <div style="font-weight:700;font-size:18px;color:var(--txt)">${g.name}</div>
              <div style="font-size:14px;color:var(--muted)">${g.correctAnswers} correct</div>
            </div>
          </div>
          <div style="font-size:28px;font-weight:700;color:var(--accent2)">${g.score.toFixed(3)}</div>
        </div>
      `}).join("")}const ot=(l,f,y)=>{n(l+" .wizard-tile").forEach(g=>{g.getAttribute(f)===y?g.classList.add("wizard-tile-selected"):g.classList.remove("wizard-tile-selected")})};n("#offlineStepBots .wizard-tile[data-val]").forEach(l=>{l.addEventListener("click",()=>{const f=parseInt(l.dataset.val,10);d.botsInput.value=w(f,1,15),ot("#offlineStepBots","data-val",String(f))})}),c.nextFromBots&&c.nextFromBots.addEventListener("click",()=>{const l=w(parseInt(d.botsInput.value,10)||3,1,15);m.players.bots=l,console.log("[Offline Wizard] Bots selected:",l),qe(),ee(u.ROUNDS)}),n("#offlineStepRounds .wizard-tile[data-val]").forEach(l=>{l.addEventListener("click",()=>{const f=parseInt(l.dataset.val,10);d.roundsInput.value=w(f,3,20),ot("#offlineStepRounds","data-val",String(f))})}),c.nextFromRounds&&c.nextFromRounds.addEventListener("click",()=>{const l=w(parseInt(d.roundsInput.value,10)||5,3,20);m.rounds=l,console.log("[Offline Wizard] Rounds selected:",l),qe(),ee(u.DIFF)});const ye=s("#elimToggle"),nt=s("#elimPreview"),st=s("#elimStartPreview"),qe=()=>{const l=1+m.players.bots,f=E(l,m.rounds),y=l-2;st&&(st.textContent=String(f)),nt&&(nt.style.display=m.eliminationEnabled?"flex":"none"),console.log("[Offline Wizard] Elim preview:",{totalPlayers:l,rounds:m.rounds,startRound:f,eliminationsNeeded:y,finalPlayers:2,enabled:m.eliminationEnabled})};ye&&ye.addEventListener("click",()=>{m.eliminationEnabled=!m.eliminationEnabled,ye.textContent=m.eliminationEnabled?"ON":"OFF",ye.classList.toggle("toggle-on",m.eliminationEnabled),ye.classList.toggle("toggle-off",!m.eliminationEnabled),qe()}),n("#offlineStepDifficulty .wizard-tile[data-diff]").forEach(l=>{l.addEventListener("click",()=>{n("#offlineStepDifficulty .wizard-tile").forEach(f=>{f.classList.remove("wizard-tile-selected")}),l.classList.add("wizard-tile-selected")})}),c.nextFromDiff&&c.nextFromDiff.addEventListener("click",()=>{const l=s("#offlineStepDifficulty .wizard-tile.wizard-tile-selected");m.difficulty=(l==null?void 0:l.dataset.diff)||"normal",console.log("[Offline Wizard] Difficulty:",m.difficulty,"Elimination enabled:",m.eliminationEnabled),ee(u.CATS)}),d.catsGrid&&d.catsGrid.addEventListener("click",l=>{const f=l.target.closest(".wizard-tile[data-cat]");if(!f)return;if((f.dataset.cat??"")==="")n("#catsGrid .wizard-tile").forEach(g=>g.classList.remove("wizard-tile-selected")),f.classList.add("wizard-tile-selected");else{const g=s('#catsGrid .wizard-tile[data-cat=""]');g&&g.classList.remove("wizard-tile-selected"),f.classList.toggle("wizard-tile-selected")}});async function Ot(l,f,y){const g=de();if(!g.prompt||!s(g.choices))return console.error("[Offline Wizard] Game elements not found"),{userCorrect:!1};g.questionView.style.display="flex",g.leaderboardView.style.display="none",g.prompt.textContent=l.prompt;const R=s(g.choices);R.innerHTML="";let T=!1,q=!1,P=0;(l.choices||[]).forEach((x,_)=>{const B=document.createElement("button");B.className="btn",B.textContent=x,B.addEventListener("click",()=>{T||(T=!0,P=Date.now(),q=_===l.correct_index-1,n(g.choices+" .btn").forEach(U=>U.disabled=!0),q?(B.style.outline="3px solid #2ea043",B.style.background="rgba(46, 160, 67, 0.2)"):(B.style.outline="3px solid #9e2a2b",B.style.background="rgba(158, 42, 43, 0.2)"))}),R.appendChild(B)});const C=l.time_limit_ms||7e3,$=s("#ogTimerProgress");if($){$.style.width="100%",$.style.background="#00eaff";const x=Date.now();l.startTime=x;const _=setInterval(()=>{const B=Date.now()-x,U=Math.max(0,C-B),ie=U/C*100;$.style.width=ie+"%",ie<30?$.style.background="#ff4444":ie<60&&($.style.background="#ffd700"),U<=0&&clearInterval(_)},100);await new Promise(B=>setTimeout(B,C)),clearInterval(_),$.style.width="0%"}else l.startTime=Date.now(),await new Promise(x=>setTimeout(x,C));window.QuestionTimer&&window.QuestionTimer.hide(),n(g.choices+" .btn").forEach((x,_)=>{x.disabled=!0,_===l.correct_index-1&&(x.style.outline="3px solid #2ea043")});const A=y.find(x=>x.isHuman);if(q&&P>0){const x=P-l.startTime,_=Math.max(0,(C-x)/1e3),B=C/1e3,U=window.calculateKahootStyleScore?window.calculateKahootStyleScore({correct:!0,timeRemaining:_,maxTime:B,currentStreak:A.streak}):o(x,!1);A.score+=U,A.correctAnswers+=1,A.streak+=1,A.lastPoints=U,console.log("[Offline Wizard] Human scored",U,"points. Streak:",A.streak,"Total:",A.score)}else!q&&T&&(A.streak=0,console.log("[Offline Wizard] Human answered incorrectly. Streak reset."));return y.forEach(x=>{if(!x.isHuman)if(Mt(f.difficulty)){const B=Nt(f.difficulty),U=Math.max(0,(C-B)/1e3),ie=C/1e3,G=window.calculateKahootStyleScore?window.calculateKahootStyleScore({correct:!0,timeRemaining:U,maxTime:ie,currentStreak:x.streak}):o(B,!1);x.score+=G,x.correctAnswers+=1,x.streak+=1}else x.streak=0}),{userCorrect:q,userAnswered:T,userAnswerTime:P}}async function Pe(l){var f,y,g,R;console.log("[Offline Wizard] Starting match with config:",l);try{h();const T=de();if(!T.screen){console.error("[Offline Wizard] Game screen not found");return}document.body.style.overflow="hidden",T.screen.classList.remove("hidden"),T.screen.style.display="flex",ue=!0,ne=!1;const q=Lt(l);for(let A=1;A<=l.rounds;A++){if(ne){console.log("[Offline Wizard] Game interrupted by user");break}console.log(`[Offline Wizard] Starting round ${A}/${l.rounds}`);try{T.round.textContent=`Round ${A} / ${l.rounds}`;const x=Array.isArray(l.categoryPlan)?l.categoryPlan[A-1]:null;T.cat.textContent=x||"Any",(y=(f=l.elimination)==null?void 0:f.banner)!=null&&y.enabled&&A===l.elimination.banner.fireOnRound&&window.showEliminationBanner&&await new Promise(G=>{window.showEliminationBanner(l.elimination.banner.text,5e3),setTimeout(G,5e3)});const _=x?[x]:(g=l.categories)!=null&&g.length?l.categories:[];console.log("[Offline Wizard] Round",A,"planCat:",x,"categories for question:",_);let B=null,U=!1;if(window.nextQuestion)try{const G=await window.nextQuestion({categories:_,difficulty:l.difficulty});if(B=G==null?void 0:G.question,U=G==null?void 0:G.done,U||!B){const _e=await window.nextQuestion({categories:[],difficulty:null});B=(_e==null?void 0:_e.question)||null}}catch(G){console.error("[Offline Wizard] Question fetch error:",G),B=null}if(!B){T.prompt.textContent="No questions available. Try different categories.",await new Promise(G=>setTimeout(G,3e3)),Q();return}await Ot(B,l,q),T.questionView.style.display="none",T.leaderboardView.style.display="flex",Dt(q);const ie=3e3;await new Promise(G=>setTimeout(G,ie))}catch(x){a(x),await new Promise(_=>setTimeout(_,2e3)),Q();return}}window.QuestionTimer&&window.QuestionTimer.hide();const P=((R=l.elimination)==null?void 0:R.schedule)||[],C=P[P.length-1],$=(C==null?void 0:C.playersRemaining)||2;if(console.log("[Offline Wizard] Game complete!",{finalPlayers:$,eliminationEnabled:l.eliminationEnabled}),typeof se=="function"){const A=q.find(U=>U.isHuman||U.id==="human"),x=A?A.score:0,_=A?A.correctAnswers:0;console.log("[Offline Wizard] Test Cash mode complete. User Kahoot score:",x,"Correct:",_);const B=se;se=null,at=null,B(x,{correctAnswers:_});return}window.showEliminationBanner&&(l.eliminationEnabled&&$===2?(window.showEliminationBanner("üèÜ Rounds complete! 2 finalists remain. Championship round starting‚Ä¶ (Best of 3)",5e3),await new Promise(A=>setTimeout(A,5e3))):(window.showEliminationBanner("üéâ Game complete! Thanks for playing!",3e3),await new Promise(A=>setTimeout(A,3e3)))),Q()}catch(T){a(T),await new Promise(q=>setTimeout(q,2e3)),Q()}finally{ue=!1,ne=!1}}c.startGame&&c.startGame.addEventListener("click",()=>{try{const f=n("#catsGrid .wizard-tile.wizard-tile-selected").map(g=>g.dataset.cat).filter(g=>g!==void 0);m.categories=f.includes("")||f.length===0?[]:f;const y=1+m.players.bots;if(m.eliminationEnabled){const g=E(y,m.rounds);m.elimination.startRound=g,m.elimination.perRound=1,m.elimination.schedule=v(y,m.rounds,g),m.elimination.banner={enabled:!0,text:`Elimination begins on Round ${g}. From now on, the lowest scorer is eliminated each round.`,fireOnRound:g}}else m.elimination.startRound=null,m.elimination.perRound=0,m.elimination.schedule=Array.from({length:m.rounds},(g,R)=>({round:R+1,eliminate:0,playersRemaining:y})),m.elimination.banner={enabled:!1};m.championship={enabled:!0,format:"bo3",startsAfterRound:m.rounds},m.categoryPlan=O(m.categories,m.rounds),console.log("[Offline Wizard] Final config:",m),console.log("[Offline Wizard] Elimination schedule:",m.elimination.schedule),m.elimination.banner.enabled&&console.log("[Offline Wizard] Banner:",m.elimination.banner),console.log("[Offline Wizard] Championship:",m.championship),console.log("[Offline Wizard] Category plan:",m.categoryPlan);try{sessionStorage.setItem("bd.offline.config",JSON.stringify(m))}catch(g){console.warn("[Offline Wizard] Could not save config:",g)}typeof window.showCountdown=="function"?window.showCountdown(5,()=>{try{Pe(m)}catch(g){a(g)}}):(console.log("[Offline Wizard] No countdown available, starting game directly"),Pe(m))}catch(l){a(l)}}),c.backBots&&c.backBots.addEventListener("click",K),c.homeBots&&c.homeBots.addEventListener("click",Q),c.backRounds&&c.backRounds.addEventListener("click",K),c.homeRounds&&c.homeRounds.addEventListener("click",Q),c.backDiff&&c.backDiff.addEventListener("click",K),c.homeDiff&&c.homeDiff.addEventListener("click",Q),c.backCats&&c.backCats.addEventListener("click",K),c.homeCats&&c.homeCats.addEventListener("click",Q);let ue=!1,ne=!1;const it=s("#ogBackToMenu");it&&it.addEventListener("click",()=>{if(ue){if(!window.confirm("Are you sure you want to exit? Your progress will be lost."))return;ne=!0}window.QuestionTimer&&window.QuestionTimer.hide(),ue=!1,ne=!1,Q()}),window.startOfflineWizard=()=>{console.log("[Offline Wizard] Starting wizard flow"),p=[u.BOTS],z()};let se=null,at=null;window.startOfflineMatch=async(l,f)=>{console.log("[Offline Wizard] === RECEIVED CONFIG ==="),console.log("[Offline Wizard] Mode:",l.mode),console.log("[Offline Wizard] categories:",l.categories),console.log("[Offline Wizard] categoryPlan:",l.categoryPlan),console.log("[Offline Wizard] Full config:",l),se=f;try{at=null,await Pe(l)}catch(y){console.error("[Offline Wizard] Match error:",y),typeof se=="function"&&(se(0),se=null)}},Q(),window.addEventListener("bd:error",l=>{var y;const f=((y=l.detail)==null?void 0:y.error)||"Unknown error";a("[API] "+f)}),console.log("[Offline Wizard] Initialized successfully")})();const Ro=!0,Ct={Politics:"politics","Business & Economics":"business",Sports:"sports",Music:"music",Movies:"movies",History:"history",Geography:"geography",Science:"science","Pop Culture":"pop_culture",Math:"math"};function Lo({correct:e,timeRemaining:t,maxTime:o,currentStreak:s}){if(!e)return 0;const n=1e3,i=Math.max(0,Math.min(t,o)),a=o>0?i/o:0,r=Math.round(n*a),c=Math.min(s*100,500),d=r+c;return console.log("[SCORING] correct:",e,"timeRemaining:",t,"currentStreak:",s,"=> base:",r,"streakBonus:",c,"total:",d),d}window.calculateKahootStyleScore=Lo;const b={id:"user-test-1",username:"You",balance:100},Se=[{id:"bot-1",username:"Bot Blake",balance:80},{id:"bot-2",username:"Bot Nova",balance:150},{id:"bot-3",username:"Bot Pixel",balance:200},{id:"bot-4",username:"Bot Turbo",balance:120}];let V=[],Ie=null,H=null,Z=null,X=null;const W={categories:[],stakes:[],sizes:[]};function Mo(){[{category:"Sports",stake:10,maxPlayers:2},{category:"Movies",stake:20,maxPlayers:2},{category:"Music",stake:10,maxPlayers:4},{category:"Science",stake:50,maxPlayers:2},{category:"Pop Culture",stake:10,maxPlayers:2}].forEach((t,o)=>{V.push({id:`default-${o+1}`,hostId:"system",hostName:"BrainDash Auto Lobby",category:t.category,stake:t.stake,maxPlayers:t.maxPlayers,participants:[],status:"open",isDefault:!0})})}const We=document.getElementById("toast"),Re=document.getElementById("authSheet"),Je=document.getElementById("freeSheet"),k=(e,t=3e3)=>{We.textContent=e,We.style.display="block",setTimeout(()=>We.style.display="none",t)},Ze=e=>{e.style.display="grid",e.setAttribute("aria-hidden","false")},De=e=>{e.style.display="none",e.setAttribute("aria-hidden","true")};let ge=null,Oe=null;function No(e){console.log("[showScreen] Showing screen:",e),document.querySelectorAll(".screen").forEach(o=>{o.classList.add("hidden"),o.style.display="none"});const t=document.querySelector(".wrap");if(e==="home"&&t)t.style.display="flex",console.log("[showScreen] Showing homepage wrap");else{t&&(t.style.display="none",console.log("[showScreen] Hidden wrap element"));const o=document.getElementById(e);console.log("[showScreen] Found screen element:",o),o&&(o.classList.remove("hidden"),o.style.display="block",console.log("[showScreen] Screen display set to:",o.style.display),console.log("[showScreen] Screen classList:",o.classList.toString()))}e==="cash-test-screen"?(console.log("[showScreen] Starting bot simulation"),Qo()):kt()}function ce(e){if(console.log("[NAV] showScreen called",{target:e,activeMatchMode:ge,activeMatchLobbyId:Oe}),ge==="cash-test"&&["home","home-screen","main-menu"].includes(e)){console.warn("[NAV] ‚ùå BLOCKED navigation to",e,"during active cash-test match"),console.warn("[NAV] Match must complete or be exited before returning home");return}if(ge==="cash-test"&&e==="cash-test-screen"){console.warn("[NAV] ‚ùå BLOCKED navigation to cash-test-screen during active match");return}console.log("[NAV] ‚úì Navigation allowed to",e),No(e)}function pe(e){console.log("[hideScreen] Hiding screen:",e);const t=document.getElementById(e);t&&(t.classList.add("hidden"),t.style.display="none",console.log("[hideScreen] Screen hidden")),console.log("[FIX] NOT showing wrap - prevents unwanted home navigation"),e==="cash-test-screen"&&(console.log("[hideScreen] Stopping bot simulation"),kt())}function Te(){const e=document.getElementById("testBalance");e&&(e.textContent="$"+b.balance.toFixed(2))}function Fe({hostId:e,hostName:t,category:o,stake:s,maxPlayers:n,isBotHost:i}){const a=o,r=Ct[a]||null;console.log("[Test Cash] Creating lobby - categoryLabel:",a,"categoryKey:",r);const c={id:"lobby-"+Date.now()+"-"+Math.floor(Math.random()*9999),hostId:e,hostName:t,category:a,categoryLabel:a,categoryKey:r,stake:s,maxPlayers:n,participants:i?[{id:e,username:t,isBot:!0,hasAcceptedTerms:!0,isReady:!0}]:[],status:"open"};return V.unshift(c),oe(),c}function Bt(e,t){const o=V.find(n=>n.id===e);if(!o)return console.error("[Join] Lobby not found:",e),!1;if(o.status!=="open"&&o.status!=="full")return console.error("[Join] Lobby status is",o.status,"- cannot join"),!1;if(o.participants.some(n=>n.id===t.id))return console.log("[Join] User already in lobby"),!1;if(o.participants.length>=o.maxPlayers)return console.log("[Join] Lobby is full (player count)"),!1;if(t.isBot){const n=Se.find(i=>i.id===t.id);n&&n.balance>=o.stake&&(n.balance-=o.stake)}else if(t.id===b.id){if(b.balance<o.stake)return!1;b.balance-=o.stake,Te()}const s=!!t.isBot;return o.participants.push({id:t.id,username:t.username,isBot:s,hasAcceptedTerms:s?!0:t.hasAcceptedTerms||!1,isReady:s?!0:t.isReady||!1}),t.id===b.id&&(X=o.id,console.log("[Test Cash] User joined lobby:",o.id)),oe(),o.participants.length>=o.maxPlayers&&(o.status="full"),le(o),Xe(o),!0}function Do(e){if(console.log("[Lobby] Starting countdown for lobby:",e.id),!e.participants.some(o=>o.id===b.id)||X!==e.id){console.log("[Test Cash] Skipping countdown for lobby",e.id,"because user is not in this lobby");return}le(e),e.status="in_progress",oe(),Oo(e)}function Oo(e){if(!e.participants.some(a=>a.id===b.id)||X!==e.id){console.log("[Test Cash] Skipping countdown display for lobby",e.id);return}const o=document.createElement("div");o.id="match-countdown-overlay",o.style.cssText=`
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  `,o.innerHTML=`
    <div style="text-align:center;max-width:600px;padding:40px">
      <h1 style="font-size:2.5rem;font-weight:900;background:linear-gradient(135deg,var(--accent2),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0 0 16px">Lobby Full!</h1>
      <div style="font-size:1.125rem;color:var(--muted);margin-bottom:32px">
        ${et(e.category)} ${e.category} ¬∑ $${e.stake} entry
      </div>
      <div style="font-size:1rem;color:var(--txt);margin-bottom:24px">Match starting in...</div>
      <div id="match-countdown-number" style="font-size:8rem;font-weight:900;color:var(--accent2);line-height:1;">3</div>
    </div>
  `,document.body.appendChild(o);let s=3;const n=document.getElementById("match-countdown-number"),i=setInterval(()=>{if(!e.participants.some(r=>r.id===b.id)||X!==e.id){console.log("[Test Cash] User left lobby during countdown, stopping"),clearInterval(i),document.body.contains(o)&&document.body.removeChild(o);return}s--,s>0?(n.textContent=s,n.style.animation="none",setTimeout(()=>{n.style.animation="pulse 0.5s ease"},10)):(clearInterval(i),n.textContent="GO!",n.style.color="var(--accent)",setTimeout(()=>{document.body.removeChild(o),Go(e)},500))},1e3)}function Ve(e){H=e;const t=V.find(o=>o.id===e);t&&(le(t),ce("lobby-details-screen"),Z&&clearInterval(Z),Z=setInterval(()=>{const o=V.find(s=>s.id===H);(o&&o.status==="open"||o.status==="full")&&le(o)},1e3))}function le(e){if(!e)return;document.getElementById("lobbyDetailsIcon").textContent=et(e.category),document.getElementById("lobbyDetailsCategory").textContent=e.category,document.getElementById("lobbyDetailsHost").textContent=`Host: ${e.hostName}`,document.getElementById("lobbyDetailsStake").textContent=`$${e.stake}`,document.getElementById("lobbyDetailsPlayerCount").textContent=`(${e.participants.length}/${e.maxPlayers})`;const t=document.getElementById("lobbyDetailsStatus");e.status==="full"?(t.textContent="Lobby full! Preparing your match...",t.style.color="#FFC107"):e.participants.length<e.maxPlayers&&(t.textContent="Waiting for more players to join...",t.style.color="var(--muted)");const o=document.getElementById("lobbyDetailsPlayersList");o.innerHTML="",e.participants.forEach(i=>{const a=document.createElement("div");a.style.cssText="display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:10px;padding:12px 16px",a.innerHTML=`
      <div style="display:flex;align-items:center;gap:12px">
        <div style="font-size:1.25rem">${i.isBot?"ü§ñ":"üë§"}</div>
        <div>
          <div style="font-size:0.9375rem;font-weight:600;color:var(--txt)">${i.username}</div>
          <div style="font-size:0.75rem;color:var(--muted)">${i.isBot?"Bot":"Player"}</div>
        </div>
      </div>
      ${i.isBot?"":'<div style="background:rgba(57,255,136,.1);border:1px solid rgba(57,255,136,.3);border-radius:6px;padding:4px 8px;font-size:0.75rem;font-weight:600;color:var(--accent)">YOU</div>'}
    `,o.appendChild(a)});const s=e.participants.some(i=>i.id===b.id),n=e.participants.length>=e.maxPlayers;if(document.getElementById("lobbyDetailsJoinSection").style.display=!s&&!n?"block":"none",document.getElementById("lobbyDetailsAlreadyJoined").style.display=s?"block":"none",document.getElementById("lobbyDetailsFull").style.display=!s&&n?"block":"none",s){const i=e.participants.find(a=>a.id===b.id);qo(e,i)}}function qo(e,t){if(!e||!t)return;const o=document.getElementById("lobby-terms-phase"),s=document.getElementById("lobby-ready-phase"),n=document.getElementById("lobby-waiting-phase"),i=e.participants.filter(r=>r.isReady).length,a=e.participants.length;if(!t.hasAcceptedTerms)o&&(o.style.display="block"),s&&(s.style.display="none"),n&&(n.style.display="none");else if(t.isReady){o&&(o.style.display="none"),s&&(s.style.display="none"),n&&(n.style.display="block");const r=document.getElementById("lobby-ready-status-waiting");r&&(r.textContent=`${i}/${a} players ready`)}else{o&&(o.style.display="none"),s&&(s.style.display="block"),n&&(n.style.display="none");const r=document.getElementById("lobby-ready-status");r&&(r.textContent=`${i}/${a} players ready`)}}function Po(e){console.log("[LOBBY] User accepting terms",{lobbyId:e});const t=V.find(s=>s.id===e);if(!t)return;const o=t.participants.find(s=>s.id===b.id);o&&(o.hasAcceptedTerms=!0,o.isReady=!1,console.log("[LOBBY] Terms accepted for user",b.id),le(t),Xe(t))}function _o(e){console.log("[LOBBY] User ready up",{lobbyId:e});const t=V.find(s=>s.id===e);if(!t)return;const o=t.participants.find(s=>s.id===b.id);if(!o){console.warn("[LOBBY] Participant not found in lobby");return}if(!o.hasAcceptedTerms){k("‚ö†Ô∏è You must accept the Terms & Conditions before readying up.");return}o.isReady=!0,console.log("[LOBBY] User marked as ready",b.id),le(t),Xe(t)}function Xe(e){if(!e)return;e.participants.forEach(n=>{n.isBot&&(n.hasAcceptedTerms=!0,n.isReady=!0)});const t=e.participants.some(n=>!n.isBot),o=e.participants.length>0&&e.participants.every(n=>n.hasAcceptedTerms),s=e.participants.length>0&&e.participants.every(n=>n.isReady);console.log("[LOBBY] checkLobbyAllReady",{lobbyId:e.id,hasRealUser:t,participants:e.participants.map(n=>({id:n.id,username:n.username,isBot:n.isBot,hasAcceptedTerms:n.hasAcceptedTerms,isReady:n.isReady})),allAccepted:o,allReady:s,status:e.status}),t&&o&&s&&(e.status==="open"||e.status==="full")?(console.log("[LOBBY] ‚úì All players accepted terms and ready! Starting countdown..."),e.status="countdown",Do(e)):t||console.log("[LOBBY] ‚è∏Ô∏è Waiting for a real user to join before starting countdown")}function Uo(e){const t=V.find(s=>s.id===e);if(!t)return;const o=t.participants.findIndex(s=>s.id===b.id);o!==-1&&(t.participants.splice(o,1),b.balance+=t.stake,Te(),(t.status==="full"||t.status==="in_progress")&&t.participants.length<t.maxPlayers&&(t.status="open"),oe(),console.log("[Lobby] User left lobby:",e),k("‚úì Left lobby. Stake refunded."),X===e&&(X=null,console.log("[Test Cash] User no longer in any lobby")),Z&&clearInterval(Z),H=null,pe("lobby-details-screen"),ce("cash-test-screen"))}let Le=null;function Go(e){if(console.log("[Test Cash] === startTestMatch called ==="),console.log("[Test Cash] Lobby ID:",e.id),console.log("[Test Cash] Category Key:",e.categoryKey),!e.participants.some(s=>s.id===b.id)||X!==e.id){console.log("[Test Cash] Skipping match start - user not in lobby");return}Le=e,ge="cash-test",Oe=e.id,console.log("[FIX] Set activeMatchMode to cash-test and activeMatchLobbyId to",e.id),console.log("[Test Cash] Hiding all lobby screens"),Z&&clearInterval(Z),pe("lobby-details-screen"),pe("cash-test-screen");const o=document.querySelector(".wrap");o&&(o.style.display="none",console.log("[Test Cash] Hidden main wrap")),console.log("[DEBUG:CASH-COUNTDOWN] ========================================"),console.log("[DEBUG:CASH-COUNTDOWN] Countdown reached 0 for lobby:",e.id),console.log("[DEBUG:CASH-COUNTDOWN] Mode:",e.mode),console.log("[DEBUG:CASH-COUNTDOWN] Category:",e.categoryKey),console.log("[DEBUG:CASH-COUNTDOWN] Participants:",e.participants.length),console.log("[DEBUG:CASH-COUNTDOWN] Launching Test Cash match NOW"),console.log("[DEBUG:CASH-COUNTDOWN] ========================================"),console.log("[Test Cash] Calling startTestCashMatch..."),$o(e)}async function $o(e){if(console.log("[DEBUG:CASH-START] ========================================"),console.log("[DEBUG:CASH-START] startTestCashMatch called"),console.log("[DEBUG:CASH-START] Lobby ID:",e.id),console.log("[DEBUG:CASH-START] Mode:",e.mode),console.log("[DEBUG:CASH-START] Category Key (raw):",e.categoryKey),console.log("[DEBUG:CASH-START] Category Label:",e.categoryLabel||e.category),console.log("[DEBUG:CASH-START] Participants:",e.participants),console.log("[DEBUG:CASH-START] ========================================"),console.log("[CASH-TEST] ========================================"),console.log("[CASH-TEST] === STARTING MATCH ==="),console.log("[CASH-TEST] Lobby ID:",e.id),console.log("[CASH-TEST] Category Label:",e.categoryLabel||e.category),console.log("[CASH-TEST] Category Key (raw):",e.categoryKey),!e.categoryKey&&(e.categoryLabel||e.category)){const i=e.categoryLabel||e.category;e.categoryKey=Ct[i],console.log('[CASH-TEST] üîß Fixed missing categoryKey - mapped "'+i+'" to "'+e.categoryKey+'"')}if(console.log("[CASH-TEST] Category Key (final):",e.categoryKey),console.log("[CASH-TEST] ========================================"),!e.participants.some(i=>i.id===b.id)){console.log("[CASH-TEST] ‚ùå Not starting match - user not participant");return}if(console.log("[CASH-TEST] ‚úì User is participant"),console.log("[CASH-TEST] Checking for unified trivia engine..."),console.log("[CASH-TEST] - window.getQuestionsForSession:",typeof window.getQuestionsForSession),console.log("[CASH-TEST] - window.startTriviaSession:",typeof window.startTriviaSession),typeof window.getQuestionsForSession!="function"||typeof window.startTriviaSession!="function"){console.error("[CASH-TEST] ‚ùå Unified trivia engine not available!"),ht(e);return}console.log("[CASH-TEST] ‚úì Unified trivia engine available");const o=e.categoryKey||"sports",s=10;console.log("[CASH-TEST] Using categoryKey:",o),console.log('[CASH-TEST] Calling getQuestionsForSession("'+o+'", '+s+") - ASYNC");const n=await window.getQuestionsForSession(o,s);if(console.log("[CASH-TEST] Questions returned:",n),console.log("[CASH-TEST] Questions length:",n?n.length:"null/undefined"),!n||n.length===0){console.error("[CASH-TEST] ‚ùå No questions available for category:",o),ht(e);return}console.log("[CASH-TEST] ‚úì Loaded",n.length,"questions"),console.log("[CASH-TEST] First question preview:",n[0].question.substring(0,60)+"..."),console.log("[CASH-TEST] First question full:",n[0]),console.log("[DEBUG:CASH-START] ========================================"),console.log("[DEBUG:CASH-START] Questions loaded successfully"),console.log("[DEBUG:CASH-START] About to call window.startTriviaSession"),console.log("[DEBUG:CASH-START] - categoryKey:",o),console.log("[DEBUG:CASH-START] - questionCount:",n.length),console.log("[DEBUG:CASH-START] ========================================"),console.log("[CASH-TEST] ========================================"),console.log("[CASH-TEST] Calling startTriviaSession NOW"),console.log("[CASH-TEST] ========================================"),window.startTriviaSession({mode:"cash-test",categoryKey:o,questions:n,lobby:e,onComplete:(i,a)=>{console.log("[DEBUG:CASH-END] ========================================"),console.log("[DEBUG:CASH-END] Test Cash match completed"),console.log("[DEBUG:CASH-END] Lobby ID:",e.id),console.log("[DEBUG:CASH-END] Final score:",i),console.log("[DEBUG:CASH-END] Details:",a),console.log("[DEBUG:CASH-END] ========================================"),console.log("[CASH-TEST] Match completed! Score:",i),Wo(i,a,e)}}),console.log("[DEBUG:CASH-START] startTriviaSession called - should start rendering shortly"),console.log("[CASH-TEST] startTriviaSession called successfully")}function ht(e){console.log("[Test Cash] Using fallback match logic"),ge=null,Oe=null,console.log("[Test Cash] Cleared active match flags for fallback");const t=e.stake*e.participants.length,o=e.participants.findIndex(i=>!i.isBot),s=Math.random()<.55&&o!==-1?o:Math.floor(Math.random()*e.participants.length),n=e.participants[s];if(n.isBot){const i=Se.find(a=>a.id===n.id);i&&(i.balance+=t)}else b.balance+=t;if(e.status="finished",e.winnerId=n.id,e.winnerName=n.username,Te(),oe(),ce("cash-test-screen"),e.participants.some(i=>i.id===b.id)){const i=n.id===b.id?`üéâ You WON this match! +$${t.toFixed(2)} (fake)`:`${n.username} won this match. You lost your $${e.stake.toFixed(2)} entry (fake).`;setTimeout(()=>{k(i,5e3)},500)}Le=null}function Ho(e){const t=(Math.random()-.5)*.8*e,o=Math.floor(e*.3);return Math.max(o,Math.round(e+t))}function Wo(e,t,o){console.log("[Test Cash] Match complete. User Kahoot score:",e,"Details:",t),ge=null,Oe=null,console.log("[FIX] Cleared activeMatchMode in onTestCashMatchComplete");const s=o||Le;if(!s){console.error("[Test Cash] No active lobby found");return}console.log("[Test Cash] Using lobby:",s.id,"with",s.participants.length,"participants");const n=(t==null?void 0:t.correctAnswers)||0,i=[{id:b.id,username:b.username,score:e,correctCount:n,isBot:!1}];s.participants.forEach(u=>{if(u.isBot){const p=Ho(e);i.push({id:u.id,username:u.username,score:p,isBot:!0})}}),i.sort((u,p)=>p.score-u.score);const a=i[0].score,r=i.filter(u=>u.score===a),c=r[Math.floor(Math.random()*r.length)];console.log("[Test Cash] Final results:",i.map(u=>`${u.username}: ${u.score}`).join(", "));const d=s.stake*s.participants.length;if(c.isBot){const u=Se.find(p=>p.id===c.id);u&&(u.balance+=d)}else b.balance+=d;s.status="finished",s.winnerId=c.id,s.winnerName=c.username,Te(),oe(),X===s.id&&(X=null,console.log("[Test Cash] Match finished for lobby",s.id,"reset currentUserLobbyId")),ce("cash-test-screen"),Le=null,setTimeout(()=>{zo(c.id===b.id,d,e,n,c)},500)}function zo(e,t,o,s,n){const i=document.getElementById("match-end-modal"),a=document.getElementById("match-end-icon"),r=document.getElementById("match-end-title"),c=document.getElementById("match-end-message");if(!(!i||!a||!r||!c)){if(e)a.textContent="üéâ",r.textContent="Congratulations!",r.style.color="var(--accent)",c.innerHTML=`
      You won the match!<br>
      <strong style="color:var(--accent);font-size:1.3rem">+$${t.toFixed(2)}</strong> added to your balance<br>
      <span style="color:var(--muted);font-size:0.95rem">Score: ${Math.round(o)} pts (${s}/10 correct)</span>
    `;else{const d=Math.abs(Math.round(n.score)-Math.round(o));let u="Better luck next time!";d<500?u="You were so close!":d<1e3&&(u="Almost there!"),a.textContent="üòî",r.textContent=u,r.style.color="#ff5757",c.innerHTML=`
      ${n.username} won with ${Math.round(n.score)} pts<br>
      Your score: <strong>${Math.round(o)} pts</strong> (${s}/10 correct)<br>
      <span style="color:#ff5757;font-size:1.1rem">-$${t.toFixed(2)}</span>
    `}i.style.display="flex"}}function ze(){const e=document.getElementById("match-end-modal");e&&(e.style.display="none")}function Qo(){Ie||(Ie=setInterval(()=>{if(Math.random()<.5){const d=V.filter(u=>u.status==="open"&&u.participants.length<u.maxPlayers);if(d.length>0){const u=d[Math.floor(Math.random()*d.length)],p=Se.filter(m=>m.balance>=u.stake&&!u.participants.some(I=>I.id===m.id));if(p.length>0){const m=p[Math.floor(Math.random()*p.length)];Bt(u.id,{...m,isBot:!0});return}}}const e=Se.filter(d=>d.balance>0);if(e.length===0)return;const t=e[Math.floor(Math.random()*e.length)];if(t.balance<=0)return;const o=["Politics","Business & Economics","Sports","Music","Movies","History","Geography","Science","Pop Culture"],s=o[Math.floor(Math.random()*o.length)],i=[1,10,20,50,100].filter(d=>d<=t.balance);if(i.length===0)return;const a=i[Math.floor(Math.random()*i.length)],r=[2,4],c=r[Math.floor(Math.random()*r.length)];t.balance>=a&&Fe({hostId:t.id,hostName:t.username,category:s,stake:a,maxPlayers:c,isBotHost:!0})},4e3))}function kt(){Ie&&(clearInterval(Ie),Ie=null)}function et(e){return{Politics:"üèõÔ∏è","Business & Economics":"üíº",Sports:"üèà",Music:"üéµ",Movies:"üé¨",History:"üìú",Geography:"üó∫Ô∏è",Science:"üî¨","Pop Culture":"‚≠ê"}[e]||"üéØ"}function oe(){const e=document.getElementById("testLobbyList"),t=document.getElementById("emptyState"),o=document.getElementById("lobbyCount");if(!e||!o)return;let s=[...V];if(W.categories.length>0&&(s=s.filter(n=>W.categories.includes(n.category))),W.stakes.length>0&&(s=s.filter(n=>W.stakes.includes(n.stake))),W.sizes.length>0&&(s=s.filter(n=>W.sizes.includes(n.maxPlayers))),o.textContent=`${s.length} ${s.length===1?"lobby":"lobbies"}`,s.length===0){if(e.innerHTML="",V.length>0){const n=document.createElement("div");n.style.cssText="background:var(--card);border:1px dashed var(--line);border-radius:16px;padding:48px 24px;text-align:center",n.innerHTML=`
        <div style="font-size:3rem;margin-bottom:12px;opacity:0.5">üîç</div>
        <div style="font-size:1.125rem;font-weight:600;color:var(--muted);margin-bottom:8px">No lobbies match your filters</div>
        <div style="font-size:0.875rem;color:var(--dim)">Try changing the category, stake, or lobby size</div>
      `,e.appendChild(n)}else t&&(t.style.display="block",e.appendChild(t));return}t&&(t.style.display="none"),e.innerHTML="",s.forEach(n=>{const i=document.createElement("div");i.className="lobby-card";const a=n.status==="open"?"open":n.status==="in_progress"?"in-progress":"finished",r=n.status==="open"?"OPEN":n.status==="in_progress"?"IN PROGRESS":"FINISHED",c=n.participants.some(u=>u.id===b.id);n.status==="open"&&!c&&b.balance>=n.stake;let d="";n.status==="open"||n.status==="full"?d=`<button class="btn" style="padding:8px 20px;font-size:0.875rem" onclick="window.openLobbyDetailsWrapper('${n.id}')">View Lobby</button>`:d=`<button class="btn secondary" style="padding:8px 20px;font-size:0.875rem;opacity:0.5;cursor:not-allowed" disabled>${n.status==="in_progress"?"In Progress":"Finished"}</button>`,i.innerHTML=`
      <div style="display:flex;align-items:start;justify-content:space-between;margin-bottom:12px">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
            <span style="font-size:1.5rem">${et(n.category)}</span>
            <h3 style="font-size:1.25rem;font-weight:700;margin:0;color:var(--txt)">${n.category}</h3>
          </div>
          <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:8px">
            <span class="lobby-badge ${a}">${r}</span>
            <span style="font-size:0.875rem;color:var(--muted)">Host: ${n.hostName}</span>
          </div>
          ${n.status==="finished"?`<div style="font-size:0.875rem;color:var(--accent);font-weight:600">üèÜ Winner: ${n.winnerName}</div>`:""}
        </div>
        <div style="text-align:right">
          <div style="font-size:1.5rem;font-weight:700;color:var(--accent2);margin-bottom:4px">$${n.stake}</div>
          <div style="font-size:0.75rem;color:var(--muted)">entry fee</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding-top:12px;border-top:1px solid var(--line)">
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:0.875rem;color:var(--muted)">Players:</span>
          <span style="font-size:0.9375rem;font-weight:600;color:var(--txt)">${n.participants.length} / ${n.maxPlayers}</span>
        </div>
        ${d}
      </div>
    `,e.appendChild(i)})}window.openLobbyDetailsWrapper=function(e){Ve(e)};document.querySelectorAll(".close").forEach(e=>{e.addEventListener("click",t=>{const o=t.currentTarget.getAttribute("data-close"),s=document.getElementById(o);s&&De(s)})});[Re,Je].forEach(e=>{e.addEventListener("click",t=>{t.target===e&&De(e)})});let tt=null;{const e=document.getElementById("testCashBtn"),t=document.getElementById("testCashCard"),o=document.getElementById("testCashBackBtn"),s=document.getElementById("testCreateLobby"),n=document.getElementById("addTestFunds");e==null||e.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),console.log("[Test Mode] Opening Test Cash Challenge"),console.log("[Test Mode] Current TEST_CASH_MODE:",Ro),ce("cash-test-screen"),console.log("[Test Mode] Screen shown")}),t==null||t.addEventListener("click",h=>{h.target!==e&&!e.contains(h.target)&&e.click()}),o==null||o.addEventListener("click",()=>{pe("cash-test-screen")}),n==null||n.addEventListener("click",()=>{b.balance+=20,Te(),k("‚úì Added $20 to test balance!")}),document.querySelectorAll(".stake-quick-btn").forEach(h=>{h.addEventListener("click",()=>{const w=h.getAttribute("data-stake");document.getElementById("testStake").value=w,document.querySelectorAll(".stake-quick-btn").forEach(E=>E.classList.remove("active")),h.classList.add("active")})}),V.length===0&&(Mo(),oe());const i=document.getElementById("quickCashBtn");i==null||i.addEventListener("click",()=>{const h=b.balance>=10?10:b.balance>=1?1:null;if(!h){k("‚ö†Ô∏è Insufficient balance for Quick Cash Match");return}const w=["Politics","Business & Economics","Sports","Music","Movies","History","Geography","Science","Pop Culture"],E=w[Math.floor(Math.random()*w.length)],v=Fe({hostId:b.id,hostName:b.username,category:E,stake:h,maxPlayers:2,isBotHost:!1});k(`‚ö° Quick Cash Match created! ${E} ¬∑ $${h}`),setTimeout(()=>Ve(v.id),300)}),s==null||s.addEventListener("click",()=>{const h=document.getElementById("testCategory").value,w=parseInt(document.getElementById("testStake").value),E=parseInt(document.getElementById("testMaxPlayers").value),v=[1,10,20,50,100];if(!h||!w||!E){k("‚ö†Ô∏è Please fill in all fields");return}if(!v.includes(w)){k("‚ö†Ô∏è Stake must be $1, $10, $20, $50, or $100");return}if(w>b.balance){k("‚ö†Ô∏è Insufficient balance");return}if(E<2){k("‚ö†Ô∏è Max players must be at least 2");return}const O=Fe({hostId:b.id,hostName:b.username,category:h,stake:w,maxPlayers:E,isBotHost:!1});k("‚úì Lobby created!"),setTimeout(()=>Ve(O.id),300)}),document.querySelectorAll(".filter-pill").forEach(h=>{h.addEventListener("click",()=>{const w=h.getAttribute("data-type"),E=h.getAttribute("data-value");if(w==="category"){const v=W.categories.indexOf(E);v===-1?(W.categories.push(E),h.classList.add("active")):(W.categories.splice(v,1),h.classList.remove("active"))}else if(w==="stake"){const v=Number(E),O=W.stakes.indexOf(v);O===-1?(W.stakes.push(v),h.classList.add("active")):(W.stakes.splice(O,1),h.classList.remove("active"))}else if(w==="size"){const v=Number(E),O=W.sizes.indexOf(v);O===-1?(W.sizes.push(v),h.classList.add("active")):(W.sizes.splice(O,1),h.classList.remove("active"))}oe()})});const a=document.getElementById("lobbyDetailsBackBtn"),r=document.getElementById("lobbyDetailsJoinBtn");console.log("[Init] lobbyDetailsJoinBtn element found:",r),r?console.log("[Init] Adding click listener to Join button"):console.error("[Init] Join button not found in DOM!"),a==null||a.addEventListener("click",()=>{const h=V.find(E=>E.id===H);if(h&&h.participants.some(E=>E.id===b.id)){const E=document.getElementById("leave-lobby-modal");E&&(E.style.display="flex")}else Z&&clearInterval(Z),H=null,pe("lobby-details-screen"),ce("cash-test-screen")});const c=document.getElementById("confirmLeaveLobby"),d=document.getElementById("cancelLeaveLobby");c==null||c.addEventListener("click",()=>{const h=document.getElementById("leave-lobby-modal");h&&(h.style.display="none"),H&&Uo(H)}),d==null||d.addEventListener("click",()=>{const h=document.getElementById("leave-lobby-modal");h&&(h.style.display="none")});const u=document.getElementById("match-end-home-btn"),p=document.getElementById("match-end-rematch-btn"),m=document.getElementById("match-end-deposit-btn");u==null||u.addEventListener("click",()=>{ze(),pe("cash-test-screen");const h=document.querySelector(".wrap");h&&(h.style.display="block"),ce("fp-picker-screen")}),p==null||p.addEventListener("click",()=>{ze(),k("Rematch feature coming soon!")}),m==null||m.addEventListener("click",()=>{ze(),k("Deposit feature coming soon!")}),r?(r.addEventListener("click",()=>{if(console.log("[Join Button] ========== CLICKED =========="),console.log("[Join Button] currentLobbyId:",H),console.log("[Join Button] testUser:",b),!H){console.error("[Join Button] No currentLobbyId!"),k("‚ö†Ô∏è Error: No lobby selected");return}const h=V.find(E=>E.id===H);console.log("[Join Button] Found lobby:",h),console.log("[Join Button] User balance:",b.balance,"Lobby stake:",h==null?void 0:h.stake);const w=Bt(H,{id:b.id,username:b.username,isBot:!1,hasAcceptedTerms:!1,isReady:!1});console.log("[Join Button] joinTestLobby returned:",w),k(w?"‚úì Joined lobby successfully!":"‚ö†Ô∏è Unable to join lobby")}),console.log("[Init] Join button click listener attached successfully")):console.error("[Init] Could not attach listener - button element is null");const I=document.getElementById("lobby-accept-terms-btn"),S=document.getElementById("lobby-ready-btn");I&&I.addEventListener("click",()=>{H&&Po(H)}),S&&S.addEventListener("click",()=>{H&&_o(H)})}const Be=document.getElementById("freeBtn"),Fo=document.getElementById("freeCard");Be.addEventListener("click",()=>{console.log("[Free Play] Opening choice sheet"),Ze(Je)});Fo.addEventListener("click",e=>{e.target!==Be&&!Be.contains(e.target)&&Be.click()});document.getElementById("freeSignInBtn").addEventListener("click",async()=>{console.log("[Free Play] Sign-in requested"),tt="free",De(Je),Ze(Re)});const F=document.getElementById("cashBtn"),Vo=document.getElementById("cashCard");F.addEventListener("click",jo);Vo.addEventListener("click",e=>{e.target!==F&&!F.contains(e.target)&&F.click()});async function jo(){console.log("[Cash Gate] Starting..."),tt="cash",F.disabled=!0,F.innerHTML='‚è± Checking... <span class="spinner"></span>';try{let e=(await L.auth.getSession()).data.session;if(!e&&(console.log("[Cash Gate] No session - opening auth"),F.disabled=!1,F.innerHTML="Enter Cash Play",Ze(Re),await Ko(),De(Re),e=(await L.auth.getSession()).data.session,!e)){console.log("[Cash Gate] User cancelled");return}console.log("[Cash Gate] Authenticated, checking verification...");const{data:{user:t},error:o}=await L.auth.getUser();if(o||!t){k("Failed to get user info. Try again."),F.disabled=!1,F.innerHTML="Enter Cash Play";return}const s=!!t.email_confirmed_at,n=!!t.phone&&!!t.phone_confirmed_at;if(console.log("[Cash Gate] Email verified:",s,"Phone verified:",n),!s&&!n){k("‚ö†Ô∏è Verify your email or phone first. Check your inbox/SMS.",5e3),F.disabled=!1,F.innerHTML="Enter Cash Play";return}console.log("[Cash Gate] Contact verified, checking KYC...");const{data:i}=await L.from("user_kyc_status").select("kyc_status").eq("user_id",t.id).maybeSingle();if(console.log("[Cash Gate] KYC record:",i),(i==null?void 0:i.kyc_status)==="verified"){console.log("[Cash Gate] KYC verified - entering"),k("‚úì Verified! Entering Cash Play..."),setTimeout(()=>{window.location.href="/online.html"},800);return}console.log("[Cash Gate] KYC not verified - redirecting to verify-identity"),k("üîí Identity verification required..."),setTimeout(()=>{window.location.href="/verify-identity.html"},800)}catch(e){console.error("[Cash Gate] Error:",e),k("‚ö†Ô∏è Something went wrong. Try again."),F.disabled=!1,F.innerHTML="Enter Cash Play"}}ho();document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("ogBackToMenu");e&&(e.addEventListener("click",()=>{typeof window.exitTriviaSession=="function"&&window.exitTriviaSession()}),console.log("[Trivia] Exit button wired to exitTriviaSession"));const t=()=>{const o=document.getElementById("catsGrid");if(!o||!window.TRIVIA_CATEGORIES){console.warn("[Categories] Cannot render - missing catsGrid or TRIVIA_CATEGORIES");return}console.log("[Categories] Rendering Free Play categories from TRIVIA_CATEGORIES"),o.innerHTML="",window.TRIVIA_CATEGORIES.forEach(s=>{const n=document.createElement("div");n.className=s.key==="mixed"?"wizard-tile wizard-tile-selected":"wizard-tile",n.setAttribute("data-cat",s.key),n.innerHTML=`
        <div class="cat-icon">${s.icon}</div>
        <div class="cat-title">${s.label}</div>
      `,o.appendChild(n)}),console.log("[Categories] Rendered",window.TRIVIA_CATEGORIES.length,"categories")};if(window.TRIVIA_CATEGORIES)t();else{const o=setInterval(()=>{window.TRIVIA_CATEGORIES&&(clearInterval(o),t())},100);setTimeout(()=>clearInterval(o),5e3)}});function Ko(){return new Promise(e=>{const t=L.auth.onAuthStateChange((o,s)=>{if(s){try{t.data.subscription.unsubscribe()}catch{}e()}});setTimeout(()=>{try{t.data.subscription.unsubscribe()}catch{}e()},12e4)})}(async()=>{var s;console.log("[Auth Guard] Initializing production auth guard...");const e=new URLSearchParams(window.location.search),t=e.has("code")||e.has("access_token")||e.has("error"),o=sessionStorage.getItem("bd_oauth_success_shown");if(t){if(console.log("[Auth Guard] ========================================"),console.log("[Auth Guard] OAuth redirect detected"),console.log("[Auth Guard] URL params:",{hasCode:e.has("code"),hasAccessToken:e.has("access_token"),hasError:e.has("error"),error:e.get("error"),errorDescription:e.get("error_description")}),console.log("[Auth Guard] ========================================"),e.has("error")){const n=e.get("error"),i=e.get("error_description");console.error("[Auth Guard] ‚ùå OAuth error:",n,i),k("‚ö†Ô∏è Sign in failed: "+(i||n));const a=window.location.pathname;window.history.replaceState({},document.title,a);return}try{console.log("[Auth Guard] ‚úÖ Returned from Google"),console.log("[Auth Guard] Waiting for session to be established..."),await new Promise(r=>setTimeout(r,1e3));const{data:{session:n},error:i}=await L.auth.getSession();i?(console.error("[Auth Guard] ‚ùå Error getting session:",i),o||k("‚ö†Ô∏è Authentication error. Please try again.")):n?(console.log("[Auth Guard] ‚úÖ Supabase session created"),console.log("[Auth Guard] User:",n.user.email),console.log("[Auth Guard] Provider:",(s=n.user.app_metadata)==null?void 0:s.provider),o?console.log("[Auth Guard] Success toast already shown this session, skipping"):(k("‚úì Signed in as "+n.user.email),sessionStorage.setItem("bd_oauth_success_shown","true"),console.log("[Auth Guard] Success toast shown and guard set"))):(console.warn("[Auth Guard] ‚ö†Ô∏è No session found after OAuth redirect"),o||k("‚ö†Ô∏è Sign in incomplete. Please try again."));const a=window.location.pathname;window.history.replaceState({},document.title,a),console.log("[Auth Guard] URL cleaned"),n&&tt==="free"&&(console.log("[Auth Guard] Redirecting to free play after auth"),setTimeout(()=>{window.location.href="/offline.html"},1e3))}catch(n){console.error("[Auth Guard] ‚ùå Exception during session handling:",n),o||k("‚ö†Ô∏è Authentication error. Please try again.");const i=window.location.pathname;window.history.replaceState({},document.title,i)}}else{console.log("[Auth Guard] Normal page load - checking for existing session");try{const{data:{session:n},error:i}=await L.auth.getSession();i?console.error("[Auth Guard] Error checking session:",i):n?(console.log("[Auth Guard] ‚úÖ Existing session found"),console.log("[Auth Guard] User:",n.user.email),console.log("[Auth Guard] Session valid until:",new Date(n.expires_at*1e3).toLocaleString()),console.log("[Auth Guard] No OAuth params - skipping success toast (normal page load)")):console.log("[Auth Guard] No existing session (user not logged in)")}catch(n){console.error("[Auth Guard] Exception checking session:",n)}}console.log("[Auth Guard] Initialization complete")})();to();so();function Yo(){console.log("Cash duel UI initialized")}Yo();
